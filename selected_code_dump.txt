===== FILE: tsconfig.json =====
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", "next.config.js", "middleware.ts"],
  "exclude": ["node_modules"]
}

===== FILE: tailwind.config.ts =====
import type { Config } from 'tailwindcss'

const config: Config = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#f0fdf4',
          100: '#dcfce7',
          200: '#bbf7d0',
          300: '#86efac',
          400: '#4ade80',
          500: '#22c55e',
          600: '#16a34a',
          700: '#15803d',
          800: '#166534',
          900: '#14532d',
        },
        accent: {
          50: '#f0fdfa',
          100: '#ccfbf1',
          200: '#99f6e4',
          300: '#5eead4',
          400: '#2dd4bf',
          500: '#14b8a6',
          600: '#0d9488',
          700: '#0f766e',
          800: '#115e59',
          900: '#134e4a',
        },
      },
      fontFamily: {
        sans: ['var(--font-inter)', 'system-ui', 'sans-serif'],
      },
      animation: {
        'fade-up': 'fadeUp 0.5s ease-out',
        'fade-in': 'fadeIn 0.5s ease-out',
        'slide-up': 'slideUp 0.5s ease-out',
      },
      keyframes: {
        fadeUp: {
          '0%': { opacity: '0', transform: 'translateY(20px)' },
          '100%': { opacity: '1', transform: 'translateY(0)' },
        },
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        slideUp: {
          '0%': { transform: 'translateY(100%)' },
          '100%': { transform: 'translateY(0)' },
        },
      },
    },
  },
  plugins: [],
}

export default config

===== FILE: postcss.config.mjs =====
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};



===== FILE: package.json =====
{
  "name": "local-league-cricket",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@radix-ui/react-slot": "^1.0.2",
    "@radix-ui/react-tabs": "^1.0.4",
    "@types/lodash": "^4.17.20",
    "@uploadthing/react": "^6.0.0",
    "bcryptjs": "^2.4.3",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.0.0",
    "framer-motion": "^10.18.0",
    "jose": "^5.1.0",
    "jsonwebtoken": "^9.0.2",
    "lodash": "^4.17.21",
    "lucide-react": "^0.292.0",
    "mongoose": "^7.5.0",
    "nanoid": "^3.3.11",
    "next": "^14.2.33",
    "pusher": "^5.1.3",
    "pusher-js": "^8.3.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-hot-toast": "^2.6.0",
    "resend": "^2.0.0",
    "tailwind-merge": "^2.0.0",
    "uploadthing": "^6.0.0"
  },
  "devDependencies": {
    "@types/bcryptjs": "^2.4.2",
    "@types/jsonwebtoken": "^9.0.2",
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "autoprefixer": "^10.4.0",
    "eslint": "^8.0.0",
    "eslint-config-next": "14.0.0",
    "postcss": "^8.4.0",
    "tailwindcss": "^3.3.0",
    "typescript": "^5.0.0",
    "@types/lodash": "^4.14.202"
  }
}





===== FILE: next.config.js =====
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  images: {
    domains: ['localhost'],
  },
}

module.exports = nextConfig

===== FILE: middleware.ts =====
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

// Routes that don't require authentication
const publicRoutes = [
  '/',
  '/login',
  '/register',
  '/forgot-password',
  '/api/auth/login',
  '/api/auth/register',
  '/api/health',
]

// Routes that require authentication
const protectedRoutes = [
  '/dashboard',
  '/matches',
  '/profile',
  '/settings',
]

export function middleware(request: NextRequest) {
  const path = request.nextUrl.pathname
  const token = request.cookies.get('auth-token')?.value || 
                request.headers.get('authorization')?.replace('Bearer ', '')

  // Check if it's a public route
  const isPublicRoute = publicRoutes.some(route => 
    path === route || path.startsWith(`${route}/`)
  )

  // Check if it's a protected route
  const isProtectedRoute = protectedRoutes.some(route => 
    path === route || path.startsWith(`${route}/`)
  )

  // If it's a protected route and no token, redirect to login
  if (isProtectedRoute && !token) {
    const loginUrl = new URL('/login', request.url)
    loginUrl.searchParams.set('from', path)
    return NextResponse.redirect(loginUrl)
  }

  // If user is logged in and tries to access login/register, redirect to dashboard
  if (token && (path === '/login' || path === '/register')) {
    return NextResponse.redirect(new URL('/dashboard', request.url))
  }

  return NextResponse.next()
}

// Configure which routes use this middleware
export const config = {
  matcher: [
    /*
     * Match all request paths except:
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * - public folder
     * - api routes that don't need protection
     */
    '/((?!_next/static|_next/image|favicon.ico|.*\\.png$|.*\\.jpg$|.*\\.svg$).*)',
  ],
}

===== FILE: eslint.config.mjs =====
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;


===== FILE: utils/apiHelpers.ts =====
import { logger } from './debugLogger'

interface ApiOptions {
  method?: 'GET' | 'POST' | 'PUT' | 'DELETE'
  body?: any
  timeout?: number // milliseconds
}

class ApiError extends Error {
  constructor(
    public statusCode: number,
    message: string,
    public details?: any
  ) {
    super(message)
    this.name = 'ApiError'
  }
}

export async function apiCall<T = any>(
  endpoint: string,
  options: ApiOptions = {}
): Promise<T> {
  const { method = 'GET', body, timeout = 10000 } = options

  logger.info('API', `${method} ${endpoint}`, { body })

  const controller = new AbortController()
  const timeoutId = setTimeout(() => controller.abort(), timeout)

  try {
    const token = localStorage.getItem('auth_token')

    const response = await fetch(endpoint, {
      method,
      headers: {
        'Content-Type': 'application/json',
        ...(token ? { Authorization: `Bearer ${token}` } : {}),
      },
      body: body ? JSON.stringify(body) : undefined,
      signal: controller.signal,
    })

    clearTimeout(timeoutId)

    const data = await response.json()

    if (!response.ok) {
      logger.error('API', `${method} ${endpoint} failed`, {
        status: response.status,
        data,
      })
      throw new ApiError(response.status, data.error || 'Request failed', data)
    }

    logger.success('API', `${method} ${endpoint} success`, data)
    return data
  } catch (error: any) {
    clearTimeout(timeoutId)

    if (error.name === 'AbortError') {
      logger.error('API', `${method} ${endpoint} timeout`, {
        timeout,
      })
      throw new Error('Request timeout - please check your connection')
    }

    if (error instanceof ApiError) {
      throw error
    }

    logger.error('API', `${method} ${endpoint} error`, error)
    throw new Error(error.message || 'Network error')
  }
}

// Helper function to wait
export function wait(ms: number): Promise<void> {
  return new Promise((resolve) => setTimeout(resolve, ms))
}

===== FILE: utils/debugLogger.ts =====
type LogLevel = 'info' | 'success' | 'warning' | 'error' | 'debug'

interface LogEntry {
  timestamp: string
  level: LogLevel
  category: string
  message: string
  data?: any
}

class DebugLogger {
  private logs: LogEntry[] = []
  private enabled: boolean = process.env.NODE_ENV === 'development'

  private log(level: LogLevel, category: string, message: string, data?: any) {
    const entry: LogEntry = {
      timestamp: new Date().toISOString(),
      level,
      category,
      message,
      data,
    }

    this.logs.push(entry)

    if (this.enabled) {
      const emoji = {
        info: '‚ÑπÔ∏è',
        success: '‚úÖ',
        warning: '‚ö†Ô∏è',
        error: '‚ùå',
        debug: 'üîç',
      }

      const color = {
        info: 'color: #3b82f6',
        success: 'color: #10b981',
        warning: 'color: #f59e0b',
        error: 'color: #ef4444',
        debug: 'color: #8b5cf6',
      }

      console.log(
        `%c${emoji[level]} [${category}] ${message}`,
        color[level],
        data || ''
      )
    }
  }

  info(category: string, message: string, data?: any) {
    this.log('info', category, message, data)
  }

  success(category: string, message: string, data?: any) {
    this.log('success', category, message, data)
  }

  warning(category: string, message: string, data?: any) {
    this.log('warning', category, message, data)
  }

  error(category: string, message: string, data?: any) {
    this.log('error', category, message, data)
  }

  debug(category: string, message: string, data?: any) {
    this.log('debug', category, message, data)
  }

  getLogs() {
    return this.logs
  }

  clearLogs() {
    this.logs = []
  }

  downloadLogs() {
    const blob = new Blob([JSON.stringify(this.logs, null, 2)], {
      type: 'application/json',
    })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `scoring-logs-${Date.now()}.json`
    a.click()
  }
}

export const logger = new DebugLogger()

===== FILE: utils/scoringValidations.ts =====
import { Match, Team } from '@/types/match'

export interface ValidationError {
  message: string
  type: 'error' | 'warning'
}

export const validateBallUpdate = (
  match: Match,
  outcome: string,
  battingTeam: Team | null,
  currentInnings: number
): ValidationError[] => {
  const errors: ValidationError[] = []

  if (!battingTeam) {
    errors.push({ message: 'Batting team not found', type: 'error' })
    return errors
  }

  // Can't exceed total overs
  const maxBalls = match.overs * 6
  if (
    battingTeam.total_balls >= maxBalls &&
    !['WD', 'NB'].includes(outcome)
  ) {
    errors.push({ message: 'Innings already complete', type: 'error' })
  }

  // All out check
  const totalPlayers = battingTeam.players.length
  if (battingTeam.total_wickets >= totalPlayers - 1) {
    errors.push({ message: 'Team is already all out', type: 'error' })
  }

  // Target already achieved
  if (currentInnings === 2 && match.target) {
    if (battingTeam.total_score >= match.target) {
      errors.push({ message: 'Target already achieved', type: 'error' })
    }
  }

  return errors
}

export const validatePlayerSelection = (
  batsman1: string,
  batsman2: string,
  bowler: string
): ValidationError[] => {
  const errors: ValidationError[] = []

  if (!batsman1 || !batsman2 || !bowler) {
    errors.push({
      message: 'Please select both batsmen and bowler',
      type: 'error',
    })
  }

  if (batsman1 === batsman2 && batsman1 !== '') {
    errors.push({
      message: 'Please select different batsmen',
      type: 'error',
    })
  }

  return errors
}

export const calculateBallOutcome = (
  outcome: string,
  extraRuns: number
): {
  runs: number
  isWicket: boolean
  isExtra: boolean
  ballCounts: boolean
  shouldRotateStrike: boolean
} => {
  let runs = 0
  let isWicket = false
  let isExtra = false
  let ballCounts = true
  let shouldRotateStrike = false

  switch (outcome) {
    case '0':
      runs = 0
      break
    case '1':
    case '3':
    case '5':
      runs = parseInt(outcome)
      shouldRotateStrike = true
      break
    case '2':
    case '4':
    case '6':
      runs = parseInt(outcome)
      shouldRotateStrike = false
      break
    case 'W':
      isWicket = true
      break
    case 'WD':
      // ‚úÖ FIX: 1 (penalty) + extraRuns (batsmen ran)
      runs = 1 + extraRuns
      isExtra = true
      ballCounts = false
      shouldRotateStrike = extraRuns % 2 === 1 // ‚úÖ Rotate if odd runs taken
      break
    case 'NB':
      // ‚úÖ FIX: 1 (penalty) + extraRuns (batsmen ran/hit)
      runs = 1 + extraRuns
      isExtra = true
      ballCounts = false
      shouldRotateStrike = extraRuns % 2 === 1 // ‚úÖ Rotate if odd runs taken
      break
    case 'B':
    case 'LB':
      // ‚úÖ FIX: Only the runs batsmen took
      runs = extraRuns
      isExtra = true
      shouldRotateStrike = runs % 2 === 1
      break
  }

  return { runs, isWicket, isExtra, ballCounts, shouldRotateStrike }
}

===== FILE: types/index.ts =====
export interface User {
  id: string;
  name: string;
  email: string;
  avatar?: string;
}

export interface Player {
  name: string;
  runs_scored?: number;
  balls_played?: number;
  fours?: number;
  sixes?: number;
  wickets?: number;
  is_captain?: boolean;
  is_keeper?: boolean;
  is_out?: boolean;
}

export interface Team {
  name: string;
  players: Player[];
  total_score?: number;
  total_wickets?: number;
  total_overs?: number;
  extras?: number;
}

export interface Match {
  _id: string;
  matchCode: string;
  createdBy: string;
  status: 'upcoming' | 'live' | 'completed';
  teamOne: Team;
  teamTwo: Team;
  venue: string;
  startTime: Date;
  overs: number;
  isPrivate: boolean;
  createdAt: Date;
  updatedAt: Date;
}

export interface ScoreUpdate {
  action: 'runs' | 'wicket' | 'wide' | 'no_ball' | 'bye' | 'leg_bye';
  runs?: number;
  extras?: number;
  wicketType?: string;
}

===== FILE: types/match.ts =====
export interface Player {
  name: string
  runs_scored: number
  balls_played: number
  dots: number
  fours: number
  sixes: number
  wickets: number
  balls_bowled: number
  runs_conceded: number
  maidens: number
  dot_balls: number
  is_captain: boolean
  is_keeper: boolean
  is_out: boolean
}

export interface Team {
  name: string
  players: Player[]
  total_score: number
  total_wickets: number
  total_balls: number
  extras: number
}

export interface Ball {
  ballNumber: number
  overNumber: number
  batsman: string
  bowler: string
  runs: number
  outcome: string
  isExtra: boolean
  isWicket: boolean
  timestamp: Date
}

export interface ScoringState {
  selectedBatsman1: string
  selectedBatsman2: string
  selectedBowler: string
  previousBowler: string // ‚úÖ NEW: Track last over's bowler
  currentStriker: 'batsman1' | 'batsman2'
  currentOver: string[]
  outBatsmen: string[]
  currentInnings: number
  extraRuns: number
}

export type ScoringAction =
  | { type: 'SET_BATSMAN_1'; payload: string }
  | { type: 'SET_BATSMAN_2'; payload: string }
  | { type: 'SET_BOWLER'; payload: string }
  | { type: 'SET_STRIKER'; payload: 'batsman1' | 'batsman2' }
  | { type: 'ROTATE_STRIKE' }
  | { type: 'ADD_TO_CURRENT_OVER'; payload: string }
  | { type: 'COMPLETE_OVER' } // ‚úÖ This will now save previous bowler
  | { type: 'WICKET'; payload: string }
  | { type: 'RESET_FOR_INNINGS' }
  | { type: 'SET_EXTRA_RUNS'; payload: number }
  | { type: 'RESTORE_STATE'; payload: ScoringState }

export interface Match {
  _id: string
  matchCode: string
  teamOne: Team
  teamTwo: Team
  status: 'upcoming' | 'live' | 'completed'
  toss_winner?: string
  toss_decision?: 'bat' | 'bowl'
  batting_team?: string
  bowling_team?: string
  target?: number
  overs: number
  currentInnings?: number
  scoringState?: ScoringState
  ballHistory: Ball[]
  createdBy: string
  admins: string[]
  scorers: string[]
  viewers: string[]
  createdAt: Date
  updatedAt: Date
}


export interface BallOutcome {
  runs: number
  isWicket: boolean
  isExtra: boolean
  ballCounts: boolean
  shouldRotateStrike: boolean
}

===== FILE: models/index.ts =====
export { default as User } from './User'
export { default as Match } from './Match'

===== FILE: models/Match.ts =====
import mongoose, { Schema, Document, Model } from 'mongoose'
import { customAlphabet } from 'nanoid'

const generateMatchCode = customAlphabet(
  'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',
  6
)

export interface IPlayer {
  name: string
  runs_scored: number
  balls_played: number
  dots: number
  fours: number
  sixes: number
  wickets: number
  balls_bowled: number
  runs_conceded: number
  maidens: number
  dot_balls: number
  is_captain: boolean
  is_keeper: boolean
  is_out: boolean
}

export interface ITeam {
  name: string
  players: IPlayer[]
  total_score: number
  total_wickets: number
  total_overs: number
  extras: number
  total_balls: number
}

export interface IBall {
  ballNumber: number
  overNumber: number
  batsman: string
  bowler: string
  runs: number
  outcome: string
  isExtra: boolean
  isWicket: boolean
  timestamp: Date
}

export interface IScoringState {
  selectedBatsman1: string
  selectedBatsman2: string
  selectedBowler: string
  currentStriker: 'batsman1' | 'batsman2'
  currentOver: string[]
  outBatsmen: string[]
  currentInnings: number
  extraRuns: number
}

export interface IMatch extends Document {
  matchCode: string
  createdBy: mongoose.Types.ObjectId
  status: 'upcoming' | 'live' | 'completed'
  startTime: Date
  venue: string
  overs: number
  teamOne: ITeam
  teamTwo: ITeam
  toss_decision: string
  toss_winner: string
  isPrivate: boolean
  admins: mongoose.Types.ObjectId[]
  scorers: mongoose.Types.ObjectId[]
  viewers: mongoose.Types.ObjectId[]
  createdAt: Date
  updatedAt: Date
  batting_team: string
  bowling_team: string
  target: number
  currentInnings: number
  scoringState: IScoringState | null
  ballHistory: IBall[]
}

const playerSchema = new mongoose.Schema({
  name: { type: String, required: true },
  runs_scored: { type: Number, default: 0 },
  balls_played: { type: Number, default: 0 },
  dots: { type: Number, default: 0 },
  fours: { type: Number, default: 0 },
  sixes: { type: Number, default: 0 },
  wickets: { type: Number, default: 0 },
  balls_bowled: { type: Number, default: 0 },
  runs_conceded: { type: Number, default: 0 },
  maidens: { type: Number, default: 0 },
  dot_balls: { type: Number, default: 0 },
  is_captain: { type: Boolean, default: false },
  is_keeper: { type: Boolean, default: false },
  is_out: { type: Boolean, default: false },
})

const teamSchema = new mongoose.Schema({
  name: { type: String, required: true },
  players: [playerSchema],
  total_score: { type: Number, default: 0 },
  total_wickets: { type: Number, default: 0 },
  total_overs: { type: Number, default: 0 },
  total_balls: { type: Number, default: 0 },
  extras: { type: Number, default: 0 },
})

const ballSchema = new mongoose.Schema(
  {
    ballNumber: { type: Number, required: true },
    overNumber: { type: Number, required: true },
    batsman: { type: String, required: true },
    bowler: { type: String, required: true },
    runs: { type: Number, required: true },
    outcome: { type: String, required: true },
    isExtra: { type: Boolean, default: false },
    isWicket: { type: Boolean, default: false },
    timestamp: { type: Date, default: Date.now },
  },
  { _id: false }
)

const scoringStateSchema = new mongoose.Schema(
  {
    selectedBatsman1: { type: String, default: '' },
    selectedBatsman2: { type: String, default: '' },
    selectedBowler: { type: String, default: '' },
    previousBowler: { type: String, default: '' }, // ‚úÖ NEW
    currentStriker: {
      type: String,
      enum: ['batsman1', 'batsman2'],
      default: 'batsman1',
    },
    currentOver: { type: [String], default: [] },
    outBatsmen: { type: [String], default: [] },
    currentInnings: { type: Number, default: 1 },
    extraRuns: { type: Number, default: 0 },
  },
  { _id: false }
)

// Rest of schema remains the same...
const matchSchema = new mongoose.Schema(
  {
    createdBy: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
      required: true,
    },
    status: {
      type: String,
      enum: ['upcoming', 'live', 'completed'],
      default: 'upcoming',
    },
    startTime: { type: Date, required: true },
    venue: { type: String, required: true },
    overs: { type: Number, required: true },

    teamOne: teamSchema,
    teamTwo: teamSchema,

    // ‚úÖ VERIFY THESE EXIST
    toss_winner: { type: String, default: null },
    toss_decision: { type: String, default: null },
    batting_team: { type: String, default: null },
    bowling_team: { type: String, default: null },
    currentInnings: { type: Number, default: 1 },
    target: { type: Number, default: null },

    isPrivate: { type: Boolean, default: false },
    admins: [{ type: mongoose.Schema.Types.ObjectId, ref: 'User' }],
    scorers: [{ type: mongoose.Schema.Types.ObjectId, ref: 'User' }],
    viewers: [{ type: mongoose.Schema.Types.ObjectId, ref: 'User' }],
    
    matchCode: { 
      type: String, 
      unique: true,
      default: () => generateMatchCode(),
    },

    // ‚úÖ VERIFY THESE EXIST
    scoringState: {
      type: scoringStateSchema,
      default: null,
    },

    ballHistory: {
      type: [ballSchema],
      default: [],
    },
  },
  {
    timestamps: true,
  }
)

// ‚úÖ Clear cached model
if (mongoose.models.Match) {
  delete mongoose.models.Match
}

const Match = mongoose.model<IMatch>('Match', matchSchema)

export default Match

===== FILE: models/User.ts =====
import mongoose, { Schema, Document, Model } from 'mongoose';
import bcrypt from 'bcryptjs';

export interface IUser extends Document {
  name: string;
  email: string;
  password: string;
  avatar?: string;
  createdMatches: mongoose.Types.ObjectId[];
  joinedMatches: mongoose.Types.ObjectId[];
  createdAt: Date;
  updatedAt: Date;
  comparePassword(password: string): Promise<boolean>;
}

const userSchema = new Schema<IUser>({
  name: {
    type: String,
    required: true,
    trim: true,
  },
  email: {
    type: String,
    required: true,
    unique: true,
    lowercase: true,
  },
  password: {
    type: String,
    required: true,
    select: false,
  },
  avatar: String,
  createdMatches: [{
    type: Schema.Types.ObjectId,
    ref: 'Match'
  }],
  joinedMatches: [{
    type: Schema.Types.ObjectId,
    ref: 'Match'
  }],
}, {
  timestamps: true
});

userSchema.methods.comparePassword = async function(password: string) {
  return bcrypt.compare(password, this.password);
};

// Prevent model recompilation in development
const User = (mongoose.models.User as Model<IUser>) || mongoose.model<IUser>('User', userSchema);

export default User;

===== FILE: lib/api-client.ts =====
class ApiClient {
  private token: string | null = null;

  constructor() {
    if (typeof window !== 'undefined') {
      this.token = localStorage.getItem('auth_token');
    }
  }

  private async request(endpoint: string, options: RequestInit = {}) {
    const url = `/api${endpoint}`;
    
    const config: RequestInit = {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...(this.token && { Authorization: `Bearer ${this.token}` }),
        ...options.headers,
      },
    };

    const response = await fetch(url, config);
    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.error || 'Request failed');
    }

    return data;
  }

  async login(email: string, password: string) {
    const response = await this.request('/auth/login', {
      method: 'POST',
      body: JSON.stringify({ email, password }),
    });
    
    this.token = response.token;
    localStorage.setItem('auth_token', response.token);
    return response;
  }

  async register(name: string, email: string, password: string) {
    const response = await this.request('/auth/register', {
      method: 'POST',
      body: JSON.stringify({ name, email, password }),
    });
    
    this.token = response.token;
    localStorage.setItem('auth_token', response.token);
    return response;
  }

  async createMatch(matchData: any) {
    return this.request('/matches', {
      method: 'POST',
      body: JSON.stringify(matchData),
    });
  }

  async getMatch(id: string) {
    return this.request(`/matches/${id}`);
  }

  async getUserMatches() {
    return this.request('/matches');
  }

  logout() {
    this.token = null;
    localStorage.removeItem('auth_token');
    localStorage.removeItem('user');
  }
}

export default new ApiClient();

===== FILE: lib/auth.ts =====
import { NextRequest } from 'next/server';
import jwt from 'jsonwebtoken';

export interface UserToken {
  userId: string;
  email: string;
}

export async function verifyToken(request: NextRequest): Promise<UserToken | null> {
  try {
    // Check both Authorization header and cookie (like middleware does)
    const token = request.headers.get('authorization')?.replace('Bearer ', '') ||
                  request.cookies.get('auth-token')?.value;
    
    if (!token) {
      return null;
    }

    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as UserToken;
    return decoded;
  } catch (error) {
    return null;
  }
}

===== FILE: lib/db.ts =====
import mongoose from 'mongoose';

const MONGODB_URI = process.env.MONGODB_URI!;

if (!MONGODB_URI) {
  throw new Error('Please define the MONGODB_URI environment variable');
}

interface MongooseCache {
  conn: typeof mongoose | null;
  promise: Promise<typeof mongoose> | null;
}

declare global {
  var mongoose: MongooseCache | undefined;
}

const cached = global.mongoose || { conn: null, promise: null };

if (!global.mongoose) {
  global.mongoose = cached;
}

export async function connectDB() {
  if (cached.conn) {
    return cached.conn;
  }

  if (!cached.promise) {
    const opts = {
      bufferCommands: false,
    };

    cached.promise = mongoose.connect(MONGODB_URI, opts);
  }

  try {
    cached.conn = await cached.promise;
  } catch (e) {
    cached.promise = null;
    throw e;
  }

  return cached.conn;
}

===== FILE: lib/pusher-client.ts =====
import PusherClient from 'pusher-js'

export const pusherClient = new PusherClient(
  process.env.NEXT_PUBLIC_PUSHER_KEY!,
  {
    cluster: process.env.NEXT_PUBLIC_PUSHER_CLUSTER!,
  }
)

===== FILE: lib/pusher.ts =====
import Pusher from 'pusher';
import PusherClient from 'pusher-js';

// Server-side Pusher
export const pusherServer = new Pusher({
  appId: process.env.PUSHER_APP_ID!,
  key: process.env.NEXT_PUBLIC_PUSHER_KEY!,
  secret: process.env.PUSHER_SECRET!,
  cluster: process.env.NEXT_PUBLIC_PUSHER_CLUSTER!,
  useTLS: true,
});

// Client-side Pusher
export const pusherClient = new PusherClient(
  process.env.NEXT_PUBLIC_PUSHER_KEY!,
  {
    cluster: process.env.NEXT_PUBLIC_PUSHER_CLUSTER!,
  }
);

===== FILE: lib/utils.ts =====
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

===== FILE: app/globals.css =====
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --radius: 0.75rem;
  }
}


@layer utilities {


  .text-balance {
    text-wrap: balance;
  }


  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes zoom-in {
    from {
      transform: scale(0.95);
    }
    to {
      transform: scale(1);
    }
  }

  .animate-in {
    animation-duration: 200ms;
    animation-fill-mode: both;
  }

  .fade-in {
    animation-name: fade-in;
  }

  .zoom-in {
    animation-name: zoom-in;
  }

  .duration-200 {
    animation-duration: 200ms;
  }
}

@media print {
  /* Hide non-essential elements */
  nav, header, .print\\:hidden {
    display: none !important;
  }
  
  /* Ensure colors print */
  * {
    print-color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
  }
  
  /* Prevent page breaks in tables */
  table {
    page-break-inside: avoid;
  }
  
  /* Add page margins */
  @page {
    margin: 1cm;
  }
}

/* Smooth scrolling */
html {
  scroll-behavior: smooth;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #d1d5db;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}

===== FILE: app/layout.tsx =====
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ 
  subsets: ['latin'],
  variable: '--font-inter',
})

export const metadata: Metadata = {
  title: 'Local League Cricket Scoreboard - Bring Local Cricket Online',
  description: 'Create, manage, and share live scorecards for your local leagues and friendly matches.',
  keywords: 'cricket, scoreboard, local cricket, live scores, cricket app, match scoring',
  authors: [{ name: 'Local League Cricket' }],
  openGraph: {
    title: 'Local League Cricket Scoreboard',
    description: 'Create, manage, and share live scorecards for your local leagues and friendly matches.',
    url: 'https://localleaguecricket.com',
    siteName: 'Local League Cricket Scoreboard',
    images: [
      {
        url: '/og-image.png',
        width: 1200,
        height: 630,
        alt: 'Local League Cricket Scoreboard',
      },
    ],
    locale: 'en_US',
    type: 'website',
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Local League Cricket Scoreboard',
    description: 'Create, manage, and share live scorecards for your local leagues and friendly matches.',
    images: ['/og-image.png'],
  },
  robots: {
    index: true,
    follow: true,
  },
  viewport: 'width=device-width, initial-scale=1',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en" className={inter.variable}>
      <body className="font-sans antialiased bg-white text-gray-900">
        {children}
      </body>
    </html>
  )
}

===== FILE: app/page.tsx =====
import Hero from '@/components/sections/Hero'
import Features from '@/components/sections/Features'
import HowItWorks from '@/components/sections/HowItWorks'
import LiveMatchPreview from '@/components/sections/LiveMatchPreview'
import AdminUserAccess from '@/components/sections/AdminUserAccess'
import CallToAction from '@/components/sections/CallToAction'
import Footer from '@/components/sections/Footer'

export default function Home() {
  return (
    <main className="min-h-screen">
      <Hero />
      <Features />
      <HowItWorks />
      <LiveMatchPreview />
      <AdminUserAccess />
      <CallToAction />
      <Footer />
    </main>
  )
}

===== FILE: app/(auth)/login/page.tsx =====
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import { motion } from 'framer-motion'
import { Mail, Lock, ArrowRight } from 'lucide-react'
import toast, { Toaster } from 'react-hot-toast'

export default function LoginPage() {
  const router = useRouter()
  const [loading, setLoading] = useState(false)
  const [formData, setFormData] = useState({
    email: '',
    password: ''
  })

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    try {
      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      })

      const data = await res.json()

      if (!res.ok) {
        throw new Error(data.error || 'Invalid credentials')
      }

      // Store token and user data
      localStorage.setItem('auth_token', data.token)
      localStorage.setItem('user', JSON.stringify(data.user))
      
      toast.success('Welcome back!')
      
      // Redirect to dashboard
      console.log('Redirecting to dashboard...')
      setTimeout(() => {
        console.log('Pushing route...')
        // router.push('/dashboard')
        // router.replace('/dashboard')
        window.location.href = '/dashboard'
      }, 1000)
    } catch (error) {
      toast.error(error instanceof Error ? error.message : 'Login failed')
    } finally {
      setLoading(false)
    }
  }

  return (
    <>
      <Toaster position="top-center" />
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50 p-4">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-gray-100"
        >
          {/* Logo */}
          <div className="text-center mb-8">
            <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-400 rounded-2xl mb-4">
              <span className="text-3xl">üèè</span>
            </div>
            <h1 className="text-3xl font-bold text-gray-900">Welcome Back</h1>
            <p className="text-gray-600 mt-2">Sign in to manage your matches</p>
          </div>

          <form onSubmit={handleSubmit} className="space-y-5">
            {/* Email Field */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Email Address
              </label>
              <div className="relative">
                <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                <input
                  type="email"
                  required
                  value={formData.email}
                  onChange={(e) => setFormData({...formData, email: e.target.value})}
                  className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                  placeholder="you@example.com"
                />
              </div>
            </div>

            {/* Password Field */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Password
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                <input
                  type="password"
                  required
                  value={formData.password}
                  onChange={(e) => setFormData({...formData, password: e.target.value})}
                  className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                />
              </div>
            </div>

            {/* Remember & Forgot */}
            <div className="flex items-center justify-between">
              <label className="flex items-center">
                <input type="checkbox" className="rounded border-gray-300 text-green-600 focus:ring-green-500" />
                <span className="ml-2 text-sm text-gray-600">Remember me</span>
              </label>
              <Link href="/forgot-password" className="text-sm text-green-600 hover:text-green-700">
                Forgot password?
              </Link>
            </div>

            {/* Submit Button */}
            <Button
              type="submit"
              disabled={loading}
              className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white py-2.5 rounded-xl font-medium transition-all flex items-center justify-center gap-2"
            >
              {loading ? (
                <>
                  <span className="h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                  Signing in...
                </>
              ) : (
                <>
                  Sign In
                  <ArrowRight className="h-5 w-5" />
                </>
              )}
            </Button>
          </form>

          {/* Divider */}
          <div className="relative my-6">
            <div className="absolute inset-0 flex items-center">
              <div className="w-full border-t border-gray-200"></div>
            </div>
            <div className="relative flex justify-center text-sm">
              <span className="px-4 bg-white text-gray-500">or</span>
            </div>
          </div>

          {/* Register Link */}
          <p className="text-center text-sm text-gray-600">
            Don't have an account?{' '}
            <Link href="/register" className="text-green-600 hover:text-green-700 font-medium transition-colors">
              Sign up for free
            </Link>
          </p>
        </motion.div>
      </div>
    </>
  )
}

===== FILE: app/(auth)/register/page.tsx =====
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import { motion } from 'framer-motion'
import { User, Mail, Lock, ArrowRight, Cricket } from 'lucide-react'
import toast, { Toaster } from 'react-hot-toast'

export default function RegisterPage() {
  const router = useRouter()
  const [loading, setLoading] = useState(false)
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    confirmPassword: ''
  })

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    // Validation
    if (formData.password !== formData.confirmPassword) {
      toast.error('Passwords do not match')
      return
    }

    if (formData.password.length < 6) {
      toast.error('Password must be at least 6 characters')
      return
    }

    setLoading(true)

    try {
      const res = await fetch('/api/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: formData.name,
          email: formData.email,
          password: formData.password
        })
      })

      const data = await res.json()

      if (!res.ok) {
        throw new Error(data.error || 'Registration failed')
      }

      // Store token
      localStorage.setItem('auth_token', data.token)
      localStorage.setItem('user', JSON.stringify(data.user))
      
      toast.success('Account created successfully!')
      
      // Redirect to dashboard
      setTimeout(() => {
        router.push('/dashboard')
      }, 1000)
    } catch (error) {
      toast.error(error instanceof Error ? error.message : 'Registration failed')
    } finally {
      setLoading(false)
    }
  }

  return (
    <>
      <Toaster position="top-center" />
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50 p-4">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-gray-100"
        >
          {/* Logo */}
          <div className="text-center mb-8">
            <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-400 rounded-2xl mb-4">
              <span className="text-3xl">üèè</span>
            </div>
            <h1 className="text-3xl font-bold text-gray-900">Create Account</h1>
            <p className="text-gray-600 mt-2">Join Local League Cricket today</p>
          </div>

          <form onSubmit={handleSubmit} className="space-y-5">
            {/* Name Field */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Full Name
              </label>
              <div className="relative">
                <User className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                <input
                  type="text"
                  required
                  value={formData.name}
                  onChange={(e) => setFormData({...formData, name: e.target.value})}
                  className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                  placeholder="John Doe"
                />
              </div>
            </div>

            {/* Email Field */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Email Address
              </label>
              <div className="relative">
                <Mail className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                <input
                  type="email"
                  required
                  value={formData.email}
                  onChange={(e) => setFormData({...formData, email: e.target.value})}
                  className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                  placeholder="you@example.com"
                />
              </div>
            </div>

            {/* Password Field */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Password
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                <input
                  type="password"
                  required
                  value={formData.password}
                  onChange={(e) => setFormData({...formData, password: e.target.value})}
                  className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  minLength={6}
                />
              </div>
            </div>

            {/* Confirm Password Field */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Confirm Password
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                <input
                  type="password"
                  required
                  value={formData.confirmPassword}
                  onChange={(e) => setFormData({...formData, confirmPassword: e.target.value})}
                  className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  minLength={6}
                />
              </div>
            </div>

            {/* Submit Button */}
            <Button
              type="submit"
              disabled={loading}
              className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white py-2.5 rounded-xl font-medium transition-all flex items-center justify-center gap-2"
            >
              {loading ? (
                <>
                  <span className="h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                  Creating Account...
                </>
              ) : (
                <>
                  Sign Up
                  <ArrowRight className="h-5 w-5" />
                </>
              )}
            </Button>
          </form>

          {/* Divider */}
          <div className="relative my-6">
            <div className="absolute inset-0 flex items-center">
              <div className="w-full border-t border-gray-200"></div>
            </div>
            <div className="relative flex justify-center text-sm">
              <span className="px-4 bg-white text-gray-500">or</span>
            </div>
          </div>

          {/* Login Link */}
          <p className="text-center text-sm text-gray-600">
            Already have an account?{' '}
            <Link href="/login" className="text-green-600 hover:text-green-700 font-medium transition-colors">
              Sign in
            </Link>
          </p>
        </motion.div>
      </div>
    </>
  )
}

===== FILE: app/api/auth/login/route.ts =====
import { NextRequest, NextResponse } from 'next/server';
import bcrypt from 'bcryptjs';
import jwt from 'jsonwebtoken';
import { connectDB } from '@/lib/db';
import User from '@/models/User';

export async function POST(request: NextRequest) {
  try {
    await connectDB();
    
    const body = await request.json();
    const { email, password } = body;

    if (!email || !password) {
      return NextResponse.json(
        { error: 'Email and password are required' },
        { status: 400 }
      );
    }

    const user = await User.findOne({ email: email.toLowerCase() }).select('+password');
    
    if (!user) {
      return NextResponse.json(
        { error: 'Invalid email or password' },
        { status: 401 }
      );
    }

    const isPasswordValid = await bcrypt.compare(password, user.password);
    
    if (!isPasswordValid) {
      return NextResponse.json(
        { error: 'Invalid email or password' },
        { status: 401 }
      );
    }

    const token = jwt.sign(
      { userId: user._id.toString(), email: user.email },
      process.env.JWT_SECRET!,
      { expiresIn: '7d' }
    );

    // Create response
    const response = NextResponse.json({
      success: true,
      token,
      user: {
        id: user._id.toString(),
        name: user.name,
        email: user.email
      }
    });

    // Set cookie for middleware to read
    response.cookies.set({
      name: 'auth-token',
      value: token,
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'lax',
      maxAge: 60 * 60 * 24 * 7, // 7 days
      path: '/',
    });

    return response;

  } catch (error) {
    console.error('Login error:', error);
    return NextResponse.json(
      { error: 'Failed to sign in. Please try again.' },
      { status: 500 }
    );
  }
}

===== FILE: app/api/auth/logout/route.ts =====
import { NextResponse } from 'next/server';

export async function POST() {
  const response = NextResponse.json({
    success: true,
    message: 'Logged out successfully'
  });

  // Clear the auth cookie
  response.cookies.set({
    name: 'auth-token',
    value: '',
    httpOnly: true,
    expires: new Date(0),
    path: '/',
  });

  return response;
}

===== FILE: app/api/auth/me/route.ts =====
import { NextRequest, NextResponse } from 'next/server';
import { connectDB } from '@/lib/db';
import User from '@/models/User';
import { verifyToken } from '@/lib/auth';

export async function GET(request: NextRequest) {
  try {
    const user = await verifyToken(request);
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    await connectDB();
    
    const userData = await User.findById(user.userId)
      .select('-password')
      .populate('createdMatches', 'matchCode teamOne teamTwo status')
      .populate('joinedMatches', 'matchCode teamOne teamTwo status');

    if (!userData) {
      return NextResponse.json({ error: 'User not found' }, { status: 404 });
    }

    return NextResponse.json({
      success: true,
      user: userData
    });

  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to fetch user data' },
      { status: 500 }
    );
  }
}

===== FILE: app/api/auth/register/route.ts =====
import { NextRequest, NextResponse } from 'next/server';
import bcrypt from 'bcryptjs';
import jwt from 'jsonwebtoken';
import { connectDB } from '@/lib/db';
import User from '@/models/User';

export async function POST(request: NextRequest) {
  try {
    // Connect to database
    await connectDB();
    
    // Get request body
    const body = await request.json();
    const { name, email, password } = body;

    // Validation
    if (!name || !email || !password) {
      return NextResponse.json(
        { error: 'All fields are required' },
        { status: 400 }
      );
    }

    if (password.length < 6) {
      return NextResponse.json(
        { error: 'Password must be at least 6 characters' },
        { status: 400 }
      );
    }

    // Check if user already exists
    const existingUser = await User.findOne({ email: email.toLowerCase() });
    if (existingUser) {
      return NextResponse.json(
        { error: 'User already exists with this email' },
        { status: 400 }
      );
    }

    // Hash password
    const salt = await bcrypt.genSalt(10);
    const hashedPassword = await bcrypt.hash(password, salt);

    // Create new user
    const user = await User.create({
      name,
      email: email.toLowerCase(),
      password: hashedPassword
    });

    // Generate JWT token
    const token = jwt.sign(
      { userId: user._id.toString(), email: user.email },
      process.env.JWT_SECRET!,
      { expiresIn: '7d' }
    );

    // Return success response
    return NextResponse.json({
      success: true,
      token,
      user: {
        id: user._id.toString(),
        name: user.name,
        email: user.email
      }
    }, { status: 201 });

  } catch (error) {
    console.error('Registration error:', error);
    return NextResponse.json(
      { error: 'Failed to create account. Please try again.' },
      { status: 500 }
    );
  }
}

===== FILE: app/api/health/route.ts =====
import { NextResponse } from 'next/server';
import { connectDB } from '@/lib/db';

export async function GET() {
  try {
    await connectDB();
    return NextResponse.json({
      status: 'healthy',
      database: 'connected',
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    return NextResponse.json({
      status: 'error',
      database: 'disconnected',
      error: error instanceof Error ? error.message : 'Unknown error'
    }, { status: 500 });
  }
}

===== FILE: app/api/leaderboard/route.ts =====
import { NextRequest, NextResponse } from 'next/server';
import { connectDB } from '@/lib/db';
import Match from '@/models/Match';

export async function GET(request: NextRequest) {
  try {
    await connectDB();

    // Fetch all completed matches
    const matches = await Match.find({ status: 'completed' }).lean();

    if (!matches || matches.length === 0) {
      return NextResponse.json({
        battingStats: [],
        bowlingStats: []
      });
    }

    // Aggregate player statistics and team statistics
    const playerStatsMap = new Map();
    const teamStatsMap = new Map();

    matches.forEach((match: any) => {
      const teams = [match.teamOne, match.teamTwo];
      
      // Determine match winner for team stats
      let winnerTeam = null;
      let loserTeam = null;
      
      if (match.result && match.result.winner) {
        if (match.result.winner === 'team_one') {
          winnerTeam = match.teamOne;
          loserTeam = match.teamTwo;
        } else if (match.result.winner === 'team_two') {
          winnerTeam = match.teamTwo;
          loserTeam = match.teamOne;
        }
      }

      teams.forEach((team, index) => {
        if (!team?.players) return;
        
        // Team Statistics
        const teamName = team.name;
        if (!teamStatsMap.has(teamName)) {
          teamStatsMap.set(teamName, {
            name: teamName,
            matches: new Set(),
            wins: 0,
            losses: 0,
            totalRuns: 0,
            highestScore: 0,
            totalWickets: 0,
            matchScores: []
          });
        }

        const teamStats = teamStatsMap.get(teamName);
        teamStats.matches.add(match._id.toString());
        
        if (winnerTeam && winnerTeam.name === teamName) {
          teamStats.wins += 1;
        } else if (loserTeam && loserTeam.name === teamName) {
          teamStats.losses += 1;
        }
        
        const teamScore = team.total_score || 0;
        teamStats.totalRuns += teamScore;
        teamStats.highestScore = Math.max(teamStats.highestScore, teamScore);
        teamStats.totalWickets += team.total_wickets || 0;
        teamStats.matchScores.push(teamScore);

        // Player Statistics
        team.players.forEach((player: any) => {
          const playerName = player.name;

          if (!playerStatsMap.has(playerName)) {
            playerStatsMap.set(playerName, {
              name: playerName,
              matches: new Set(),
              totalRuns: 0,
              totalBalls: 0,
              timesOut: 0,
              fours: 0,
              sixes: 0,
              wickets: 0,
              highScore: 0,
              ballsBowled: 0,
              runsConceded: 0,
              innings: 0,
            });
          }

          const stats = playerStatsMap.get(playerName);

          // Add match ID to set (for unique match count)
          stats.matches.add(match._id.toString());

          // Batting stats
          if (player.balls_played > 0) {
            stats.innings += 1;
          }
          stats.totalRuns += player.runs_scored || 0;
          stats.totalBalls += player.balls_played || 0;
          stats.timesOut += player.is_out ? 1 : 0;
          stats.fours += player.fours || 0;
          stats.sixes += player.sixes || 0;
          stats.highScore = Math.max(stats.highScore, player.runs_scored || 0);

          // Bowling stats
          stats.wickets += player.wickets || 0;
        });
      });
    });

    // Calculate batting leaderboard

    const battingStats = Array.from(playerStatsMap.values())
      .filter((stats) => stats.totalBalls > 0) // Only players who have batted
      .map((stats) => {
        const average = stats.timesOut > 0
          ? (stats.totalRuns / stats.timesOut).toFixed(2)
          : stats.totalRuns.toFixed(2);

        const strikeRate = stats.totalBalls > 0
          ? ((stats.totalRuns / stats.totalBalls) * 100).toFixed(2)
          : '0.00';

        return {
          name: stats.name,
          matches: stats.matches.size,
          innings: stats.innings,
          runs: stats.totalRuns,
          average: parseFloat(average),
          strikeRate: parseFloat(strikeRate),
          fours: stats.fours,
          sixes: stats.sixes,
          highScore: stats.highScore,
        };
      })
      .sort((a, b) => b.runs - a.runs)
      .slice(0, 10);

    // Calculate bowling stats
    const bowlingStats = Array.from(playerStatsMap.values())
      .filter((stats) => stats.wickets > 0 || stats.balls_bowled > 0)
      .map((stats) => {
        const overs = stats.balls_bowled > 0
          ? Math.floor(stats.balls_bowled / 6) + (stats.balls_bowled % 6) / 10
          : 0

        const economy = stats.balls_bowled > 0
          ? ((stats.runs_conceded / stats.balls_bowled) * 6).toFixed(2)
          : '0.00'

        const average = stats.wickets > 0
          ? (stats.runs_conceded / stats.wickets).toFixed(2)
          : '0.00'

        return {
          name: stats.name,
          matches: stats.matches.size,
          wickets: stats.wickets,
          overs: overs.toFixed(1),
          runs_conceded: stats.runs_conceded,
          economy: parseFloat(economy),
          average: parseFloat(average),
          maidens: stats.maidens,
          dot_balls: stats.dot_balls,
          bestBowling: stats.wickets,
        };
      })
      .sort((a, b) => b.wickets - a.wickets)
      .slice(0, 10);

    // Calculate team leaderboard
    const teamStats = Array.from(teamStatsMap.values())
      .map((stats) => {
        const matches = stats.matches.size;
        const winRate = matches > 0 ? Math.round((stats.wins / matches) * 100) : 0;
        const averageScore = stats.matchScores.length > 0 
          ? Math.round(stats.totalRuns / stats.matchScores.length) 
          : 0;

        return {
          name: stats.name,
          matches: matches,
          wins: stats.wins,
          losses: stats.losses,
          winRate: winRate,
          totalRuns: stats.totalRuns,
          averageScore: averageScore,
          highestScore: stats.highestScore,
          totalWickets: stats.totalWickets,
        };
      })
      .sort((a, b) => {
        // Sort by win rate first, then by wins
        if (b.winRate !== a.winRate) return b.winRate - a.winRate;
        return b.wins - a.wins;
      })
      .slice(0, 10);


    return NextResponse.json({
      battingStats,
      bowlingStats,
      teamStats,
      totalMatches: matches.length
    });

  } catch (error: any) {
    console.error('Leaderboard API Error:', error);
    return NextResponse.json(
      { error: 'Failed to fetch leaderboard data', message: error.message },
      { status: 500 }
    );
  }
}

===== FILE: app/api/matches/route.ts =====
import { NextRequest, NextResponse } from 'next/server';
import { connectDB } from '@/lib/db';
import Match from '@/models/Match';
import User from '@/models/User';
import { verifyToken } from '@/lib/auth';



// GET - Fetch user's matches
export async function GET(request: NextRequest) {
  try {
    const user = await verifyToken(request);
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    await connectDB();

    // Matches created by user
    const createdMatches = await Match.find({ 
      createdBy: user.userId 
    })
    .sort({ createdAt: -1 })
    .lean();
    
    // Matches where user is invited (admin, scorer, or viewer)
    const invitedMatches = await Match.find({ 
      $and: [
        { createdBy: { $ne: user.userId } },
        {
          $or: [
            { admins: user.userId },
            { scorers: user.userId },
            { viewers: user.userId }
          ]
        }
      ]
    })
    .sort({ createdAt: -1 })
    .lean();

    // Format matches for easier display
    const formatMatch = (match: any) => {
      // Calculate total balls from players if total_balls doesn't exist
      const calculateBalls = (team: any) => {
        if (team.total_balls !== undefined && team.total_balls !== null) {
          return team.total_balls;
        }
        // Sum up all players' balls_played
        return team.players?.reduce((total: number, player: any) => {
          return total + (player.balls_played || 0);
        }, 0) || 0;
      };

      const teamOneBalls = calculateBalls(match.teamOne);
      const teamTwoBalls = calculateBalls(match.teamTwo);

      return {
        ...match,
        _id: match._id.toString(),
        teamOne: {
          ...match.teamOne,
          total_balls: teamOneBalls,
          overs: `${Math.floor(teamOneBalls / 6)}.${teamOneBalls % 6}`
        },
        teamTwo: {
          ...match.teamTwo,
          total_balls: teamTwoBalls,
          overs: `${Math.floor(teamTwoBalls / 6)}.${teamTwoBalls % 6}`
        }
      };
    };

    return NextResponse.json({
      success: true,
      data: {
        created: createdMatches.map(formatMatch),
        invited: invitedMatches.map(formatMatch)
      }
    });
  } catch (error) {
    console.error('Fetch matches error:', error);
    return NextResponse.json(
      { error: 'Failed to fetch matches' },
      { status: 500 }
    );
  }
}

// POST - Create new match
export async function POST(request: NextRequest) {
  try {
    const user = await verifyToken(request);
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    await connectDB();
    
    const matchData = await request.json();

    // Create match with generated code
    const match = await Match.create({
      ...matchData,
      createdBy: user.userId,
      admins: [user.userId],
      scorers: [user.userId],
      status: 'upcoming'
    });

    // Update user's created matches
    await User.findByIdAndUpdate(user.userId, {
      $push: { createdMatches: match._id }
    });

    return NextResponse.json({
      success: true,
      data: match
    }, { status: 201 });

  } catch (error) {
    console.error('Create match error:', error);
    return NextResponse.json(
      { error: 'Failed to create match' },
      { status: 500 }
    );
  }
}

===== FILE: app/api/matches/[id]/route.ts =====
import { NextRequest, NextResponse } from 'next/server'
import { connectDB } from '@/lib/db'
import Match from '@/models/Match'
import { verifyToken } from '@/lib/auth'

interface Params {
  params: { id: string }
}

// GET single match
export async function GET(request: NextRequest, { params }: Params) {
  try {
    const user = await verifyToken(request)
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    await connectDB()

    // ‚úÖ Use .lean() to get plain object and include ALL fields
    const match = await Match.findById(params.id).lean()

    if (!match) {
      return NextResponse.json({ error: 'Match not found' }, { status: 404 })
    }

    // ‚úÖ Debug: Log player stats to verify they're being retrieved
    const teamOnePlayerStats = (match.teamOne?.players || []).map((p: any) => ({
      name: p.name,
      runs_scored: p.runs_scored,
      balls_played: p.balls_played,
      fours: p.fours,
      sixes: p.sixes,
      wickets: p.wickets,
      balls_bowled: p.balls_bowled,
      runs_conceded: p.runs_conceded,
      is_out: p.is_out,
    }))
    
    const teamTwoPlayerStats = (match.teamTwo?.players || []).map((p: any) => ({
      name: p.name,
      runs_scored: p.runs_scored,
      balls_played: p.balls_played,
      fours: p.fours,
      sixes: p.sixes,
      wickets: p.wickets,
      balls_bowled: p.balls_bowled,
      runs_conceded: p.runs_conceded,
      is_out: p.is_out,
    }))

    console.log('üì• [GET] Fetched match from DB:', {
      id: match._id,
      tossWinner: match.toss_winner,
      battingTeam: match.batting_team,
      scoringState: match.scoringState,
      teamOne: {
        name: match.teamOne?.name,
        total_score: match.teamOne?.total_score,
        players_count: match.teamOne?.players?.length || 0,
        player_stats: teamOnePlayerStats,
      },
      teamTwo: {
        name: match.teamTwo?.name,
        total_score: match.teamTwo?.total_score,
        players_count: match.teamTwo?.players?.length || 0,
        player_stats: teamTwoPlayerStats,
      },
    })

    // ‚úÖ Ensure player arrays are properly included in response
    // Convert to plain object to ensure proper JSON serialization
    const matchData = {
      ...match,
      teamOne: match.teamOne ? {
        ...match.teamOne,
        players: (match.teamOne.players || []).map((p: any) => ({
          ...p,
          runs_scored: p.runs_scored || 0,
          balls_played: p.balls_played || 0,
          fours: p.fours || 0,
          sixes: p.sixes || 0,
          wickets: p.wickets || 0,
          balls_bowled: p.balls_bowled || 0,
          runs_conceded: p.runs_conceded || 0,
          maidens: p.maidens || 0,
          dots: p.dots || 0,
          dot_balls: p.dot_balls || 0,
          is_out: p.is_out || false,
          is_captain: p.is_captain || false,
          is_keeper: p.is_keeper || false,
        })),
      } : match.teamOne,
      teamTwo: match.teamTwo ? {
        ...match.teamTwo,
        players: (match.teamTwo.players || []).map((p: any) => ({
          ...p,
          runs_scored: p.runs_scored || 0,
          balls_played: p.balls_played || 0,
          fours: p.fours || 0,
          sixes: p.sixes || 0,
          wickets: p.wickets || 0,
          balls_bowled: p.balls_bowled || 0,
          runs_conceded: p.runs_conceded || 0,
          maidens: p.maidens || 0,
          dots: p.dots || 0,
          dot_balls: p.dot_balls || 0,
          is_out: p.is_out || false,
          is_captain: p.is_captain || false,
          is_keeper: p.is_keeper || false,
        })),
      } : match.teamTwo,
    }

    // ‚úÖ Return the FULL match object with properly serialized player stats
    return NextResponse.json({
      success: true,
      data: matchData,
    })
  } catch (error) {
    console.error('Get match error:', error)
    return NextResponse.json(
      { error: 'Failed to get match' },
      { status: 500 }
    )
  }
}

// PUT/PATCH - Update match (if needed)
export async function PUT(request: NextRequest, { params }: Params) {
  try {
    const user = await verifyToken(request)
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    await connectDB()

    const body = await request.json()

    const match = await Match.findByIdAndUpdate(
      params.id,
      { $set: body },
      { new: true, runValidators: false }
    )

    if (!match) {
      return NextResponse.json({ error: 'Match not found' }, { status: 404 })
    }

    return NextResponse.json({
      success: true,
      data: match,
    })
  } catch (error) {
    console.error('Update match error:', error)
    return NextResponse.json(
      { error: 'Failed to update match' },
      { status: 500 }
    )
  }
}

===== FILE: app/api/matches/[id]/debug/route.ts =====
import { NextRequest, NextResponse } from 'next/server'
import { connectDB } from '@/lib/db'
import Match from '@/models/Match'

interface Params {
  params: { id: string }
}

export async function GET(request: NextRequest, { params }: Params) {
  try {
    await connectDB()

    const match = await Match.findById(params.id).lean()

    if (!match) {
      return NextResponse.json({ error: 'Match not found' }, { status: 404 })
    }

    // Return EVERYTHING for debugging
    return NextResponse.json({
      success: true,
      data: {
        _id: match._id,
        matchCode: match.matchCode,
        status: match.status,
        
        // ‚úÖ Toss data
        toss_winner: match.toss_winner,
        toss_decision: match.toss_decision,
        batting_team: match.batting_team,
        bowling_team: match.bowling_team,
        
        // ‚úÖ Scoring state
        scoringState: match.scoringState,
        
        // ‚úÖ Ball history
        ballHistory: match.ballHistory,
        
        // ‚úÖ Team scores
        teamOne: {
          name: match.teamOne.name,
          total_score: match.teamOne.total_score,
          total_wickets: match.teamOne.total_wickets,
          total_balls: match.teamOne.total_balls,
          extras: match.teamOne.extras,
        },
        teamTwo: {
          name: match.teamTwo.name,
          total_score: match.teamTwo.total_score,
          total_wickets: match.teamTwo.total_wickets,
          total_balls: match.teamTwo.total_balls,
          extras: match.teamTwo.extras,
        },
        
        target: match.target,
        currentInnings: match.currentInnings,
      },
    })
  } catch (error) {
    console.error('Debug error:', error)
    return NextResponse.json(
      { error: 'Failed to get debug info' },
      { status: 500 }
    )
  }
}

===== FILE: app/api/matches/[id]/score/route.ts =====
import { NextRequest, NextResponse } from 'next/server'
import { connectDB } from '@/lib/db'
import Match from '@/models/Match'
import { verifyToken } from '@/lib/auth'

interface Params {
  params: { id: string }
}

export async function POST(request: NextRequest, { params }: Params) {
  const startTime = Date.now()

  try {
    console.log('üîµ [API] POST /api/matches/:id/score started')

    const user = await verifyToken(request)
    if (!user) {
      console.log('‚ùå [API] Unauthorized')
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
    }

    await connectDB()
    console.log('‚úÖ [API] Database connected')

    const existingMatch = await Match.findById(params.id)
    if (!existingMatch) {
      console.log('‚ùå [API] Match not found')
      return NextResponse.json({ error: 'Match not found' }, { status: 404 })
    }

    // Helper summarizers for concise diff logs
    const sumField = (arr: any[] = [], key: string) =>
      arr.reduce((a: number, p: any) => a + (Number(p?.[key]) || 0), 0)

    const summarizeTeam = (team: any) => {
      const players: any[] = Array.isArray(team?.players) ? team.players : []
      return {
        totals: {
          total_score: Number(team?.total_score) || 0,
          total_wickets: Number(team?.total_wickets) || 0,
          total_balls: Number(team?.total_balls) || 0,
        },
        players: {
          count: players.length,
          batting_runs: sumField(players, 'runs_scored'),
          batting_balls: sumField(players, 'balls_played'),
          fours: sumField(players, 'fours'),
          sixes: sumField(players, 'sixes'),
          outs: players.filter((p: any) => !!p?.is_out).length,
          bowling_balls: sumField(players, 'balls_bowled'),
          bowling_runs: sumField(players, 'runs_conceded'),
          bowling_wkts: sumField(players, 'wickets'),
          maidens: sumField(players, 'maidens'),
        },
      }
    }

    const beforeSummary = {
      root: {
        currentInnings: Number(existingMatch.currentInnings) || 0,
        batting_team: existingMatch.batting_team,
        bowling_team: existingMatch.bowling_team,
        target: Number(existingMatch.target) || 0,
        status: existingMatch.status,
      },
      teamOne: summarizeTeam(existingMatch.teamOne || {}),
      teamTwo: summarizeTeam(existingMatch.teamTwo || {}),
    }

    const isAuthorized =
      existingMatch.scorers.some((id: any) => id.toString() === user.userId) ||
      existingMatch.admins.some((id: any) => id.toString() === user.userId) ||
      existingMatch.createdBy.toString() === user.userId

    if (!isAuthorized) {
      console.log('‚ùå [API] User not authorized to score')
      return NextResponse.json(
        { error: 'Not authorized to score this match' },
        { status: 403 }
      )
    }

    // CHANGED: normalize body to support { match: {...} } and flat body
    const raw = await request.json()
    const body = raw?.match ?? raw
  

    const updateData: any = {}
    const before = {
      innings: existingMatch.currentInnings,
      bat: existingMatch.batting_team,
      bowl: existingMatch.bowling_team,
      target: existingMatch.target,
    }

    const isDefined = (v: any) => typeof v !== 'undefined'

    // Presence map for incoming payload
    const presenceMap = {
      totals: {
        t1: {
          score: isDefined(body['teamOne.total_score']),
          wickets: isDefined(body['teamOne.total_wickets']),
          balls: isDefined(body['teamOne.total_balls']),
        },
        t2: {
          score: isDefined(body['teamTwo.total_score']),
          wickets: isDefined(body['teamTwo.total_wickets']),
          balls: isDefined(body['teamTwo.total_balls']),
        },
      },
      players: {
        teamOne_nested: isDefined(body.teamOne?.players),
        teamTwo_nested: isDefined(body.teamTwo?.players),
        teamOne_flat: isDefined(body['teamOne.players']),
        teamTwo_flat: isDefined(body['teamTwo.players']),
      },
      scoringState: isDefined(body.scoringState),
      root: {
        batting_team: isDefined(body.batting_team),
        bowling_team: isDefined(body.bowling_team),
        currentInnings: isDefined(body.currentInnings),
        target: isDefined(body.target),
        status: isDefined(body.status),
      },
    }
    

    // Simple root fields
    if (isDefined(body.toss_winner)) updateData.toss_winner = body.toss_winner
    if (isDefined(body.toss_decision)) updateData.toss_decision = body.toss_decision
    if (isDefined(body.batting_team)) updateData.batting_team = body.batting_team
    if (isDefined(body.bowling_team)) updateData.bowling_team = body.bowling_team
    if (isDefined(body.status)) updateData.status = body.status
    // NEW: persist target at root
    if (isDefined(body.target)) updateData.target = body.target

    // NEW: normalize and persist currentInnings at root
    const normalizedInnings =
      (isDefined(body.currentInnings) ? body.currentInnings : undefined) ??
      (isDefined(body.scoringState?.currentInnings) ? body.scoringState.currentInnings : undefined) ??
      existingMatch.currentInnings

    updateData.currentInnings = normalizedInnings

    // Team score updates
    if (isDefined(body['teamOne.total_score'])) updateData['teamOne.total_score'] = body['teamOne.total_score']
    if (isDefined(body['teamOne.total_wickets'])) updateData['teamOne.total_wickets'] = body['teamOne.total_wickets']
    if (isDefined(body['teamOne.total_balls'])) updateData['teamOne.total_balls'] = body['teamOne.total_balls']
    if (isDefined(body['teamOne.extras'])) updateData['teamOne.extras'] = body['teamOne.extras']

    if (isDefined(body['teamTwo.total_score'])) updateData['teamTwo.total_score'] = body['teamTwo.total_score']
    if (isDefined(body['teamTwo.total_wickets'])) updateData['teamTwo.total_wickets'] = body['teamTwo.total_wickets']
    if (isDefined(body['teamTwo.total_balls'])) updateData['teamTwo.total_balls'] = body['teamTwo.total_balls']
    if (isDefined(body['teamTwo.extras'])) updateData['teamTwo.extras'] = body['teamTwo.extras']

    // Optional players - CRITICAL: Use proper MongoDB nested update syntax
    if (isDefined(body.teamOne?.players)) {
      updateData['teamOne.players'] = body.teamOne.players
      console.log('üìù [API] Updating teamOne.players:', {
        count: body.teamOne.players.length,
        sample: body.teamOne.players.slice(0, 2).map((p: any) => ({
          name: p.name,
          runs_scored: p.runs_scored,
          balls_played: p.balls_played,
          wickets: p.wickets,
        })),
      })
    }
    if (isDefined(body.teamTwo?.players)) {
      updateData['teamTwo.players'] = body.teamTwo.players
      console.log('üìù [API] Updating teamTwo.players:', {
        count: body.teamTwo.players.length,
        sample: body.teamTwo.players.slice(0, 2).map((p: any) => ({
          name: p.name,
          runs_scored: p.runs_scored,
          balls_played: p.balls_played,
          wickets: p.wickets,
        })),
      })
    }

    // NEW: also accept flattened keys (to match how totals are handled)
    if (isDefined(body['teamOne.players'])) {
      updateData['teamOne.players'] = body['teamOne.players']
      console.log('üìù [API] Updating teamOne.players (flat key):', {
        count: body['teamOne.players'].length,
      })
    }
    if (isDefined(body['teamTwo.players'])) {
      updateData['teamTwo.players'] = body['teamTwo.players']
      console.log('üìù [API] Updating teamTwo.players (flat key):', {
        count: body['teamTwo.players'].length,
      })
    }

    // CHANGED: scoringState forced to use normalizedInnings
    if (isDefined(body.scoringState)) {
      updateData.scoringState = {
        ...body.scoringState,
        currentInnings: normalizedInnings,
      }
    }

    // Optional ballHistory passthrough
    if (isDefined(body.ballHistory)) {
      updateData.ballHistory = body.ballHistory
    }

    // NEW: defensive auto-swap teams on innings change if client forgot
    const inningsChangedTo2 = before.innings !== 2 && normalizedInnings === 2
    const noTeamsProvided = !isDefined(body.batting_team) && !isDefined(body.bowling_team)
    if (inningsChangedTo2 && noTeamsProvided) {
      updateData.batting_team = before.bowl
      updateData.bowling_team = before.bat
      console.log('üîÑ [API] Auto-swapped teams for second innings:', {
        batting_team: updateData.batting_team,
        bowling_team: updateData.bowling_team,
      })
    }

    updateData.updatedAt = new Date()

    console.log('üìù [API] Update data (computed):', JSON.stringify(updateData, null, 2))

    const inningsSummary = {
      before,
      after: {
        innings: updateData.currentInnings,
        bat: updateData.batting_team ?? before.bat,
        bowl: updateData.bowling_team ?? before.bowl,
        target: updateData.target ?? before.target,
      },
    }
   

    const updatedMatch = await Match.findByIdAndUpdate(
      params.id,
      { $set: updateData },
      { new: true, runValidators: false }
    )

    if (!updatedMatch) {
      console.log('‚ùå [API] Failed to update match')
      return NextResponse.json(
        { error: 'Failed to update match' },
        { status: 500 }
      )
    }

    // ‚úÖ CRITICAL: Verify player stats were actually saved
    const verifyTeamOnePlayers = (updatedMatch.teamOne?.players || []).map((p: any) => ({
      name: p.name,
      runs_scored: p.runs_scored || 0,
      balls_played: p.balls_played || 0,
      fours: p.fours || 0,
      sixes: p.sixes || 0,
      wickets: p.wickets || 0,
      balls_bowled: p.balls_bowled || 0,
      runs_conceded: p.runs_conceded || 0,
      is_out: p.is_out || false,
    }))
    const verifyTeamTwoPlayers = (updatedMatch.teamTwo?.players || []).map((p: any) => ({
      name: p.name,
      runs_scored: p.runs_scored || 0,
      balls_played: p.balls_played || 0,
      fours: p.fours || 0,
      sixes: p.sixes || 0,
      wickets: p.wickets || 0,
      balls_bowled: p.balls_bowled || 0,
      runs_conceded: p.runs_conceded || 0,
      is_out: p.is_out || false,
    }))
    
    console.log('‚úÖ [API] Match updated - verifying player stats:', JSON.stringify({
      teamOne: {
        players_count: updatedMatch.teamOne?.players?.length || 0,
        player_stats: verifyTeamOnePlayers,
      },
      teamTwo: {
        players_count: updatedMatch.teamTwo?.players?.length || 0,
        player_stats: verifyTeamTwoPlayers,
      },
    }, null, 2))

    // AFTER UPDATE: Summaries and change diagnostics
    const afterSummary = {
      root: {
        currentInnings: Number(updatedMatch.currentInnings) || 0,
        batting_team: updatedMatch.batting_team,
        bowling_team: updatedMatch.bowling_team,
        target: Number(updatedMatch.target) || 0,
        status: updatedMatch.status,
      },
      teamOne: summarizeTeam(updatedMatch.teamOne || {}),
      teamTwo: summarizeTeam(updatedMatch.teamTwo || {}),
    }

    const fieldChange = (from: any, to: any) => ({ from, to, changed: from !== to })

    const changeSummary = {
      root: {
        currentInnings: fieldChange(beforeSummary.root.currentInnings, afterSummary.root.currentInnings),
        batting_team: fieldChange(beforeSummary.root.batting_team, afterSummary.root.batting_team),
        bowling_team: fieldChange(beforeSummary.root.bowling_team, afterSummary.root.bowling_team),
        target: fieldChange(beforeSummary.root.target, afterSummary.root.target),
        status: fieldChange(beforeSummary.root.status, afterSummary.root.status),
      },
      teamOne: {
        totals: {
          total_score: fieldChange(beforeSummary.teamOne.totals.total_score, afterSummary.teamOne.totals.total_score),
          total_wickets: fieldChange(beforeSummary.teamOne.totals.total_wickets, afterSummary.teamOne.totals.total_wickets),
          total_balls: fieldChange(beforeSummary.teamOne.totals.total_balls, afterSummary.teamOne.totals.total_balls),
        },
        players: {
          count: fieldChange(beforeSummary.teamOne.players.count, afterSummary.teamOne.players.count),
          batting_runs: fieldChange(beforeSummary.teamOne.players.batting_runs, afterSummary.teamOne.players.batting_runs),
          batting_balls: fieldChange(beforeSummary.teamOne.players.batting_balls, afterSummary.teamOne.players.batting_balls),
          fours: fieldChange(beforeSummary.teamOne.players.fours, afterSummary.teamOne.players.fours),
          sixes: fieldChange(beforeSummary.teamOne.players.sixes, afterSummary.teamOne.players.sixes),
          outs: fieldChange(beforeSummary.teamOne.players.outs, afterSummary.teamOne.players.outs),
          bowling_balls: fieldChange(beforeSummary.teamOne.players.bowling_balls, afterSummary.teamOne.players.bowling_balls),
          bowling_runs: fieldChange(beforeSummary.teamOne.players.bowling_runs, afterSummary.teamOne.players.bowling_runs),
          bowling_wkts: fieldChange(beforeSummary.teamOne.players.bowling_wkts, afterSummary.teamOne.players.bowling_wkts),
          maidens: fieldChange(beforeSummary.teamOne.players.maidens, afterSummary.teamOne.players.maidens),
        },
      },
      teamTwo: {
        totals: {
          total_score: fieldChange(beforeSummary.teamTwo.totals.total_score, afterSummary.teamTwo.totals.total_score),
          total_wickets: fieldChange(beforeSummary.teamTwo.totals.total_wickets, afterSummary.teamTwo.totals.total_wickets),
          total_balls: fieldChange(beforeSummary.teamTwo.totals.total_balls, afterSummary.teamTwo.totals.total_balls),
        },
        players: {
          count: fieldChange(beforeSummary.teamTwo.players.count, afterSummary.teamTwo.players.count),
          batting_runs: fieldChange(beforeSummary.teamTwo.players.batting_runs, afterSummary.teamTwo.players.batting_runs),
          batting_balls: fieldChange(beforeSummary.teamTwo.players.batting_balls, afterSummary.teamTwo.players.batting_balls),
          fours: fieldChange(beforeSummary.teamTwo.players.fours, afterSummary.teamTwo.players.fours),
          sixes: fieldChange(beforeSummary.teamTwo.players.sixes, afterSummary.teamTwo.players.sixes),
          outs: fieldChange(beforeSummary.teamTwo.players.outs, afterSummary.teamTwo.players.outs),
          bowling_balls: fieldChange(beforeSummary.teamTwo.players.bowling_balls, afterSummary.teamTwo.players.bowling_balls),
          bowling_runs: fieldChange(beforeSummary.teamTwo.players.bowling_runs, afterSummary.teamTwo.players.bowling_runs),
          bowling_wkts: fieldChange(beforeSummary.teamTwo.players.bowling_wkts, afterSummary.teamTwo.players.bowling_wkts),
          maidens: fieldChange(beforeSummary.teamTwo.players.maidens, afterSummary.teamTwo.players.maidens),
        },
      },
    }
    

    // Warnings when totals changed but per-player aggregates did not
    const warnIfTotalsChangedButPlayersDidNot = (which: 'teamOne' | 'teamTwo') => {
      const b = (beforeSummary as any)[which]
      const a = (afterSummary as any)[which]
      const totalsChanged =
        b.totals.total_score !== a.totals.total_score ||
        b.totals.total_balls !== a.totals.total_balls ||
        b.totals.total_wickets !== a.totals.total_wickets
      const battingUnchanged = b.players.batting_runs === a.players.batting_runs && b.players.batting_balls === a.players.batting_balls
      const bowlingUnchanged = b.players.bowling_runs === a.players.bowling_runs && b.players.bowling_balls === a.players.bowling_balls
      if (totalsChanged && battingUnchanged && bowlingUnchanged) {
        console.warn(`‚ö†Ô∏è [API] ${which}: team totals changed but per-player aggregates did not. Did client send ${which}.players?`)
      }
    }
    warnIfTotalsChangedButPlayersDidNot('teamOne')
    warnIfTotalsChangedButPlayersDidNot('teamTwo')

    const duration = Date.now() - startTime
    console.log(`‚úÖ [API] Match updated successfully in ${duration}ms`)
    const snapshot = {
      currentInnings: updatedMatch.currentInnings,
      batting_team: updatedMatch.batting_team,
      bowling_team: updatedMatch.bowling_team,
      target: updatedMatch.target,
      scoringState: updatedMatch.scoringState
        ? {
            currentInnings: updatedMatch.scoringState.currentInnings,
            selectedBatsman1: updatedMatch.scoringState.selectedBatsman1,
            selectedBatsman2: updatedMatch.scoringState.selectedBatsman2,
            selectedBowler: updatedMatch.scoringState.selectedBowler,
          }
        : null,
    }
   

    return NextResponse.json({
      success: true,
      data: updatedMatch,
    })
  } catch (error: any) {
    const duration = Date.now() - startTime
    console.error(`‚ùå [API] Error after ${duration}ms: ${error?.message}`)
    if (error?.stack) console.error(error.stack)
    return NextResponse.json(
      { error: 'Failed to update match', details: error.message },
      { status: 500 }
    )
  }
}

===== FILE: app/api/matches/[id]/start/route.ts =====
import { NextRequest, NextResponse } from 'next/server';
import { connectDB } from '@/lib/db';
import Match from '@/models/Match';
import { verifyToken } from '@/lib/auth';

interface Params {
  params: { id: string }
}

export async function POST(request: NextRequest, { params }: Params) {
  try {
    const user = await verifyToken(request);
    if (!user) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    await connectDB();
    
    const match = await Match.findById(params.id);
    
    if (!match) {
      return NextResponse.json({ error: 'Match not found' }, { status: 404 });
    }

    // Check if user is admin
    if (match.createdBy.toString() !== user.userId && !match.admins.includes(user.userId)) {
      return NextResponse.json({ error: 'Only match admin can start the match' }, { status: 403 });
    }

    // Update match status
    match.status = 'live';
    await match.save();

    return NextResponse.json({
      success: true,
      data: match
    });

  } catch (error) {
    console.error('Start match error:', error);
    return NextResponse.json(
      { error: 'Failed to start match' },
      { status: 500 }
    );
  }
}

===== FILE: app/api/test/route.ts =====
import { NextResponse } from 'next/server';

export async function GET() {
  return NextResponse.json({
    message: 'API is working',
    timestamp: new Date().toISOString(),
    routes: {
      matches: '/api/matches',
      matchById: '/api/matches/[id]',
      score: '/api/matches/[id]/score'
    }
  });
}

===== FILE: app/dashboard/page.tsx =====
'use client'

import { useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import Navbar from '@/components/dashboard/Navbar'
import WelcomeBanner from '@/components/dashboard/WelcomeBanner'
import QuickActions from '@/components/dashboard/QuickActions'
import MyMatches from '@/components/dashboard/MyMatches'
import InvitedMatches from '@/components/dashboard/InvitedMatches'
import Footer from '@/components/dashboard/Footer'
import { Toaster } from 'react-hot-toast'

interface User {
  id: string;
  name: string;
  email: string;
}

interface MatchData {
  _id: string;
  matchCode: string;
  status: string;
  venue: string;
  startTime: string;
  overs: number;
  teamOne: {
    name: string;
    total_score: number;
    total_wickets: number;
    total_balls: number;
    overs: string;
  };
  teamTwo: {
    name: string;
    total_score: number;
    total_wickets: number;
    total_balls: number;
    overs: string;
  };
  isPrivate: boolean;
  createdAt: string;
  target?: number;
}

export default function DashboardPage() {
  const router = useRouter()
  const [user, setUser] = useState<User | null>(null)
  const [loading, setLoading] = useState(true)
  const [myMatches, setMyMatches] = useState<MatchData[]>([])
  const [invitedMatches, setInvitedMatches] = useState<MatchData[]>([])
  const [matchesLoading, setMatchesLoading] = useState(true)

  useEffect(() => {
    // Check if user is authenticated
    const checkAuth = () => {
      try {
        const token = localStorage.getItem('auth_token')
        const userData = localStorage.getItem('user')

        if (!token || !userData) {
          router.push('/login')
          return
        }

        const parsedUser = JSON.parse(userData)
        setUser(parsedUser)
        setLoading(false)
      } catch (error) {
        console.error('Failed to load user data:', error)
        localStorage.clear()
        router.push('/login')
      }
    }

    checkAuth()
  }, [router])

  // Fetch matches when user is loaded
  useEffect(() => {
    if (user) {
      fetchMatches()
    }
  }, [user])

  const fetchMatches = async () => {
    try {
      setMatchesLoading(true)
      const token = localStorage.getItem('auth_token')
      
      const response = await fetch('/api/matches', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (!response.ok) {
        throw new Error('Failed to fetch matches')
      }

      const data = await response.json()
      
      if (data.success) {
        setMyMatches(data.data.created || [])
        setInvitedMatches(data.data.invited || [])
      }
    } catch (error) {
      console.error('Error fetching matches:', error)
    } finally {
      setMatchesLoading(false)
    }
  }

  const handleLogout = async () => {
    try {
      await fetch('/api/auth/logout', { method: 'POST' })
    } catch (error) {
      console.error('Logout error:', error)
    } finally {
      localStorage.removeItem('auth_token')
      localStorage.removeItem('user')
      router.push('/login')
    }
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50/30 via-white to-emerald-50/20">
        <div className="text-center">
          <div className="h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading dashboard...</p>
        </div>
      </div>
    )
  }

  if (!user) {
    return null
  }

  return (
    <>
      <Toaster position="top-right" />
      <div className="min-h-screen bg-gradient-to-br from-green-50/30 via-white to-emerald-50/20">
        <Navbar user={user} onLogout={handleLogout} />
        
        <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-6 max-w-7xl">
          <WelcomeBanner userName={user.name} />
          <QuickActions />
          
          {/* Pass real data and loading state to components */}
          <MyMatches 
            matches={myMatches} 
            loading={matchesLoading}
            onRefresh={fetchMatches}
          />
          <InvitedMatches 
            // matches={invitedMatches} 
            // loading={matchesLoading}
            // onRefresh={fetchMatches}
          />
        </main>

        <Footer />
      </div>
    </>
  )
}

===== FILE: app/home/layout.tsx =====
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Dashboard - Local League Cricket Scoreboard',
  description: 'Manage your cricket matches, teams, and scores',
}

export default function HomeLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return <>{children}</>
}

===== FILE: app/home/page.tsx =====
import Header from '@/components/home/Header'
import QuickActions from '@/components/home/QuickActions'
import LiveMatches from '@/components/home/LiveMatches'
import StatsOverview from '@/components/home/StatsOverview'
import RecentActivity from '@/components/home/RecentActivity'
import UpcomingMatches from '@/components/home/UpcomingMatches'
import TeamPerformance from '@/components/home/TeamPerformance'

export default function HomePage() {
  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      
      <main className="container mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6">
        {/* Welcome Section */}
        <div className="bg-gradient-to-r from-primary-600 to-accent-600 rounded-2xl p-6 text-white">
          <h1 className="text-2xl sm:text-3xl font-bold mb-2">
            Welcome back, Rajesh! üëã
          </h1>
          <p className="text-primary-100">
            You have 3 live matches and 2 upcoming games today
          </p>
        </div>

        {/* Quick Actions */}
        <QuickActions />

        {/* Stats Overview */}
        <StatsOverview />

        {/* Main Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Left Column - Live Matches (2 cols wide) */}
          <div className="lg:col-span-2 space-y-6">
            <LiveMatches />
            <UpcomingMatches />
          </div>

          {/* Right Column - Activity & Performance */}
          <div className="space-y-6">
            <TeamPerformance />
            <RecentActivity />
          </div>
        </div>
      </main>
    </div>
  )
}

===== FILE: app/leaderboard/page.tsx =====
import { Suspense } from 'react';
import LeaderboardTabs from '@/components/Leaderboard/LeaderboardTabs';
import { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Leaderboard - Local Cricket Scorecard',
  description: 'View top cricket players batting and bowling statistics',
};

async function getLeaderboardData() {
  const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';
  
  try {
    const res = await fetch(`${baseUrl}/api/leaderboard`, {
      cache: 'no-store',
      next: { revalidate: 0 }
    });
    

    if (!res.ok) {
      throw new Error('Failed to fetch leaderboard data');
    }

    return res.json();
  } catch (error) {
    console.error('Error fetching leaderboard:', error);
    return { 
      battingStats: [], 
      bowlingStats: [],
      teamStats: [],
      totalMatches: 0 
    };
  }
}

function LoadingSkeleton() {
  return (
    <div className="animate-pulse">
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        {[1, 2, 3].map((i) => (
          <div key={i} className="bg-gray-200 rounded-lg h-24"></div>
        ))}
      </div>
      <div className="bg-gray-200 rounded-xl h-96"></div>
    </div>
  );
}

export default async function LeaderboardPage() {
  const data = await getLeaderboardData();
  

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-slate-100">
      {/* Header */}
      <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-12 px-4">
        <div className="max-w-6xl mx-auto">
          <h1 className="text-4xl md:text-5xl font-bold mb-3 flex items-center gap-3">
            üèÜ Players Leaderboard
          </h1>
          <p className="text-blue-100 text-lg">
            Top 10 Cricket Players Performance Statistics
          </p>
        </div>
      </div>

      {/* Content */}
      <div className="max-w-6xl mx-auto px-4 py-8 -mt-6">
        <div className="bg-white rounded-2xl shadow-2xl p-4 md:p-8">
          <Suspense fallback={<LoadingSkeleton />}>
            <LeaderboardTabs
              battingStats={data.battingStats}
              bowlingStats={data.bowlingStats}
              teamStats={data.teamStats}
              totalMatches={data.totalMatches}
            />
          </Suspense>
        </div>

        {/* Footer Info */}
        <div className="mt-8 text-center">
          <p className="text-gray-600 text-sm">
            üìä Stats updated in real-time ‚Ä¢ üîù Top 10 players displayed
          </p>
        </div>
      </div>
    </div>
  );
}

===== FILE: app/matches/[id]/page.tsx =====
'use client'

import { useEffect, useState } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { 
  Trophy, 
  Users, 
  Calendar, 
  MapPin, 
  Clock, 
  Share2, 
  Copy, 
  Play,
  Eye,
  Edit2,
  ArrowLeft,
  Circle,
  Shield,
  CheckCircle,
  AlertCircle
} from 'lucide-react'
import toast, { Toaster } from 'react-hot-toast'
import { motion } from 'framer-motion'

interface Player {
  name: string
  runs_scored: number
  balls_played: number
  fours: number
  sixes: number
  wickets: number
  is_captain: boolean
  is_keeper: boolean
  is_out: boolean
}

interface Team {
  name: string
  players: Player[]
  total_score: number
  total_wickets: number
  total_overs: number
  extras: number
}

interface Match {
  _id: string
  matchCode: string
  status: 'upcoming' | 'live' | 'completed'
  venue: string
  overs: number
  startTime: string
  teamOne: Team
  teamTwo: Team
  createdBy: string
  admins: string[]
  scorers: string[]
  viewers: string[]
  isPrivate: boolean
  createdAt: string
  updatedAt: string
}

export default function MatchViewPage() {
  const params = useParams()
  const router = useRouter()
  const matchId = params.id as string
  
  const [match, setMatch] = useState<Match | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState('')
  const [copied, setCopied] = useState(false)
  const [isAdmin, setIsAdmin] = useState(false)

  useEffect(() => {
    fetchMatch()
   
  }, [matchId])

 

  const fetchMatch = async () => {
    
    try {
      const token = localStorage.getItem('auth_token')
      const response = await fetch(`/api/matches/${matchId}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (!response.ok) {
        if (response.status === 404) {
          setError('Match not found')
        } else {
          setError('Failed to load match')
        }
        return
      }

      const data = await response.json()
      setMatch(data.data)
      
      // Check if current user is admin
      const userData = localStorage.getItem('user')
      if (userData) {
        const user = JSON.parse(userData)
        setIsAdmin(data.data.createdBy === user._id || data.data.admins?.includes(user._id))
      }
     
    } catch (err) {
      setError('Failed to load match')
      console.error('Fetch match error:', err)
    } finally {
      setLoading(false)
      
      
    }
  }

  const copyMatchCode = () => {
    if (match?.matchCode) {
      navigator.clipboard.writeText(match.matchCode)
      setCopied(true)
      toast.success('Match code copied!')
      setTimeout(() => setCopied(false), 2000)
    }
  }

  const shareMatch = () => {
    if (match?.matchCode) {
      const shareUrl = `${window.location.origin}/join/${match.matchCode}`
      const shareText = `Join my cricket match!\n\nMatch Code: ${match.matchCode}\nTeams: ${match.teamOne.name} vs ${match.teamTwo.name}\n\nJoin here: ${shareUrl}`
      
      if (navigator.share) {
        navigator.share({
          title: 'Join Cricket Match',
          text: shareText,
        })
      } else {
        navigator.clipboard.writeText(shareText)
        toast.success('Share link copied!')
      }
    }
  }

  const startMatch = async () => {
    try {
      const token = localStorage.getItem('auth_token')
      const response = await fetch(`/api/matches/${matchId}/start`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (response.ok) {
        toast.success('Match started!')
        // Redirect to scoring page
        router.push(`/matches/${matchId}/score`)
      } else {
        toast.error('Failed to start match')
      }
    } catch (err) {
      toast.error('Failed to start match')
    }
  }

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'live':
        return 'bg-red-100 text-red-700 border-red-200'
      case 'upcoming':
        return 'bg-blue-100 text-blue-700 border-blue-200'
      case 'completed':
        return 'bg-green-100 text-green-700 border-green-200'
      default:
        return 'bg-gray-100 text-gray-700 border-gray-200'
    }
  }

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'live':
        return <Circle className="h-4 w-4 fill-current animate-pulse" />
      case 'upcoming':
        return <Clock className="h-4 w-4" />
      case 'completed':
        return <CheckCircle className="h-4 w-4" />
      default:
        return null
    }
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <div className="h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading match details...</p>
        </div>
      </div>
    )
  }

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <AlertCircle className="h-12 w-12 text-red-500 mx-auto mb-4" />
          <h2 className="text-xl font-bold text-gray-900 mb-2">{error}</h2>
          <Button onClick={() => router.push('/dashboard')} variant="secondary">
            Back to Dashboard
          </Button>
        </div>
      </div>
    )
  }

  if (!match) return null

  return (
    <>
      <Toaster position="top-center" />
      
      <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
        {/* Header */}
        <div className="bg-white border-b border-gray-100 sticky top-0 z-10">
          <div className="container mx-auto px-4 py-4">
            <div className="flex items-center justify-between">
              <button
                onClick={() => router.back()}
                className="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
              >
                <ArrowLeft className="h-5 w-5" />
                <span>Back</span>
              </button>
              
              <div className="flex items-center gap-2">
                <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border ${getStatusColor(match.status)}`}>
                  {getStatusIcon(match.status)}
                  <span className="capitalize">{match.status}</span>
                </div>
                {isAdmin && (
                  <div className="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-700 border border-purple-200">
                    <Shield className="h-3 w-3" />
                    Admin
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>

        <div className="container mx-auto px-4 py-8 max-w-6xl">
          {/* Match Code Card */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="mb-8"
          >
            <Card className="p-6 bg-gradient-to-r from-primary-50 to-accent-50 border-primary-200">
              <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div>
                  <h2 className="text-sm font-medium text-gray-600 mb-1">Match Code</h2>
                  <div className="flex items-center gap-3">
                    <span className="text-3xl font-bold font-mono text-gray-900">{match.matchCode}</span>
                    <button
                      onClick={copyMatchCode}
                      className="p-2 hover:bg-white/50 rounded-lg transition-colors"
                      title="Copy code"
                    >
                      {copied ? (
                        <CheckCircle className="h-5 w-5 text-green-600" />
                      ) : (
                        <Copy className="h-5 w-5 text-gray-600" />
                      )}
                    </button>
                  </div>
                  <p className="text-sm text-gray-600 mt-2">Share this code with others to join the match</p>
                </div>
                <Button onClick={shareMatch} variant="secondary" className="gap-2">
                  <Share2 className="h-4 w-4" />
                  Share Match
                </Button>
              </div>
            </Card>
          </motion.div>

          {/* Match Details */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            {/* Teams Card */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.1 }}
              className="lg:col-span-2"
            >
              <Card className="p-6 h-full">
                <h3 className="text-lg font-bold text-gray-900 mb-4">Teams</h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {/* Team 1 */}
                  <div className="space-y-3">
                    <div className="bg-green-50 rounded-lg p-4">
                      <h4 className="font-bold text-green-900 text-lg mb-2">{match.teamOne.name}</h4>
                      <div className="space-y-2">
                        {match.teamOne.players.map((player, index) => (
                          <div key={index} className="flex items-center justify-between text-sm">
                            <div className="flex items-center gap-2">
                              <span className="text-gray-600">{index + 1}.</span>
                              <span className="font-medium text-gray-900">{player.name}</span>
                              {player.is_captain && (
                                <span className="px-1.5 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded-full">C</span>
                              )}
                              {player.is_keeper && (
                                <span className="px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">WK</span>
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* Team 2 */}
                  <div className="space-y-3">
                    <div className="bg-purple-50 rounded-lg p-4">
                      <h4 className="font-bold text-purple-900 text-lg mb-2">{match.teamTwo.name}</h4>
                      <div className="space-y-2">
                        {match.teamTwo.players.map((player, index) => (
                          <div key={index} className="flex items-center justify-between text-sm">
                            <div className="flex items-center gap-2">
                              <span className="text-gray-600">{index + 1}.</span>
                              <span className="font-medium text-gray-900">{player.name}</span>
                              {player.is_captain && (
                                <span className="px-1.5 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded-full">C</span>
                              )}
                              {player.is_keeper && (
                                <span className="px-1.5 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">WK</span>
                              )}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </Card>
            </motion.div>

            {/* Match Info Card */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2 }}
            >
              <Card className="p-6">
                <h3 className="text-lg font-bold text-gray-900 mb-4">Match Information</h3>
                
                <div className="space-y-4">
                  <div className="flex items-start gap-3">
                    <MapPin className="h-5 w-5 text-gray-400 mt-0.5" />
                    <div>
                      <p className="text-sm text-gray-600">Venue</p>
                      <p className="font-medium text-gray-900">{match.venue}</p>
                    </div>
                  </div>

                  <div className="flex items-start gap-3">
                    <Calendar className="h-5 w-5 text-gray-400 mt-0.5" />
                    <div>
                      <p className="text-sm text-gray-600">Date & Time</p>
                      <p className="font-medium text-gray-900">
                        {new Date(match.startTime).toLocaleDateString()}
                      </p>
                      <p className="text-sm text-gray-600">
                        {new Date(match.startTime).toLocaleTimeString()}
                      </p>
                    </div>
                  </div>

                  <div className="flex items-start gap-3">
                    <Trophy className="h-5 w-5 text-gray-400 mt-0.5" />
                    <div>
                      <p className="text-sm text-gray-600">Format</p>
                      <p className="font-medium text-gray-900">{match.overs} Overs</p>
                    </div>
                  </div>

                  <div className="flex items-start gap-3">
                    <Users className="h-5 w-5 text-gray-400 mt-0.5" />
                    <div>
                      <p className="text-sm text-gray-600">Visibility</p>
                      <p className="font-medium text-gray-900">
                        {match.isPrivate ? 'Private Match' : 'Public Match'}
                      </p>
                    </div>
                  </div>
                </div>

                {/* Action Buttons */}
                <div className="mt-6 space-y-2">
                  {match.status === 'upcoming' && isAdmin && (
                    <Button 
                      onClick={startMatch}
                      className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white"
                    >
                      <Play className="h-4 w-4 mr-2" />
                      Start Match
                    </Button>
                  )}
                  
                  {match.status === 'live' && (
                    <>
                      {isAdmin ? (
                        <Button 
                          onClick={() => router.push(`/matches/${matchId}/score`)}
                          className="w-full bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white"
                        >
                          <Edit2 className="h-4 w-4 mr-2" />
                          Update Score
                        </Button>
                      ) : (
                        <Button 
                          onClick={() => router.push(`/matches/${matchId}/live`)}
                          className="w-full"
                          variant="secondary"
                        >
                          <Eye className="h-4 w-4 mr-2" />
                          View Live Score
                        </Button>
                      )}
                    </>
                  )}
                  
                  {match.status === 'completed' && (
                    <Button 
                      onClick={() => router.push(`/matches/${matchId}/scorecard`)}
                      className="w-full"
                      variant="secondary"
                    >
                      <Trophy className="h-4 w-4 mr-2" />
                      View Scorecard
                    </Button>
                  )}
                </div>
              </Card>
            </motion.div>
          </div>

          {/* Created By */}
          <div className="text-center text-sm text-gray-500">
            Created on {new Date(match.createdAt).toLocaleDateString()} at {new Date(match.createdAt).toLocaleTimeString()}
          </div>
        </div>
      </div>
    </>
  )
}

===== FILE: app/matches/[id]/edit/page.tsx =====
'use client'

import { useEffect, useState } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { ArrowLeft, Save, AlertCircle } from 'lucide-react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import toast, { Toaster } from 'react-hot-toast'
import { motion } from 'framer-motion'

interface Player {
  name: string
  is_captain: boolean
  is_keeper: boolean
}

interface Team {
  name: string
  players: Player[]
}

interface Match {
  _id: string
  matchCode: string
  status: string
  venue: string
  overs: number
  startTime: string
  teamOne: Team
  teamTwo: Team
  isPrivate: boolean
}

export default function EditMatchPage() {
  const params = useParams()
  const router = useRouter()
  const matchId = params.id as string
  
  const [match, setMatch] = useState<Match | null>(null)
  const [loading, setLoading] = useState(true)
  const [saving, setSaving] = useState(false)
  const [error, setError] = useState('')
  
  const [formData, setFormData] = useState({
    venue: '',
    overs: 20,
    startTime: '',
    teamOne: { name: '', players: [] as Player[] },
    teamTwo: { name: '', players: [] as Player[] },
    isPrivate: false
  })

  useEffect(() => {
    fetchMatch()
  }, [matchId])

  const fetchMatch = async () => {
    try {
      const token = localStorage.getItem('auth_token')
      const response = await fetch(`/api/matches/${matchId}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (!response.ok) {
        if (response.status === 404) {
          setError('Match not found')
        } else {
          setError('Failed to load match')
        }
        return
      }

      const data = await response.json()
      const matchData = data.data
      
      setMatch(matchData)
      setFormData({
        venue: matchData.venue,
        overs: matchData.overs,
        startTime: new Date(matchData.startTime).toISOString().slice(0, 16),
        teamOne: {
          name: matchData.teamOne.name,
          players: matchData.teamOne.players
        },
        teamTwo: {
          name: matchData.teamTwo.name,
          players: matchData.teamTwo.players
        },
        isPrivate: matchData.isPrivate
      })
      
    } catch (err) {
      setError('Failed to load match')
      console.error('Fetch match error:', err)
    } finally {
      setLoading(false)
    }
  }

  const handleSave = async (e: React.FormEvent) => {
    e.preventDefault()
    
    if (!match) return
    
    // Validate form
    if (!formData.venue || !formData.teamOne.name || !formData.teamTwo.name) {
      toast.error('Please fill in all required fields')
      return
    }

    if (formData.teamOne.players.length === 0 || formData.teamTwo.players.length === 0) {
      toast.error('Each team must have at least one player')
      return
    }

    setSaving(true)
    
    try {
      const token = localStorage.getItem('auth_token')
      const response = await fetch(`/api/matches/${matchId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          venue: formData.venue,
          overs: formData.overs,
          startTime: new Date(formData.startTime).toISOString(),
          teamOne: formData.teamOne,
          teamTwo: formData.teamTwo,
          isPrivate: formData.isPrivate
        })
      })

      if (response.ok) {
        toast.success('Match updated successfully!')
        setTimeout(() => {
          router.push(`/matches/${matchId}`)
        }, 1000)
      } else {
        const errorData = await response.json()
        toast.error(errorData.error || 'Failed to update match')
      }
    } catch (error) {
      toast.error('Failed to update match')
      console.error('Update error:', error)
    } finally {
      setSaving(false)
    }
  }

  const updatePlayer = (teamKey: 'teamOne' | 'teamTwo', playerIndex: number, field: string, value: any) => {
    setFormData(prev => ({
      ...prev,
      [teamKey]: {
        ...prev[teamKey],
        players: prev[teamKey].players.map((player, idx) => 
          idx === playerIndex ? { ...player, [field]: value } : player
        )
      }
    }))
  }

  const addPlayer = (teamKey: 'teamOne' | 'teamTwo') => {
    setFormData(prev => ({
      ...prev,
      [teamKey]: {
        ...prev[teamKey],
        players: [...prev[teamKey].players, { name: '', is_captain: false, is_keeper: false }]
      }
    }))
  }

  const removePlayer = (teamKey: 'teamOne' | 'teamTwo', playerIndex: number) => {
    setFormData(prev => ({
      ...prev,
      [teamKey]: {
        ...prev[teamKey],
        players: prev[teamKey].players.filter((_, idx) => idx !== playerIndex)
      }
    }))
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <div className="h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading match...</p>
        </div>
      </div>
    )
  }

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <AlertCircle className="h-12 w-12 text-red-500 mx-auto mb-4" />
          <h2 className="text-xl font-bold text-gray-900 mb-2">{error}</h2>
          <Button onClick={() => router.push('/dashboard')} variant="secondary">
            Back to Dashboard
          </Button>
        </div>
      </div>
    )
  }

  if (!match) return null

  // Check if match can be edited (only upcoming matches)
  if (match.status !== 'upcoming') {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <AlertCircle className="h-12 w-12 text-yellow-500 mx-auto mb-4" />
          <h2 className="text-xl font-bold text-gray-900 mb-2">Cannot Edit Match</h2>
          <p className="text-gray-600 mb-4">Only upcoming matches can be edited.</p>
          <Button onClick={() => router.push(`/matches/${matchId}`)} variant="secondary">
            View Match
          </Button>
        </div>
      </div>
    )
  }

  return (
    <>
      <Toaster position="top-center" />
      
      <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
        {/* Header */}
        <div className="bg-white border-b border-gray-100 sticky top-0 z-10">
          <div className="container mx-auto px-4 py-4">
            <div className="flex items-center justify-between">
              <button
                onClick={() => router.back()}
                className="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
              >
                <ArrowLeft className="h-5 w-5" />
                <span>Back</span>
              </button>
              
              <h1 className="text-lg font-semibold text-gray-900">Edit Match</h1>
              
              <div className="w-20"></div> {/* Spacer for centering */}
            </div>
          </div>
        </div>

        <div className="container mx-auto px-4 py-8 max-w-4xl">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="space-y-6"
          >
            {/* Match Info Card */}
            <Card className="p-6">
              <h3 className="text-lg font-bold text-gray-900 mb-4">Match Information</h3>
              
              <form onSubmit={handleSave} className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Venue *
                    </label>
                    <input
                      type="text"
                      value={formData.venue}
                      onChange={(e) => setFormData(prev => ({ ...prev, venue: e.target.value }))}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      placeholder="Match venue"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Overs
                    </label>
                    <input
                      type="number"
                      value={formData.overs}
                      onChange={(e) => setFormData(prev => ({ ...prev, overs: parseInt(e.target.value) }))}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      min="1"
                      max="50"
                      required
                    />
                  </div>
                  
                  <div className="md:col-span-2">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Start Time *
                    </label>
                    <input
                      type="datetime-local"
                      value={formData.startTime}
                      onChange={(e) => setFormData(prev => ({ ...prev, startTime: e.target.value }))}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      required
                    />
                  </div>
                </div>

                <div className="flex items-center gap-2">
                  <input
                    type="checkbox"
                    id="isPrivate"
                    checked={formData.isPrivate}
                    onChange={(e) => setFormData(prev => ({ ...prev, isPrivate: e.target.checked }))}
                    className="rounded border-gray-300 text-green-600 focus:ring-green-500"
                  />
                  <label htmlFor="isPrivate" className="text-sm text-gray-700">
                    Private Match (only visible to invited users)
                  </label>
                </div>

                {/* Teams Section */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                  {/* Team One */}
                  <div>
                    <h4 className="text-md font-semibold text-gray-900 mb-3">Team One</h4>
                    <div className="space-y-4">
                      <input
                        type="text"
                        value={formData.teamOne.name}
                        onChange={(e) => setFormData(prev => ({ 
                          ...prev, 
                          teamOne: { ...prev.teamOne, name: e.target.value }
                        }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        placeholder="Team name"
                        required
                      />
                      
                      <div className="space-y-2">
                        {formData.teamOne.players.map((player, idx) => (
                          <div key={idx} className="flex items-center gap-2 p-2 border rounded-lg">
                            <input
                              type="text"
                              value={player.name}
                              onChange={(e) => updatePlayer('teamOne', idx, 'name', e.target.value)}
                              className="flex-1 px-2 py-1 border-0 focus:ring-0"
                              placeholder="Player name"
                              required
                            />
                            <label className="flex items-center gap-1 text-xs">
                              <input
                                type="checkbox"
                                checked={player.is_captain}
                                onChange={(e) => updatePlayer('teamOne', idx, 'is_captain', e.target.checked)}
                                className="rounded"
                              />
                              C
                            </label>
                            <label className="flex items-center gap-1 text-xs">
                              <input
                                type="checkbox"
                                checked={player.is_keeper}
                                onChange={(e) => updatePlayer('teamOne', idx, 'is_keeper', e.target.checked)}
                                className="rounded"
                              />
                              WK
                            </label>
                            <button
                              type="button"
                              onClick={() => removePlayer('teamOne', idx)}
                              className="text-red-500 hover:text-red-700 px-2 py-1"
                            >
                              √ó
                            </button>
                          </div>
                        ))}
                        
                        <button
                          type="button"
                          onClick={() => addPlayer('teamOne')}
                          className="w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-green-500 hover:text-green-500 transition-colors"
                        >
                          + Add Player
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Team Two */}
                  <div>
                    <h4 className="text-md font-semibold text-gray-900 mb-3">Team Two</h4>
                    <div className="space-y-4">
                      <input
                        type="text"
                        value={formData.teamTwo.name}
                        onChange={(e) => setFormData(prev => ({ 
                          ...prev, 
                          teamTwo: { ...prev.teamTwo, name: e.target.value }
                        }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        placeholder="Team name"
                        required
                      />
                      
                      <div className="space-y-2">
                        {formData.teamTwo.players.map((player, idx) => (
                          <div key={idx} className="flex items-center gap-2 p-2 border rounded-lg">
                            <input
                              type="text"
                              value={player.name}
                              onChange={(e) => updatePlayer('teamTwo', idx, 'name', e.target.value)}
                              className="flex-1 px-2 py-1 border-0 focus:ring-0"
                              placeholder="Player name"
                              required
                            />
                            <label className="flex items-center gap-1 text-xs">
                              <input
                                type="checkbox"
                                checked={player.is_captain}
                                onChange={(e) => updatePlayer('teamTwo', idx, 'is_captain', e.target.checked)}
                                className="rounded"
                              />
                              C
                            </label>
                            <label className="flex items-center gap-1 text-xs">
                              <input
                                type="checkbox"
                                checked={player.is_keeper}
                                onChange={(e) => updatePlayer('teamTwo', idx, 'is_keeper', e.target.checked)}
                                className="rounded"
                              />
                              WK
                            </label>
                            <button
                              type="button"
                              onClick={() => removePlayer('teamTwo', idx)}
                              className="text-red-500 hover:text-red-700 px-2 py-1"
                            >
                              √ó
                            </button>
                          </div>
                        ))}
                        
                        <button
                          type="button"
                          onClick={() => addPlayer('teamTwo')}
                          className="w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-green-500 hover:text-green-500 transition-colors"
                        >
                          + Add Player
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="flex gap-4 pt-6">
                  <Button
                    type="button"
                    variant="secondary"
                    onClick={() => router.push(`/matches/${matchId}`)}
                    className="flex-1"
                  >
                    Cancel
                  </Button>
                  <Button
                    type="submit"
                    disabled={saving}
                    className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600"
                  >
                    {saving ? (
                      <>
                        <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2" />
                        Saving...
                      </>
                    ) : (
                      <>
                        <Save className="w-4 h-4 mr-2" />
                        Save Changes
                      </>
                    )}
                  </Button>
                </div>
              </form>
            </Card>
          </motion.div>
        </div>
      </div>
    </>
  )
}


===== FILE: app/matches/[id]/live/page.tsx =====
'use client'

import { useEffect, useState } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { 
  ArrowLeft, 
  Circle, 
  RefreshCw, 
  Trophy,
  TrendingUp,
  Users,
  Target
} from 'lucide-react'
import { motion } from 'framer-motion'

interface Team {
  name: string
  total_score: number
  total_wickets: number
  total_balls: number
  total_overs?: number
  extras?: number
}

interface Match {
  _id: string
  matchCode: string
  status: 'upcoming' | 'live' | 'completed'
  venue: string
  overs: number
  startTime: string
  teamOne: Team
  teamTwo: Team
  batting_team?: string
  bowling_team?: string
  target?: number
}

export default function LiveMatchPage() {
  const params = useParams()
  const router = useRouter()
  const matchId = params.id as string
  
  const [match, setMatch] = useState<Match | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState('')
  const [lastUpdated, setLastUpdated] = useState<Date>(new Date())

  useEffect(() => {
    fetchMatch()
    
    // Auto-refresh every 10 seconds
    const interval = setInterval(fetchMatch, 10000)
    
    return () => clearInterval(interval)
  }, [matchId])

  const fetchMatch = async () => {
    try {
      const response = await fetch(`/api/matches/${matchId}`)

      if (!response.ok) {
        if (response.status === 404) {
          setError('Match not found')
        } else {
          setError('Failed to load match')
        }
        return
      }

      const data = await response.json()
      setMatch(data.data)
      setLastUpdated(new Date())
      setError('')
      
    } catch (err) {
      setError('Failed to load match')
      console.error('Fetch match error:', err)
    } finally {
      setLoading(false)
    }
  }

  const manualRefresh = () => {
    setLoading(true)
    fetchMatch()
  }

  const getBattingTeam = (): Team | null => {
    if (!match || !match.batting_team) return null
    return match.batting_team === match.teamOne.name ? match.teamOne : match.teamTwo
  }

  const getBowlingTeam = (): Team | null => {
    if (!match || !match.bowling_team) return null
    return match.bowling_team === match.teamOne.name ? match.teamOne : match.teamTwo
  }

  const getOvers = (balls: number): string => {
    const overs = Math.floor(balls / 6)
    const remainingBalls = balls % 6
    return `${overs}.${remainingBalls}`
  }

  const getRunRate = (score: number, balls: number): string => {
    if (balls === 0) return '0.00'
    const runRate = (score / balls) * 6
    return runRate.toFixed(2)
  }

  const getRequiredRunRate = (): string => {
    if (!match || !match.target) return '0.00'
    
    const battingTeam = getBattingTeam()
    if (!battingTeam) return '0.00'
    
    const totalBalls = match.overs * 6
    const ballsRemaining = totalBalls - battingTeam.total_balls
    const runsRequired = match.target - battingTeam.total_score
    
    if (ballsRemaining <= 0) return '0.00'
    
    const requiredRate = (runsRequired / ballsRemaining) * 6
    return Math.max(0, requiredRate).toFixed(2)
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <div className="h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading live match...</p>
        </div>
      </div>
    )
  }

  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <div className="h-12 w-12 text-red-500 mx-auto mb-4">
            <Circle className="h-full w-full" />
          </div>
          <h2 className="text-xl font-bold text-gray-900 mb-2">{error}</h2>
          <Button onClick={() => router.push('/dashboard')} variant="secondary">
            Back to Dashboard
          </Button>
        </div>
      </div>
    )
  }

  if (!match) return null

  const battingTeam = getBattingTeam()
  const bowlingTeam = getBowlingTeam()

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
      {/* Header */}
      <div className="bg-white border-b border-gray-100 sticky top-0 z-10 shadow-sm">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <button
              onClick={() => router.back()}
              className="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
            >
              <ArrowLeft className="h-5 w-5" />
              <span>Back</span>
            </button>
            
            <div className="flex items-center gap-3">
              <span className="font-mono font-bold text-lg">{match.matchCode}</span>
              {match.status === 'live' && (
                <div className="flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">
                  <Circle className="h-3 w-3 fill-current animate-pulse" />
                  LIVE
                </div>
              )}
              <Button
                size="sm"
                variant="secondary"
                onClick={manualRefresh}
                disabled={loading}
              >
                <RefreshCw className={`h-4 w-4 ${loading ? 'animate-spin' : ''}`} />
              </Button>
            </div>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 max-w-4xl">
        {/* Match Status */}
        {match.status === 'upcoming' && (
          <Card className="p-6 mb-6 bg-blue-50 border-blue-200">
            <div className="text-center">
              <h2 className="text-xl font-bold text-blue-900 mb-2">Match Yet to Start</h2>
              <p className="text-blue-700">
                Scheduled for {new Date(match.startTime).toLocaleString()}
              </p>
            </div>
          </Card>
        )}

        {match.status === 'completed' && (
          <Card className="p-6 mb-6 bg-green-50 border-green-200">
            <div className="text-center">
              <Trophy className="h-12 w-12 text-green-600 mx-auto mb-4" />
              <h2 className="text-xl font-bold text-green-900 mb-2">Match Completed</h2>
            </div>
          </Card>
        )}

        {/* Live Score Display */}
        {(match.status === 'live' || match.status === 'completed') && battingTeam && bowlingTeam && (
          <div className="space-y-6">
            {/* Main Score */}
            <Card className="p-6 bg-gradient-to-r from-green-500 to-emerald-500 text-white">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-2xl font-bold">{match.teamOne.name} vs {match.teamTwo.name}</h2>
                <div className="text-right text-sm opacity-90">
                  <div>{match.venue}</div>
                  <div>{match.overs} Overs</div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Current Batting Team */}
                <div>
                  <div className="text-sm opacity-90 mb-1">
                    {battingTeam.name} (Batting)
                  </div>
                  <div className="text-4xl font-bold mb-2">
                    {battingTeam.total_score}/{battingTeam.total_wickets}
                  </div>
                  <div className="text-sm opacity-90">
                    Overs: {getOvers(battingTeam.total_balls)} | Run Rate: {getRunRate(battingTeam.total_score, battingTeam.total_balls)}
                  </div>
                </div>

                {/* Target/Trail */}
                <div className="text-right">
                  <div className="text-sm opacity-90 mb-1">
                    {bowlingTeam.name} (Bowling)
                  </div>
                  {match.target ? (
                    <div>
                      <div className="text-2xl font-bold mb-2">
                        Target: {match.target}
                      </div>
                      <div className="text-sm opacity-90">
                        Need {Math.max(0, match.target - battingTeam.total_score)} runs in {Math.max(0, (match.overs * 6) - battingTeam.total_balls)} balls
                      </div>
                      <div className="text-sm opacity-90">
                        Required Rate: {getRequiredRunRate()}
                      </div>
                    </div>
                  ) : (
                    <div className="text-lg font-semibold">
                      First Innings
                    </div>
                  )}
                </div>
              </div>
            </Card>

            {/* Teams Overview */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {/* Team 1 */}
              <Card className="p-6">
                <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                  <Users className="h-5 w-5" />
                  {match.teamOne.name}
                </h3>
                <div className="space-y-2">
                  <div className="flex justify-between">
                    <span className="text-gray-600">Score</span>
                    <span className="font-medium">{match.teamOne.total_score}/{match.teamOne.total_wickets}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Overs</span>
                    <span className="font-medium">{getOvers(match.teamOne.total_balls)}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Run Rate</span>
                    <span className="font-medium">{getRunRate(match.teamOne.total_score, match.teamOne.total_balls)}</span>
                  </div>
                  {match.teamOne.extras && (
                    <div className="flex justify-between">
                      <span className="text-gray-600">Extras</span>
                      <span className="font-medium">{match.teamOne.extras}</span>
                    </div>
                  )}
                </div>
              </Card>

              {/* Team 2 */}
              <Card className="p-6">
                <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                  <Users className="h-5 w-5" />
                  {match.teamTwo.name}
                </h3>
                <div className="space-y-2">
                  <div className="flex justify-between">
                    <span className="text-gray-600">Score</span>
                    <span className="font-medium">{match.teamTwo.total_score}/{match.teamTwo.total_wickets}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Overs</span>
                    <span className="font-medium">{getOvers(match.teamTwo.total_balls)}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Run Rate</span>
                    <span className="font-medium">{getRunRate(match.teamTwo.total_score, match.teamTwo.total_balls)}</span>
                  </div>
                  {match.teamTwo.extras && (
                    <div className="flex justify-between">
                      <span className="text-gray-600">Extras</span>
                      <span className="font-medium">{match.teamTwo.extras}</span>
                    </div>
                  )}
                </div>
              </Card>
            </div>

            {/* Additional Actions */}
            <div className="flex gap-4 justify-center">
              <Button
                onClick={() => router.push(`/matches/${matchId}`)}
                variant="secondary"
              >
                View Full Details
              </Button>
              {match.status === 'completed' && (
                <Button
                  onClick={() => router.push(`/matches/${matchId}/scorecard`)}
                >
                  View Scorecard
                </Button>
              )}
            </div>
          </div>
        )}

        {/* Last Updated */}
        <div className="text-center text-sm text-gray-500 mt-8">
          Last updated: {lastUpdated.toLocaleTimeString()}
          {match.status === 'live' && (
            <span className="ml-2">(Auto-refreshing every 10 seconds)</span>
          )}
        </div>
      </div>
    </div>
  )
}

===== FILE: app/matches/[id]/score/page.tsx =====
'use client'

import { useEffect, useState, useRef } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { ArrowLeft, Circle, Download } from 'lucide-react'
import toast, { Toaster } from 'react-hot-toast'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { apiCall, wait } from '@/utils/apiHelpers'
import { logger } from '@/utils/debugLogger'
import { TossForm } from './components/TossForm'
import { PlayerSelectionForm } from './components/PlayerSelectionForm'
import { ScoringInterface } from './components/ScoringInterface'
import { BatsmanChangeForm } from './components/BatsmanSelectionForm'
import { Match, Team, Player } from '@/types/match'

type MatchState = 'LOADING' | 'TOSS' | 'PLAYER_SELECTION' | 'SCORING' | 'ERROR'

export default function SimplifiedScoringPage() {
  const params = useParams()
  const router = useRouter()
  const matchId = params.id as string
  const hasLoaded = useRef(false)

  // Core state
  const [state, setState] = useState<MatchState>('LOADING')
  const [match, setMatch] = useState<Match | null>(null)
  const [error, setError] = useState<string>('')

  // Scoring state
  const [batsman1, setBatsman1] = useState('') // ‚úÖ Changed from striker
  const [batsman2, setBatsman2] = useState('') // ‚úÖ Changed from nonStriker
  const [bowler, setBowler] = useState('')
  const [currentStriker, setCurrentStriker] = useState<'batsman1' | 'batsman2'>('batsman1') // ‚úÖ New
  const [currentOver, setCurrentOver] = useState<string[]>([])
  const [score, setScore] = useState(0)
  const [wickets, setWickets] = useState(0)
  const [balls, setBalls] = useState(0)
  const [outBatsmen, setOutBatsmen] = useState<string[]>([]) // ‚úÖ New

  // UI control states
  const [needsBowlerChange, setNeedsBowlerChange] = useState(false)
  const [needsBatsmanChange, setNeedsBatsmanChange] = useState(false) // ‚úÖ New
  const [previousBowler, setPreviousBowler] = useState('')
  const [outBatsman, setOutBatsman] = useState('') // ‚úÖ New - which batsman is out


  const [currentInnings, setCurrentInnings] = useState(1) // ‚úÖ Add this

  // Derived values
  const battingTeam = getBattingTeam()
  const bowlingTeam = getBowlingTeam()

  function getBattingTeam(): Team | null {
    if (!match || !match.batting_team) return null
    return match.batting_team === match.teamOne.name
      ? match.teamOne
      : match.teamTwo
  }

  function getBowlingTeam(): Team | null {
    if (!match || !match.bowling_team) return null
    return match.bowling_team === match.teamOne.name
      ? match.teamOne
      : match.teamTwo
  }

  // ‚úÖ Get available batsmen (not out)
  // ‚úÖ FIXED VERSION - Filter out both out players AND current batsmen
  function getAvailableBatsmen(): Player[] {
    if (!battingTeam) return []

    return battingTeam.players.filter((p: Player) => {
      // Exclude players who are out
      if (outBatsmen.includes(p.name)) return false

      // Exclude current batsmen (the one still batting)
      if (p.name === batsman1 || p.name === batsman2) return false

      return true
    })
  }

  useEffect(() => {
    if (!hasLoaded.current) {
      hasLoaded.current = true
      loadMatch()
    }
  }, [])

  async function loadMatch() {
    logger.info('PAGE', 'Loading match', { matchId })
    setState('LOADING')

    try {
      await wait(500)

      const response = await apiCall<{ success: boolean; data: Match }>(
        `/api/matches/${matchId}`,
        { timeout: 5000 }
      )

      const matchData = response.data
      logger.info('PAGE', 'Match loaded', matchData)
      setMatch(matchData)

      // ‚öôÔ∏è Sync local innings from root (always)
      const rootInnings = matchData.currentInnings ?? 1
      const ssInnings = matchData.scoringState?.currentInnings
      if (ssInnings && ssInnings !== rootInnings) {
        logger.warning('SYNC', 'Innings mismatch detected on load', {
          rootInnings,
          scoringStateInnings: ssInnings,
        })
      }
      setCurrentInnings(rootInnings)


      if (!matchData.toss_winner) {
        logger.info('PAGE', 'No toss found, showing toss form')
        setState('TOSS')
      } else if (!matchData.batting_team) {
        logger.warning('PAGE', 'Toss found but no batting team - data corruption')
        setState('TOSS')
      } else {
        const hasPlayers =
          matchData.scoringState?.selectedBatsman1 &&
          matchData.scoringState?.selectedBatsman2 &&
          matchData.scoringState?.selectedBowler

        if (!hasPlayers) {
          logger.info('PAGE', 'Toss complete, no players, showing player selection')
          // ‚úÖ Ensure innings stays synced even when no players
          setCurrentInnings(rootInnings)
          setState('PLAYER_SELECTION')
        } else {
          logger.info('PAGE', 'Players found, restoring scoring state')

          // ‚úÖ Restore ALL state
          if (matchData.scoringState) {
            setBatsman1(matchData.scoringState.selectedBatsman1)
            setBatsman2(matchData.scoringState.selectedBatsman2)
            setBowler(matchData.scoringState.selectedBowler)
            setCurrentStriker(matchData.scoringState.currentStriker || 'batsman1') // ‚úÖ Restore striker
            setCurrentOver(matchData.scoringState.currentOver || [])
            setOutBatsmen(matchData.scoringState.outBatsmen || []) // ‚úÖ Restore out batsmen
            setPreviousBowler(matchData.scoringState.previousBowler || '')
          }
          // Prefer root-level innings and log mismatch (self-heal locally)
          const rootInnings = matchData.currentInnings ?? 1
          const ssInnings = matchData.scoringState?.currentInnings
          if (ssInnings && ssInnings !== rootInnings) {
            logger.warning('SYNC', 'Innings mismatch detected', {
              rootInnings,
              scoringStateInnings: ssInnings,
            })
          }
          setCurrentInnings(rootInnings)

          const team = getBattingTeamFromMatch(matchData)
          if (team) {
            setScore(team.total_score || 0)
            setWickets(team.total_wickets || 0)
            setBalls(team.total_balls || 0)
          }

          logger.debug('PAGE', 'State restored', {
            batsman1: matchData.scoringState?.selectedBatsman1,
            batsman2: matchData.scoringState?.selectedBatsman2,
            bowler: matchData.scoringState?.selectedBowler,
            currentStriker: matchData.scoringState?.currentStriker,
            currentOver: matchData.scoringState?.currentOver,
            outBatsmen: matchData.scoringState?.outBatsmen,
            score: team?.total_score,
          })

          setState('SCORING')
          toast.success('Match resumed!')
        }
      }
    } catch (err: any) {
      logger.error('PAGE', 'Failed to load match', err)
      
      // More specific error messages
      let errorMessage = 'Failed to load match'
      if (err.message?.includes('401') || err.message?.includes('Unauthorized')) {
        errorMessage = 'Authentication failed. Please log in again.'
      } else if (err.message?.includes('404')) {
        errorMessage = 'Match not found. Please check the match ID.'
      } else if (err.message?.includes('timeout')) {
        errorMessage = 'Request timed out. Please check your connection and try again.'
      } else if (err.message) {
        errorMessage = err.message
      }
      
      setError(errorMessage)
      setState('ERROR')
      toast.error(errorMessage)
    }
  }

  function getBattingTeamFromMatch(matchData: Match): Team | null {
    if (!matchData.batting_team) return null
    return matchData.batting_team === matchData.teamOne.name
      ? matchData.teamOne
      : matchData.teamTwo
  }

  async function handleTossComplete(winner: string, decision: 'bat' | 'bowl') {
    logger.info('TOSS', 'Processing toss', { winner, decision })

    try {
      if (!match) throw new Error('Match not loaded')

      const battingTeam =
        decision === 'bat'
          ? winner
          : winner === match.teamOne.name
            ? match.teamTwo.name
            : match.teamOne.name

      const bowlingTeam =
        decision === 'bowl'
          ? winner
          : winner === match.teamOne.name
            ? match.teamTwo.name
            : match.teamOne.name

      logger.debug('TOSS', 'Calculated teams', { battingTeam, bowlingTeam })

      await wait(1000)

      await apiCall(`/api/matches/${matchId}/score`, {
        method: 'POST',
        body: {
          toss_winner: winner,
          toss_decision: decision,
          batting_team: battingTeam,
          bowling_team: bowlingTeam,
          status: 'live',
        },
        timeout: 5000,
      })

      logger.success('TOSS', 'Toss saved to database')

      setMatch({
        ...match,
        toss_winner: winner,
        toss_decision: decision,
        batting_team: battingTeam,
        bowling_team: bowlingTeam,
        status: 'live',
      })

      await wait(1000)

      toast.success(`${winner} won the toss and chose to ${decision}`)

      setState('PLAYER_SELECTION')
    } catch (err: any) {
      logger.error('TOSS', 'Failed to save toss', err)
      toast.error(err.message || 'Failed to save toss')
      throw err
    }
  }

  async function handlePlayersSelected(
    selectedBatsman1: string,
    selectedBatsman2: string,
    selectedBowler: string
  ) {
    logger.info('PLAYERS', 'Processing player selection', {
      selectedBatsman1,
      selectedBatsman2,
      selectedBowler,
    })

    try {
      if (!match) throw new Error('Match not loaded')

      await wait(1000)

      await apiCall(`/api/matches/${matchId}/score`, {
        method: 'POST',
        body: {
          currentInnings,
          scoringState: {
            selectedBatsman1: selectedBatsman1,
            selectedBatsman2: selectedBatsman2,
            selectedBowler: selectedBowler,
            currentStriker: 'batsman1',
            currentOver: [],
            outBatsmen: [],
            currentInnings,
            previousBowler: '',
          },
        },
        timeout: 5000,
      })

      logger.success('PLAYERS', 'Players saved to database')

      setBatsman1(selectedBatsman1)
      setBatsman2(selectedBatsman2)
      setBowler(selectedBowler)
      setCurrentStriker('batsman1')
      setCurrentOver([])
      setOutBatsmen([])

      await wait(1000)

      toast.success('Players selected! Start scoring')

      setState('SCORING')
    } catch (err: any) {
      logger.error('PLAYERS', 'Failed to save players', err)
      toast.error(err.message || 'Failed to save players')
      throw err
    }
  }

  // Helper: apply per-player updates for striker and bowler
  function applyPlayerUpdates(
    outcome: string,
    strikerName: string,
    bowlerName: string,
    battingPlayers: Player[],
    bowlingPlayers: Player[]
  ) {
    const isWide = outcome === 'WD'
    const isNoBall = outcome === 'NB'
    const isBye = outcome === 'B'
    const isLegBye = outcome === 'LB'
    const isWicket = outcome === 'W'
    const numeric = /^[0-6]$/.test(outcome) ? parseInt(outcome, 10) : null
    const ballCounts = !isWide && !isNoBall // byes/leg-byes count as ball

    const newBatting = battingPlayers.map((p) => {
      if (p.name !== strikerName) return p
      const bp = { ...p }

      if (ballCounts) {
        bp.balls_played = (bp.balls_played || 0) + 1
      }

      if (numeric !== null) {
        bp.runs_scored = (bp.runs_scored || 0) + numeric
        if (numeric === 4) bp.fours = (bp.fours || 0) + 1
        if (numeric === 6) bp.sixes = (bp.sixes || 0) + 1
      }

      if (isWicket) {
        bp.is_out = true
        // Optional: bp.dismissal = 'out'
      }

      return bp
    })

    const newBowling = bowlingPlayers.map((p) => {
      if (p.name !== bowlerName) return p
      const bp = { ...p }

      if (ballCounts) {
        bp.balls_bowled = (bp.balls_bowled || 0) + 1
      }

      // Runs conceded: wides/noballs go to bowler; byes/leg-byes do not
      if (numeric !== null) {
        bp.runs_conceded = (bp.runs_conceded || 0) + numeric
      } else if (isWide || isNoBall) {
        bp.runs_conceded = (bp.runs_conceded || 0) + 1
      }

      if (isWicket && ballCounts) {
        bp.wickets = (bp.wickets || 0) + 1
      }

      return bp
    })

    return { newBatting, newBowling }
  }

  async function handleBallRecorded(outcome: string) {
    logger.info('BALL', `Recording ball: ${outcome}`)

    try {
      if (!match) throw new Error('Match not loaded')

      let runs = 0
      let isWicket = false
      let isExtra = false
      let ballCounts = true
      let shouldRotateStrike = false // ‚úÖ New

      switch (outcome) {
        case '0':
          runs = 0
          shouldRotateStrike = false
          break
        case '1':
        case '3':
        case '5':
          runs = parseInt(outcome)
          shouldRotateStrike = true // ‚úÖ Odd runs rotate strike
          break
        case '2':
        case '4':
        case '6':
          runs = parseInt(outcome)
          shouldRotateStrike = false // ‚úÖ Even runs don't rotate
          break
        case 'W':
          isWicket = true
          shouldRotateStrike = false
          break
        case 'WD':
        case 'NB':
        case 'B':
        case 'LB':
          runs = 1
          isExtra = true
          ballCounts = outcome !== 'WD' && outcome !== 'NB'
          shouldRotateStrike = false // ‚úÖ Simplified: no rotation on extras
          break
      }

      const newScore = score + runs
      const newWickets = isWicket ? wickets + 1 : wickets
      const newBalls = ballCounts ? balls + 1 : balls
      const newCurrentOver = [...currentOver, outcome]

      setScore(newScore)
      setWickets(newWickets)
      setBalls(newBalls)
      setCurrentOver(newCurrentOver)

      // ‚úÖ Handle wicket
      if (isWicket) {
        logger.info('BALL', 'Wicket fallen', {
          striker: currentStriker,
          outPlayer: currentStriker === 'batsman1' ? batsman1 : batsman2,
        })

        const dismissedBatsman =
          currentStriker === 'batsman1' ? batsman1 : batsman2
        const newOutBatsmen = [...outBatsmen, dismissedBatsman]
        setOutBatsmen(newOutBatsmen)
        setOutBatsman(dismissedBatsman)

        const newScore = score + runs
        const newWickets = wickets + 1
        const newBalls = balls + 1
        const newCurrentOver = [...currentOver, outcome]

        setScore(newScore)
        setWickets(newWickets)
        setBalls(newBalls)
        setCurrentOver(newCurrentOver)

        // ‚úÖ SAVE WICKET TO DATABASE FIRST
        await wait(500)

        const teamToUpdate =
          match.batting_team === match.teamOne.name ? 'teamOne' : 'teamTwo'
        const opponentKey =
          match.bowling_team === match.teamOne.name ? 'teamOne' : 'teamTwo'

        // NEW: per-player updates
        const strikerName =
          currentStriker === 'batsman1' ? batsman1 : batsman2
        const { newBatting, newBowling } = applyPlayerUpdates(
          outcome,
          strikerName,
          bowler,
          (match as any)[teamToUpdate].players,
          (match as any)[opponentKey].players
        )

        const response = await apiCall<{ success: boolean; data: Match }>(
          `/api/matches/${matchId}/score`,
          {
            method: 'POST',
            body: {
              currentInnings,
              [`${teamToUpdate}.total_score`]: newScore,
              [`${teamToUpdate}.total_wickets`]: newWickets,
              [`${teamToUpdate}.total_balls`]: newBalls,
              // NEW: write updated player arrays
              [`${teamToUpdate}.players`]: newBatting,
              [`${opponentKey}.players`]: newBowling,
              scoringState: {
                selectedBatsman1: batsman1,
                selectedBatsman2: batsman2,
                selectedBowler: bowler,
                previousBowler: previousBowler,
                currentStriker: currentStriker,
                currentOver: newCurrentOver,
                outBatsmen: newOutBatsmen,
                currentInnings,
              },
            },
            timeout: 5000,
          }
        )

        // ‚úÖ CRITICAL: Update match state with latest data from database
        if (response.success && response.data) {
          setMatch(response.data)
          logger.debug('BALL', 'Match state updated after wicket', {
            teamOne_players: response.data.teamOne?.players?.length,
            teamTwo_players: response.data.teamTwo?.players?.length,
          })
        }

        logger.success('BALL', 'Wicket saved to database')
        toast.error(`Wicket! ${dismissedBatsman} is out`)

        // ‚úÖ NOW CHECK FOR ALL OUT (after saving)
        const battingTeamPlayers = battingTeam?.players || []
        const totalPlayers = battingTeamPlayers.length
        const availableBatsmenCount = battingTeamPlayers.filter(
          (p: Player) => !newOutBatsmen.includes(p.name)
        ).length

        logger.debug('BALL', 'All out check', {
          totalPlayers,
          wickets: newWickets,
          outBatsmen: newOutBatsmen.length,
          availableBatsmen: availableBatsmenCount,
        })

        // ‚úÖ All out conditions
        const isAllOut =
          availableBatsmenCount === 0 || // No batsmen left
          newWickets >= totalPlayers - 1 || // All wickets down
          (totalPlayers === 2 && newWickets >= 1) // Special case: 2 players, 1 wicket

        if (isAllOut) {
          logger.info('BALL', 'All Out! Innings complete')
          toast.error('All Out! Innings complete')

          // ‚úÖ Handle innings end properly
          await handleInningsComplete(newScore, newWickets)
          return
        }

        // ‚úÖ Not all out - show batsman selection
        setNeedsBatsmanChange(true)
        return
      }

      // ‚úÖ Rotate strike if needed
      let newStriker = currentStriker
      if (shouldRotateStrike) {
        newStriker = currentStriker === 'batsman1' ? 'batsman2' : 'batsman1'
        setCurrentStriker(newStriker)
        logger.debug('BALL', 'Strike rotated', {
          from: currentStriker,
          to: newStriker,
        })
      }

      const legalBalls = newCurrentOver.filter(
        (b) => !['WD', 'NB'].includes(b)
      ).length

      // ‚úÖ Handle over completion
      if (legalBalls === 6) {
        logger.info('BALL', 'Over completed, need bowler change')
        toast.success('Over completed! Select new bowler')

        // ‚úÖ Rotate strike at end of over
        const strikerAfterOver =
          newStriker === 'batsman1' ? 'batsman2' : 'batsman1'
        setCurrentStriker(strikerAfterOver)

        setPreviousBowler(bowler)
        setCurrentOver([])
        setNeedsBowlerChange(true)

        logger.debug('BALL', 'Strike rotated after over', {
          newStriker: strikerAfterOver,
        })

        return
      }

      // ‚úÖ Save normal ball
      await wait(500)

      const teamToUpdate =
        match.batting_team === match.teamOne.name ? 'teamOne' : 'teamTwo'
      const opponentKey =
        match.bowling_team === match.teamOne.name ? 'teamOne' : 'teamTwo'

      // NEW: per-player updates (normal ball)
      const strikerName = currentStriker === 'batsman1' ? batsman1 : batsman2
      const { newBatting, newBowling } = applyPlayerUpdates(
        outcome,
        strikerName,
        bowler,
        (match as any)[teamToUpdate].players,
        (match as any)[opponentKey].players
      )

      const response = await apiCall<{ success: boolean; data: Match }>(
        `/api/matches/${matchId}/score`,
        {
          method: 'POST',
          body: {
            currentInnings,
            [`${teamToUpdate}.total_score`]: newScore,
            [`${teamToUpdate}.total_wickets`]: newWickets,
            [`${teamToUpdate}.total_balls`]: newBalls,
            // NEW: write updated player arrays
            [`${teamToUpdate}.players`]: newBatting,
            [`${opponentKey}.players`]: newBowling,
            scoringState: {
              selectedBatsman1: batsman1,
              selectedBatsman2: batsman2,
              selectedBowler: bowler,
              previousBowler: previousBowler,
              currentStriker: newStriker,
              currentOver: newCurrentOver,
              outBatsmen: outBatsmen,
              currentInnings,
            },
          },
          timeout: 5000,
        }
      )

      // ‚úÖ CRITICAL: Update match state with latest data from database
      if (response.success && response.data) {
        setMatch(response.data)
        logger.debug('BALL', 'Match state updated with latest player stats', {
          teamOne_players: response.data.teamOne?.players?.length,
          teamTwo_players: response.data.teamTwo?.players?.length,
        })
      }

      logger.success('BALL', 'Ball saved to database')
    } catch (err: any) {
      logger.error('BALL', 'Failed to save ball', err)
      toast.error(err.message || 'Failed to save ball')
      throw err
    }
  }


  async function handleInningsComplete(finalScore: number, finalWickets: number) {
    logger.info('INNINGS', 'Innings completed', {
      score: finalScore,
      wickets: finalWickets,
      currentInnings,
    })

    try {
      if (!match) throw new Error('Match not loaded')

      const teamToUpdate =
        match.batting_team === match.teamOne.name ? 'teamOne' : 'teamTwo'

      // ‚úÖ Check if this is first or second innings
      if (currentInnings === 1) {
        // ‚úÖ First innings complete - start second innings
        const target = finalScore + 1

        logger.info('INNINGS', 'First innings complete, setting target', {
          target,
        })

        // Swap teams
        const newBattingTeam = match.bowling_team!
        const newBowlingTeam = match.batting_team!

        await wait(1000)

        // Update match with target and reset for second innings
        await apiCall(`/api/matches/${matchId}/score`, {
          method: 'POST',
          body: {
            currentInnings: 2,          // ‚úÖ root
            batting_team: newBattingTeam, // ‚úÖ root
            bowling_team: newBowlingTeam,
            target: target,
            scoringState: {
              selectedBatsman1: '',
              selectedBatsman2: '',
              selectedBowler: '',
              previousBowler: '',
              currentStriker: 'batsman1',
              currentOver: [],
              outBatsmen: [],
              currentInnings: 2,
            },
          },
          timeout: 5000,
        })

        logger.success('INNINGS', 'Target set, second innings ready')

        toast.success(`First innings complete! Target: ${target}`, {
          duration: 4000,
        })

        // Update local state
        setMatch({
          ...match,
          target: target,
          batting_team: newBattingTeam,
          bowling_team: newBowlingTeam,
        })
        setCurrentInnings(2)
        // Reset for second innings
        setBatsman1('')
        setBatsman2('')
        setBowler('')
        setCurrentStriker('batsman1')
        setCurrentOver([])
        setOutBatsmen([])
        setPreviousBowler('')
        setScore(0)
        setWickets(0)
        setBalls(0)

        await wait(2000)

        // Show player selection for second innings
        setState('PLAYER_SELECTION')
        toast('Select opening batsmen and bowler for second innings')
      } else {
        // ‚úÖ Second innings complete - match over
        logger.info('INNINGS', 'Second innings complete - match over')

        await wait(1000)

        // Determine winner
        const target = match.target || 0
        let winMessage = ''

        if (finalScore >= target) {
          const wicketsLeft = (battingTeam?.players.length || 10) - finalWickets
          winMessage = `${match.batting_team} won by ${wicketsLeft} wickets!`
        } else {
          const runDiff = target - 1 - finalScore
          winMessage = `${match.bowling_team} won by ${runDiff} runs!`
        }

        // Mark match as completed
        await apiCall(`/api/matches/${matchId}/score`, {
          method: 'POST',
          body: {
            status: 'completed',
            scoringState: null, // Clear scoring state
          },
          timeout: 5000,
        })

        logger.success('MATCH', 'Match completed', { winner: winMessage })

        toast.success(winMessage, { duration: 5000 })

        await wait(3000)

        // Redirect to match details
        router.push(`/matches/${matchId}`)
      }
    } catch (err: any) {
      logger.error('INNINGS', 'Failed to handle innings end', err)
      toast.error(err.message || 'Failed to end innings')
    }
  }


  async function handleBowlerChange(newBowler: string) {
    logger.info('BOWLER', 'Changing bowler', { from: bowler, to: newBowler })

    if (newBowler === previousBowler) {
      toast.error('Bowler cannot bowl consecutive overs!')
      return
    }

    try {
      setBowler(newBowler)
      setNeedsBowlerChange(false)

      await wait(500)

      await apiCall(`/api/matches/${matchId}/score`, {
        method: 'POST',
        body: {
          currentInnings,
          scoringState: {
            selectedBatsman1: batsman1,
            selectedBatsman2: batsman2,
            selectedBowler: newBowler,
            previousBowler: bowler,
            currentStriker: currentStriker, // ‚úÖ Preserve striker
            currentOver: [],
            outBatsmen: outBatsmen,
            currentInnings,
          },
        },
        timeout: 5000,
      })

      logger.success('BOWLER', 'Bowler changed successfully')
      toast.success(`${newBowler} to bowl next over`)
    } catch (err: any) {
      logger.error('BOWLER', 'Failed to change bowler', err)
      toast.error(err.message || 'Failed to change bowler')
    }
  }

  async function handleBatsmanChange(newBatsman: string) {
    logger.info('BATSMAN', 'Changing batsman', {
      out: outBatsman,
      new: newBatsman,
      currentStriker,
      batsman1,
      batsman2,
    })

    try {
      // ‚úÖ Calculate new values BEFORE setting state
      const newBatsman1 = currentStriker === 'batsman1' ? newBatsman : batsman1
      const newBatsman2 = currentStriker === 'batsman2' ? newBatsman : batsman2

      // ‚úÖ Validation: Prevent duplicate
      if (newBatsman1 === newBatsman2) {
        logger.error('BATSMAN', 'Duplicate batsman detected!', {
          newBatsman1,
          newBatsman2,
        })
        toast.error('Error: Same player cannot bat in both positions!')
        return
      }

      logger.debug('BATSMAN', 'New lineup', {
        newBatsman1,
        newBatsman2,
      })

      // ‚úÖ Update state
      setBatsman1(newBatsman1)
      setBatsman2(newBatsman2)
      setNeedsBatsmanChange(false)

      await wait(500)

      // ‚úÖ Save with calculated values (not state variables)
      await apiCall(`/api/matches/${matchId}/score`, {
        method: 'POST',
        body: {
          currentInnings,
          scoringState: {
            selectedBatsman1: newBatsman1, // ‚úÖ Use calculated value
            selectedBatsman2: newBatsman2, // ‚úÖ Use calculated value
            selectedBowler: bowler,
            previousBowler: previousBowler,
            currentStriker: currentStriker,
            currentOver: currentOver,
            outBatsmen: outBatsmen,
            currentInnings,
          },
        },
        timeout: 5000,
      })

      logger.success('BATSMAN', 'New batsman saved successfully', {
        savedBatsman1: newBatsman1,
        savedBatsman2: newBatsman2,
      })

      toast.success(`${newBatsman} is in to bat`)
    } catch (err: any) {
      logger.error('BATSMAN', 'Failed to change batsman', err)
      toast.error(err.message || 'Failed to change batsman')
    }
  }

  // Render states
  if (state === 'LOADING') {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading match...</p>
        </div>
      </div>
    )
  }

  if (state === 'ERROR') {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <Card className="p-6 max-w-md">
          <h2 className="text-xl font-bold text-red-600 mb-4">Error</h2>
          <p className="text-gray-700 mb-4">{error}</p>
          <Button onClick={loadMatch} className="w-full" data-testid="retry-button">
            Retry
          </Button>
        </Card>
      </div>
    )
  }

  if (!match) return null

  const strikerName = currentStriker === 'batsman1' ? batsman1 : batsman2
  const nonStrikerName = currentStriker === 'batsman1' ? batsman2 : batsman1

  return (
    <>
      <Toaster position="top-center" />

      <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
        {/* Header */}
        <div className="bg-white border-b sticky top-0 z-10 shadow-sm">
          <div className="container mx-auto px-4 py-3">
            <div className="flex justify-between items-center">
              <button
                onClick={() => router.push(`/matches/${matchId}`)}
                className="flex items-center gap-2 text-gray-600 hover:text-gray-900"
              >
                <ArrowLeft className="h-5 w-5" />
                <span>Back</span>
              </button>

              <div className="flex items-center gap-3">
                <span className="font-mono font-bold text-lg">
                  {match.matchCode}
                </span>
                {match.status === 'live' && (
                  <div className="flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium">
                    <Circle className="h-3 w-3 fill-current animate-pulse" />
                    LIVE
                  </div>
                )}
                <Button
                  size="sm"
                  variant="secondary"
                  onClick={() => logger.downloadLogs()}
                >
                  <Download className="h-4 w-4" />
                </Button>
              </div>
            </div>
          </div>
        </div>

        <div className="container mx-auto px-4 py-6 max-w-4xl">
          {/* Debug Info */}
          {process.env.NODE_ENV === 'development' && (
            <Card className="p-4 mb-4 bg-gray-50">
              <div className="text-xs font-mono space-y-1">
                <div>
                  <strong>State:</strong> {state}
                </div>
                <div>
                  <strong>Innings:</strong> {currentInnings}
                </div>
                <div className={batsman1 === batsman2 ? 'text-red-600 font-bold' : ''}>
                  <strong>Batsman1:</strong> {batsman1 || 'none'}{' '}
                  {currentStriker === 'batsman1' && '(ON STRIKE)'}
                  {batsman1 === batsman2 && ' ‚ö†Ô∏è DUPLICATE!'}
                </div>
                <div className={batsman1 === batsman2 ? 'text-red-600 font-bold' : ''}>
                  <strong>Batsman2:</strong> {batsman2 || 'none'}{' '}
                  {currentStriker === 'batsman2' && '(ON STRIKE)'}
                  {batsman1 === batsman2 && ' ‚ö†Ô∏è DUPLICATE!'}
                </div>
                <div>
                  <strong>Bowler:</strong> {bowler || 'none'}
                </div>
                <div>
                  <strong>Score:</strong> {score}/{wickets} ({balls} balls)
                </div>
                <div>
                  <strong>Out:</strong> [{outBatsmen.join(', ')}]
                </div>
                <div>
                  <strong>Available:</strong> {getAvailableBatsmen().map(p => p.name).join(', ')}
                </div>
              </div>
            </Card>
          )}

          {/* Score Display */}
          {state === 'SCORING' && battingTeam && bowlingTeam && (
            <div className="grid md:grid-cols-2 gap-4 mb-6">
              <Card className="p-6 bg-gradient-to-br from-green-500 to-green-600 text-white">
                <h3 className="text-sm font-medium opacity-90 mb-2">BATTING</h3>
                <h2 className="text-2xl font-bold mb-2">{battingTeam.name}</h2>
                <div className="text-4xl font-bold">
                  {score}/{wickets}
                </div>
                <p className="text-sm opacity-90 mt-2">
                  Overs: {Math.floor(balls / 6)}.{balls % 6}
                </p>
              </Card>

              <Card className="p-6 bg-gradient-to-br from-blue-500 to-blue-600 text-white">
                <h3 className="text-sm font-medium opacity-90 mb-2">BOWLING</h3>
                <h2 className="text-2xl font-bold">{bowlingTeam.name}</h2>
              </Card>
            </div>
          )}

          {/* Render current state */}
          {state === 'TOSS' && (
            <TossForm
              teamOneName={match.teamOne.name}
              teamTwoName={match.teamTwo.name}
              onTossComplete={handleTossComplete}
            />
          )}

          {state === 'PLAYER_SELECTION' && battingTeam && bowlingTeam && (
            <PlayerSelectionForm
              battingTeamName={match.batting_team!}
              bowlingTeamName={match.bowling_team!}
              battingPlayers={battingTeam.players}
              bowlingPlayers={bowlingTeam.players}
              onPlayersSelected={handlePlayersSelected}
            />
          )}

          {/* ‚úÖ Batsman Change (After Wicket) */}
          {state === 'SCORING' && needsBatsmanChange && battingTeam && (
            <BatsmanChangeForm
              availableBatsmen={getAvailableBatsmen()}
              outBatsman={outBatsman}
              onBatsmanSelected={handleBatsmanChange}
            />
          )}

          {/* ‚úÖ Bowler Change (After Over) */}
          {state === 'SCORING' && needsBowlerChange && bowlingTeam && (
            <Card className="p-6 mb-6 border-2 border-blue-500">
              <h3 className="text-lg font-bold mb-2">üéØ Select New Bowler</h3>
              <p className="text-sm text-gray-600 mb-4">
                Over completed! Select the bowler for the next over.
              </p>

              {previousBowler && (
                <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4">
                  <p className="text-xs text-yellow-800">
                    ‚ö†Ô∏è {previousBowler} cannot bowl consecutive overs
                  </p>
                </div>
              )}

              <div className="space-y-2">
                {bowlingTeam.players
                  .filter((p) => p.name !== previousBowler)
                  .map((player, i) => (
                    <button
                      key={i}
                      onClick={() => handleBowlerChange(player.name)}
                      className="w-full p-3 border rounded-lg hover:bg-blue-50 hover:border-blue-500 transition text-left"
                    >
                      <span className="font-medium">{player.name}</span>
                      {player.is_captain && (
                        <span className="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">
                          C
                        </span>
                      )}
                      {player.is_keeper && (
                        <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                          WK
                        </span>
                      )}
                    </button>
                  ))}
              </div>
            </Card>
          )}

          {/* ‚úÖ Scoring Interface (Only when not changing players) */}
          {state === 'SCORING' &&
            !needsBowlerChange &&
            !needsBatsmanChange &&
            batsman1 &&
            batsman2 &&
            bowler && (
              <ScoringInterface
                striker={batsman1}
                nonStriker={batsman2}
                bowler={bowler}
                currentOver={currentOver}
                currentStriker={currentStriker}
                onBallRecorded={handleBallRecorded}
              />
            )}
        </div>
      </div>
    </>
  )
}

===== FILE: app/matches/[id]/scorecard/page.tsx =====
'use client'

import { useEffect, useState } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import ScoreCard from '@/components/sections/ScoreCard'
import {
  ArrowLeft,
  Trophy,
  Share2,
  Printer,
  Calendar,
  MapPin,
  Copy,
  Clock
} from 'lucide-react'
import toast, { Toaster } from 'react-hot-toast'
import { motion } from 'framer-motion'

export default function ScorecardPage() {
  const params = useParams()
  const router = useRouter()
  const matchId = params.id as string

  const [match, setMatch] = useState<any>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchMatch()
  }, [matchId])
  
  const fetchMatch = async () => {
    try {
      const token = localStorage.getItem('auth_token')
      const response = await fetch(`/api/matches/${matchId}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (!response.ok) {
        toast.error('Failed to load match')
        router.push('/dashboard')
        return
      }
      
      const data = await response.json()
      console.log("scoreboard data",data)
      setMatch(data.data)
    } catch (err) {
      toast.error('Failed to load match details')
      console.error('Fetch match error:', err)
    } finally {
      setLoading(false)
    }
  }

  const getMatchResult = () => {
    if (!match || match.status !== 'completed') return null

    if (match.target && match.currentInnings === 2) {
      const battingTeam = match.batting_team === match.teamOne.name ? match.teamOne : match.teamTwo
      const bowlingTeam = match.bowling_team === match.teamOne.name ? match.teamOne : match.teamTwo

      if (battingTeam.total_score >= match.target) {
        const wicketsLeft = 10 - battingTeam.total_wickets
        return `${match.batting_team} won by ${wicketsLeft} wickets`
      } else {
        const runsDiff = match.target - 1 - battingTeam.total_score
        return `${match.bowling_team} won by ${runsDiff} runs`
      }
    }

    // First innings only or draw
    if (match.teamOne.total_score > match.teamTwo.total_score) {
      return `${match.teamOne.name} won by ${match.teamOne.total_score - match.teamTwo.total_score} runs`
    } else if (match.teamTwo.total_score > match.teamOne.total_score) {
      return `${match.teamTwo.name} won by ${match.teamTwo.total_score - match.teamOne.total_score} runs`
    }

    return 'Match Tied'
  }

  const handleShare = () => {
    const result = getMatchResult()
    const shareText = `üèè Match Scorecard\n\n${match?.teamOne.name} vs ${match?.teamTwo.name}\n${result}\n\nMatch Code: ${match?.matchCode}\n\nView full scorecard: ${window.location.href}`

    if (navigator.share) {
      navigator.share({
        title: 'Cricket Match Scorecard',
        text: shareText,
        url: window.location.href
      })
    } else {
      navigator.clipboard.writeText(shareText)
      toast.success('Scorecard link copied!')
    }
  }

  const handlePrint = () => {
    window.print()
  }

  const copyMatchCode = () => {
    navigator.clipboard.writeText(match.matchCode)
    toast.success('Match code copied!')
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <div className="text-center">
          <div className="h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading scorecard...</p>
        </div>
      </div>
    )
  }

  if (!match) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 via-white to-emerald-50">
        <Card className="p-8 text-center">
          <Trophy className="h-12 w-12 text-gray-400 mx-auto mb-4" />
          <h2 className="text-xl font-bold text-gray-900 mb-2">Match Not Found</h2>
          <p className="text-gray-600 mb-4">This match doesn't exist or has been removed.</p>
          <Button onClick={() => router.push('/dashboard')}>
            Back to Dashboard
          </Button>
        </Card>
      </div>
    )
  }

  return (
    <>
      <Toaster position="top-center" />

      <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
        {/* Header */}
        <div className="bg-white border-b sticky top-0 z-10 print:hidden shadow-sm">
          <div className="container mx-auto px-4 py-4">
            <div className="flex items-center justify-between">
              <button
                onClick={() => router.back()}
                className="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
              >
                <ArrowLeft className="h-5 w-5" />
                <span className="hidden sm:inline">Back</span>
              </button>

              <h1 className="text-lg font-semibold text-gray-900">Scorecard</h1>

              <div className="flex items-center gap-2">
                <Button
                  variant="secondary"
                  size="icon"
                  onClick={handleShare}
                  title="Share"
                >
                  <Share2 className="h-4 w-4" />
                </Button>
                <Button
                  variant="secondary"
                  size="icon"
                  onClick={handlePrint}
                  title="Print"
                >
                  <Printer className="h-4 w-4" />
                </Button>
              </div>
            </div>
          </div>
        </div>

        <div className="container mx-auto px-4 py-8 max-w-6xl">
          {/* Match Header Info */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="mb-8"
          >
            <Card className="p-6 bg-gradient-to-r from-green-500 to-emerald-500 text-white">
              <div className="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-3">
                    <Trophy className="h-8 w-8" />
                    <div>
                      <h1 className="text-2xl font-bold">
                        {match.teamOne.name} vs {match.teamTwo.name}
                      </h1>
                      {match.status === 'completed' && (
                        <p className="text-green-100 text-sm">
                          Match Completed
                        </p>
                      )}
                    </div>
                  </div>

                  {/* Match Result */}
                  {match.status === 'completed' && (
                    <div className="bg-white/20 rounded-lg p-3 mt-4">
                      <p className="text-xl font-bold">
                        üèÜ {getMatchResult()}
                      </p>
                    </div>
                  )}
                </div>

                <div className="flex flex-col gap-2 text-sm">
                  <div className="flex items-center gap-2 text-green-100">
                    <MapPin className="h-4 w-4" />
                    <span>{match.venue}</span>
                  </div>
                  <div className="flex items-center gap-2 text-green-100">
                    <Calendar className="h-4 w-4" />
                    <span>{new Date(match.startTime).toLocaleDateString()}</span>
                  </div>
                  <div className="flex items-center gap-2 text-green-100">
                    <Clock className="h-4 w-4" />
                    <span>{match.overs} Overs Match</span>
                  </div>
                </div>
              </div>

              {/* Toss Info */}
              {match.toss_winner && (
                <div className="mt-4 pt-4 border-t border-white/20">
                  <p className="text-sm text-green-100">
                    <span className="font-medium">Toss:</span> {match.toss_winner} won and chose to {match.toss_decision}
                  </p>
                </div>
              )}
            </Card>
          </motion.div>

          {/* Use the Existing ScoreCard Component */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
          >
            <ScoreCard
              match={match} isLive={true} viewersCount={1500} />
          </motion.div>

          {/* Match Code Share Section */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="mt-8 print:hidden"
          >
            <Card className="p-6">
              <div className="text-center">
                <p className="text-sm text-gray-600 mb-4">
                  Share this scorecard with friends using the match code
                </p>
                <div className="inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
                  <div>
                    <p className="text-xs text-gray-500 mb-1">Match Code</p>
                    <span className="text-2xl font-mono font-bold text-green-700">
                      {match.matchCode}
                    </span>
                  </div>
                  <Button
                    size="sm"
                    variant="secondary"
                    onClick={copyMatchCode}
                    className="gap-2"
                  >
                    <Copy className="h-3 w-3" />
                    Copy
                  </Button>
                </div>

                <div className="mt-4 flex justify-center gap-3">
                  <Button
                    variant="secondary"
                    onClick={handleShare}
                    className="gap-2"
                  >
                    <Share2 className="h-4 w-4" />
                    Share Scorecard
                  </Button>
                  <Button
                    variant="secondary"
                    onClick={() => router.push(`/matches/${matchId}`)}
                    className="gap-2"
                  >
                    View Match Details
                  </Button>
                </div>
              </div>
            </Card>
          </motion.div>
        </div>
      </div>

      {/* Print Styles */}
      <style jsx global>{`
        @media print {
          .print\\:hidden {
            display: none !important;
          }
          
          body {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
          }
          
          @page {
            margin: 1cm;
          }
        }
      `}</style>
    </>
  )
}

===== FILE: app/matches/create/page.tsx =====
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'
import { ArrowLeft, ArrowRight, Users, Trophy, Calendar, MapPin, Plus, X, AlertCircle } from 'lucide-react'
import toast, { Toaster } from 'react-hot-toast'
import { motion, AnimatePresence } from 'framer-motion'

interface Player {
  name: string
  is_captain?: boolean
  is_keeper?: boolean
}

interface Team {
  name: string
  players: Player[]
}

export default function CreateMatchPage() {
  const router = useRouter()
  const [step, setStep] = useState(1)
  const [loading, setLoading] = useState(false)

  // Match Details
  const [matchData, setMatchData] = useState({
    venue: '',
    overs: 20,
    startTime: new Date().toISOString().slice(0, 16),
    isPrivate: false
  })

  // Team 1
  const [team1, setTeam1] = useState<Team>({
    name: '',
    players: []
  })
const [team1PlayerInput, setTeam1PlayerInput] = useState('')

// Team 2
const [team2, setTeam2] = useState<Team>({
  name: '',
  players: []
})
const [team2PlayerInput, setTeam2PlayerInput] = useState('')

// Add player to team with DUPLICATE CHECK
const addPlayer = (team: 'team1' | 'team2') => {
  const input = team === 'team1' ? team1PlayerInput : team2PlayerInput
  const currentTeam = team === 'team1' ? team1 : team2

  // Trim and validate input
  const playerName = input.trim()

  if (!playerName) {
    toast.error('Please enter a player name')
    return
  }

  // Check if player limit reached
  if (currentTeam.players.length >= 11) {
    toast.error('Maximum 11 players allowed per team')
    return
  }

  // CHECK FOR DUPLICATE PLAYER NAMES
  const isDuplicate = currentTeam.players.some(
    player => player.name.toLowerCase() === playerName.toLowerCase()
  )

  if (isDuplicate) {
    toast.error(`Player "${playerName}" already exists in this team`)
    return
  }

  const newPlayer: Player = {
    name: playerName,
    is_captain: currentTeam.players.length === 0, // First player is captain by default
    is_keeper: currentTeam.players.length === 1   // Second player is keeper by default
  }

  if (team === 'team1') {
    setTeam1({ ...team1, players: [...team1.players, newPlayer] })
    setTeam1PlayerInput('')
    console.log(team1)
    console.log(setTeam1PlayerInput)
  } else {
    setTeam2({ ...team2, players: [...team2.players, newPlayer] })
    setTeam2PlayerInput('')
  }
}

// Remove player
const removePlayer = (team: 'team1' | 'team2', index: number) => {
  if (team === 'team1') {
    const playerName = team1.players[index].name
    setTeam1({
      ...team1,
      players: team1.players.filter((_, i) => i !== index)
    })
  } else {
    const playerName = team2.players[index].name
    setTeam2({
      ...team2,
      players: team2.players.filter((_, i) => i !== index)
    })
  }
}

// Toggle captain/keeper
const toggleRole = (team: 'team1' | 'team2', index: number, role: 'captain' | 'keeper') => {
  const currentTeam = team === 'team1' ? team1 : team2
  const updatedPlayers = currentTeam.players.map((player, i) => {
    if (role === 'captain') {
      return { ...player, is_captain: i === index }
    } else {
      return { ...player, is_keeper: i === index }
    }
  })

  if (team === 'team1') {
    setTeam1({ ...team1, players: updatedPlayers })
  } else {
    setTeam2({ ...team2, players: updatedPlayers })
  }
}

// ENHANCED VALIDATION
const validateStep = () => {
  if (step === 1) {
    if (!matchData.venue.trim()) {
      toast.error('Please enter a venue')
      return false
    }
    if (!matchData.startTime) {
      toast.error('Please select start time')
      return false
    }
  }
  else if (step === 2) {
    if (!team1.name.trim()) {
      toast.error('Please enter Team 1 name')
      return false
    }
    if (team1.players.length < 2) {
      toast.error('Team 1 needs at least 2 players')
      return false
    }
    const hasCaptain = team1.players.some(p => p.is_captain)
    if (!hasCaptain) {
      toast.error('Please select a captain for Team 1')
      return false
    }
  }
  else if (step === 3) {
    if (!team2.name.trim()) {
      toast.error('Please enter Team 2 name')
      return false
    }
    if (team2.players.length < 2) {
      toast.error('Team 2 needs at least 2 players')
      return false
    }
    // CHECK FOR DUPLICATE TEAM NAMES
    if (team1.name.trim().toLowerCase() === team2.name.trim().toLowerCase()) {
      toast.error('Teams cannot have the same name')
      return false
    }
    const hasCaptain = team2.players.some(p => p.is_captain)
    if (!hasCaptain) {
      toast.error('Please select a captain for Team 2')
      return false
    }
  }
  return true
}

// Handle next step
const handleNext = () => {
  if (validateStep()) {
    setStep(step + 1)
  }
}

// Handle create match
const handleCreateMatch = async () => {
  if (!validateStep()) return

  setLoading(true)
  try {
    const token = localStorage.getItem('auth_token')

    const response = await fetch('/api/matches', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        ...matchData,
        teamOne: team1,
        teamTwo: team2
      })
    })

    const data = await response.json()

    if (!response.ok) {
      throw new Error(data.error || 'Failed to create match')
    }

    toast.success(
      <div className="flex flex-col">
        <span>Match created successfully!</span>
        <span className="font-bold text-lg">Code: {data.data.matchCode}</span>
      </div>,
      { duration: 5000 }
    )

    setTimeout(() => {
      router.push(`/matches/${data.data._id}`)
    }, 2000)
  } catch (error) {
    toast.error(error instanceof Error ? error.message : 'Failed to create match')
    setLoading(false)
  }
}

return (
  <>
    <Toaster position="top-center" />

    <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
      {/* Header */}
      <div className="bg-white border-b border-gray-100 sticky top-0 z-10">
        <div className="container mx-auto px-4 py-4 flex items-center justify-between">
          <button
            onClick={() => router.back()}
            className="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors"
          >
            <ArrowLeft className="h-5 w-5" />
            <span>Back</span>
          </button>

          <h1 className="text-xl font-bold text-gray-900">Create Match</h1>

          <div className="text-sm text-gray-500">
            Step {step} of 4
          </div>
        </div>
      </div>

      {/* Progress Bar */}
      <div className="w-full bg-gray-200 h-1">
        <motion.div
          className="bg-gradient-to-r from-green-500 to-emerald-500 h-1"
          initial={{ width: '0%' }}
          animate={{ width: `${(step / 4) * 100}%` }}
          transition={{ duration: 0.3 }}
        />
      </div>

      <div className="container mx-auto px-4 py-8 max-w-2xl">
        <AnimatePresence mode="wait">
          {/* Step 1: Match Details */}
          {step === 1 && (
            <motion.div
              key="step1"
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              className="space-y-6"
            >
              <Card className="p-6">
                <div className="flex items-center gap-3 mb-6">
                  <div className="p-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl">
                    <Trophy className="h-6 w-6" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900">Match Details</h2>
                    <p className="text-gray-600">Set up your match information</p>
                  </div>
                </div>

                <div className="space-y-4">
                  {/* Venue */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      <MapPin className="inline h-4 w-4 mr-1" />
                      Venue
                    </label>
                    <input
                      type="text"
                      value={matchData.venue}
                      onChange={(e) => setMatchData({ ...matchData, venue: e.target.value })}
                      placeholder="e.g., Local Park Ground"
                      className="w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                  </div>

                  {/* Overs */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Number of Overs
                    </label>
                    <select
                      value={matchData.overs}
                      onChange={(e) => setMatchData({ ...matchData, overs: parseInt(e.target.value) })}
                      className="w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
                      {[5, 10, 15, 20, 25, 30, 35, 40, 45, 50].map(num => (
                        <option key={num} value={num}>{num} Overs</option>
                      ))}
                    </select>
                  </div>

                  {/* Start Time */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      <Calendar className="inline h-4 w-4 mr-1" />
                      Start Time
                    </label>
                    <input
                      type="datetime-local"
                      value={matchData.startTime}
                      onChange={(e) => setMatchData({ ...matchData, startTime: e.target.value })}
                      className="w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    />
                  </div>

                  {/* Private Match */}
                  <div className="flex items-center gap-3">
                    <input
                      type="checkbox"
                      id="private"
                      checked={matchData.isPrivate}
                      onChange={(e) => setMatchData({ ...matchData, isPrivate: e.target.checked })}
                      className="h-4 w-4 text-green-600 rounded focus:ring-green-500"
                    />
                    <label htmlFor="private" className="text-sm text-gray-700">
                      Make this a private match (only accessible via code)
                    </label>
                  </div>
                </div>
              </Card>

              <Button
                onClick={handleNext}
                className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white"
              >
                Next: Team 1 Setup
                <ArrowRight className="ml-2 h-5 w-5" />
              </Button>
            </motion.div>
          )}

          {/* Step 2: Team 1 */}
          {step === 2 && (
            <motion.div
              key="step2"
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              className="space-y-6"
            >
              <Card className="p-6">
                <div className="flex items-center gap-3 mb-6">
                  <div className="p-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl">
                    <Users className="h-6 w-6" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900">Team 1 Setup</h2>
                    <p className="text-gray-600">Add team name and players</p>
                  </div>
                </div>

                <div className="space-y-4">
                  {/* Team Name */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Team Name
                    </label>
                    <input
                      type="text"
                      value={team1.name}
                      onChange={(e) => setTeam1({ ...team1, name: e.target.value })}
                      placeholder="e.g., Weekend Warriors"
                      className="w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      maxLength={30}
                    />
                  </div>

                  {/* Add Players */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Add Players ({team1.players.length}/11) - Min 2 required
                    </label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={team1PlayerInput}
                        onChange={(e) => setTeam1PlayerInput(e.target.value)}
                        onKeyPress={(e) => {
                          if (e.key === 'Enter') {
                            e.preventDefault()
                            addPlayer('team1')
                          }
                        }}
                        placeholder="Player name"
                        className="flex-1 px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      />
                      <Button
                        type="button"
                        onClick={() => addPlayer('team1')}
                        disabled={team1.players.length >= 11}
                      >
                        <Plus className="h-5 w-5" />
                      </Button>
                    </div>
                  </div>

                  {/* Players List */}
                  <div className="space-y-2">
                    {team1.players.map((player, index) => (
                      <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div className="flex items-center gap-3">
                          <span className="font-medium">{player.name}</span>
                          <div className="flex gap-2">
                            <button
                              onClick={() => toggleRole('team1', index, 'captain')}
                              className={`px-2 py-1 text-xs rounded-full ${player.is_captain
                                  ? 'bg-yellow-100 text-yellow-700'
                                  : 'bg-gray-200 text-gray-500'
                                }`}
                            >
                              C
                            </button>
                            <button
                              onClick={() => toggleRole('team1', index, 'keeper')}
                              className={`px-2 py-1 text-xs rounded-full ${player.is_keeper
                                  ? 'bg-blue-100 text-blue-700'
                                  : 'bg-gray-200 text-gray-500'
                                }`}
                            >
                              WK
                            </button>
                          </div>
                        </div>
                        <button
                          onClick={() => removePlayer('team1', index)}
                          className="text-red-500 hover:text-red-700"
                        >
                          <X className="h-4 w-4" />
                        </button>
                      </div>
                    ))}
                    {team1.players.length === 0 && (
                      <p className="text-center text-gray-500 py-4">No players added yet</p>
                    )}
                  </div>
                </div>
              </Card>

              <div className="flex gap-4">
                <Button
                  onClick={() => setStep(1)}
                  variant="secondary"
                  className="flex-1"
                >
                  <ArrowLeft className="mr-2 h-5 w-5" />
                  Back
                </Button>
                <Button
                  onClick={handleNext}
                  className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white"
                >
                  Next: Team 2
                  <ArrowRight className="ml-2 h-5 w-5" />
                </Button>
              </div>
            </motion.div>
          )}

          {/* Step 3: Team 2 */}
          {step === 3 && (
            <motion.div
              key="step3"
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              className="space-y-6"
            >
              <Card className="p-6">
                <div className="flex items-center gap-3 mb-6">
                  <div className="p-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl">
                    <Users className="h-6 w-6" />
                  </div>
                  <div>
                    <h2 className="text-2xl font-bold text-gray-900">Team 2 Setup</h2>
                    <p className="text-gray-600">Add team name and players</p>
                  </div>
                </div>

                <div className="space-y-4">
                  {/* Team Name */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Team Name
                    </label>
                    <input
                      type="text"
                      value={team2.name}
                      onChange={(e) => setTeam2({ ...team2, name: e.target.value })}
                      placeholder="e.g., Sunday Strikers"
                      className="w-full px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      maxLength={30}
                    />
                  </div>

                  {/* Add Players */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Add Players ({team2.players.length}/11) - Min 2 required
                    </label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={team2PlayerInput}
                        onChange={(e) => setTeam2PlayerInput(e.target.value)}
                        onKeyPress={(e) => {
                          if (e.key === 'Enter') {
                            e.preventDefault()
                            addPlayer('team2')
                          }
                        }}
                        placeholder="Player name"
                        className="flex-1 px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent"
                      />
                      <Button
                        type="button"
                        onClick={() => addPlayer('team2')}
                        disabled={team2.players.length >= 11}
                      >
                        <Plus className="h-5 w-5" />
                      </Button>
                    </div>
                  </div>

                  {/* Players List */}
                  <div className="space-y-2">
                    {team2.players.map((player, index) => (
                      <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div className="flex items-center gap-3">
                          <span className="font-medium">{player.name}</span>
                          <div className="flex gap-2">
                            <button
                              onClick={() => toggleRole('team2', index, 'captain')}
                              className={`px-2 py-1 text-xs rounded-full ${player.is_captain
                                  ? 'bg-yellow-100 text-yellow-700'
                                  : 'bg-gray-200 text-gray-500'
                                }`}
                            >
                              C
                            </button>
                            <button
                              onClick={() => toggleRole('team2', index, 'keeper')}
                              className={`px-2 py-1 text-xs rounded-full ${player.is_keeper
                                  ? 'bg-blue-100 text-blue-700'
                                  : 'bg-gray-200 text-gray-500'
                                }`}
                            >
                              WK
                            </button>
                          </div>
                        </div>
                        <button
                          onClick={() => removePlayer('team2', index)}
                          className="text-red-500 hover:text-red-700"
                        >
                          <X className="h-4 w-4" />
                        </button>
                      </div>
                    ))}
                    {team2.players.length === 0 && (
                      <p className="text-center text-gray-500 py-4">No players added yet</p>
                    )}
                  </div>
                </div>
              </Card>

              <div className="flex gap-4">
                <Button
                  onClick={() => setStep(2)}
                  variant="secondary"
                  className="flex-1"
                >
                  <ArrowLeft className="mr-2 h-5 w-5" />
                  Back
                </Button>
                <Button
                  onClick={handleNext}
                  className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white"
                >
                  Next: Review
                  <ArrowRight className="ml-2 h-5 w-5" />
                </Button>
              </div>
            </motion.div>
          )}

          {/* Step 4: Review */}
          {step === 4 && (
            <motion.div
              key="step4"
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              className="space-y-6"
            >
              <Card className="p-6">
                <h2 className="text-2xl font-bold text-gray-900 mb-6">Review Match Details</h2>

                {/* Match Info */}
                <div className="space-y-4 mb-6">
                  <div className="flex justify-between py-2 border-b border-gray-100">
                    <span className="text-gray-600">Venue</span>
                    <span className="font-medium">{matchData.venue}</span>
                  </div>
                  <div className="flex justify-between py-2 border-b border-gray-100">
                    <span className="text-gray-600">Overs</span>
                    <span className="font-medium">{matchData.overs}</span>
                  </div>
                  <div className="flex justify-between py-2 border-b border-gray-100">
                    <span className="text-gray-600">Start Time</span>
                    <span className="font-medium">
                      {new Date(matchData.startTime).toLocaleString()}
                    </span>
                  </div>
                </div>

                {/* Teams */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="bg-green-50 rounded-xl p-4">
                    <h3 className="font-bold text-green-900 mb-2">{team1.name}</h3>
                    <p className="text-sm text-green-700 mb-2">{team1.players.length} players</p>
                    <div className="text-xs text-green-600">
                      Captain: {team1.players.find(p => p.is_captain)?.name || 'Not set'}
                    </div>
                  </div>

                  <div className="bg-purple-50 rounded-xl p-4">
                    <h3 className="font-bold text-purple-900 mb-2">{team2.name}</h3>
                    <p className="text-sm text-purple-700 mb-2">{team2.players.length} players</p>
                    <div className="text-xs text-purple-600">
                      Captain: {team2.players.find(p => p.is_captain)?.name || 'Not set'}
                    </div>
                  </div>
                </div>
              </Card>

              <div className="flex gap-4">
                <Button
                  onClick={() => setStep(3)}
                  variant="secondary"
                  className="flex-1"
                  disabled={loading}
                >
                  <ArrowLeft className="mr-2 h-5 w-5" />
                  Back
                </Button>
                <Button
                  onClick={handleCreateMatch}
                  disabled={loading}
                  className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white"
                >
                  {loading ? (
                    <>
                      <span className="h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2" />
                      Creating Match...
                    </>
                  ) : (
                    <>
                      Create Match
                      <Trophy className="ml-2 h-5 w-5" />
                    </>
                  )}
                </Button>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    </div>
  </>
)
}

===== FILE: app/matches/[id]/score/components/BatsmanSelection.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Player } from '@/types/match'

interface BatsmanSelectionProps {
  availableBatsmen: Player[]
  currentStriker: 'batsman1' | 'batsman2'
  whichBatsman: 'batsman1' | 'batsman2' // Which batsman slot is empty
  onSelect: (name: string) => void
  reason: 'wicket' | 'start'
}

export const BatsmanSelection = ({
  availableBatsmen,
  currentStriker,
  whichBatsman,
  onSelect,
  reason,
}: BatsmanSelectionProps) => {
  return (
    <Card className="p-6 mb-6 border-2 border-orange-500">
      <h3 className="text-lg font-bold mb-2">
        {reason === 'wicket' ? '‚ö†Ô∏è Select New Batsman' : 'Select Batsman'}
      </h3>
      <p className="text-sm text-gray-600 mb-4">
        {reason === 'wicket'
          ? 'A wicket has fallen. Select the next batsman.'
          : `Select ${whichBatsman === 'batsman1' ? 'striker' : 'non-striker'}`}
      </p>

      <div className="space-y-2">
        {availableBatsmen.map((player, i) => (
          <button
            key={i}
            onClick={() => onSelect(player.name)}
            className="w-full p-3 border rounded-lg hover:bg-green-50 hover:border-green-500 transition text-left"
          >
            <span className="font-medium">{player.name}</span>
            {player.is_captain && (
              <span className="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">
                C
              </span>
            )}
            {player.is_keeper && (
              <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                WK
              </span>
            )}
          </button>
        ))}
      </div>
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/BatsmanSelectionForm.tsx =====
'use client'

import { useState } from 'react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { AlertCircle } from 'lucide-react'
import { logger } from '@/utils/debugLogger'
import { Player } from '@/types/match'

interface BatsmanChangeFormProps {
  availableBatsmen: Player[]
  outBatsman: string
  onBatsmanSelected: (newBatsman: string) => Promise<void>
}

export function BatsmanChangeForm({
  availableBatsmen,
  outBatsman,
  onBatsmanSelected,
}: BatsmanChangeFormProps) {
  const [selectedBatsman, setSelectedBatsman] = useState('')
  const [loading, setLoading] = useState(false)

  const handleSubmit = async (batsmanName: string) => {
    logger.info('BATSMAN_CHANGE', 'Selecting new batsman', { batsmanName })

    setLoading(true)
    try {
      await onBatsmanSelected(batsmanName)
      logger.success('BATSMAN_CHANGE', 'New batsman selected')
    } catch (error: any) {
      logger.error('BATSMAN_CHANGE', 'Failed to select batsman', error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <Card className="p-6 mb-6 border-2 border-red-500">
      <div className="flex items-center gap-2 mb-2">
        <AlertCircle className="h-6 w-6 text-red-600" />
        <h3 className="text-lg font-bold text-red-600">Wicket!</h3>
      </div>

      <p className="text-sm text-gray-600 mb-4">
        <strong>{outBatsman}</strong> is out. Select the next batsman.
      </p>

      {availableBatsmen.length === 0 ? (
        <div className="bg-red-50 border border-red-200 rounded p-4 text-center">
          <p className="text-red-800 font-medium">All Out!</p>
          <p className="text-sm text-red-600 mt-1">No more batsmen available</p>
        </div>
      ) : (
        <div className="space-y-2">
          {availableBatsmen.map((player, i) => (
            <button
              key={i}
              onClick={() => handleSubmit(player.name)}
              disabled={loading}
              className="w-full p-3 border rounded-lg hover:bg-red-50 hover:border-red-500 transition text-left disabled:opacity-50"
            >
              <span className="font-medium">{player.name}</span>
              {player.is_captain && (
                <span className="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">
                  C
                </span>
              )}
              {player.is_keeper && (
                <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                  WK
                </span>
              )}
            </button>
          ))}
        </div>
      )}
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/BowlerSelection.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { Player } from '@/types/match'

interface BowlerSelectionProps {
  bowlers: Player[]
  previousBowler: string // ‚úÖ NEW: Last over's bowler
  onSelect: (name: string) => void
  reason: 'over' | 'start'
}

export const BowlerSelection = ({
  bowlers,
  previousBowler,
  onSelect,
  reason,
}: BowlerSelectionProps) => {
  // ‚úÖ Filter out previous bowler if this is after an over
  const availableBowlers = reason === 'over' 
    ? bowlers.filter(p => p.name !== previousBowler)
    : bowlers

  return (
    <Card className="p-6 mb-6 border-2 border-blue-500">
      <h3 className="text-lg font-bold mb-2">
        {reason === 'over' ? 'üéØ Select New Bowler' : 'Select Bowler'}
      </h3>
      <p className="text-sm text-gray-600 mb-4">
        {reason === 'over'
          ? 'Over completed! Select the bowler for the next over.'
          : 'Select the opening bowler'}
      </p>

      {/* ‚úÖ Show warning if previous bowler exists */}
      {reason === 'over' && previousBowler && (
        <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4">
          <p className="text-xs text-yellow-800">
            <strong>‚ö†Ô∏è Note:</strong> {previousBowler} cannot bowl consecutive overs
          </p>
        </div>
      )}

      {availableBowlers.length === 0 && (
        <div className="bg-red-50 border border-red-200 rounded p-4 text-center">
          <p className="text-red-800 font-medium">
            No other bowlers available!
          </p>
          <p className="text-xs text-red-600 mt-1">
            You need at least 2 players in the bowling team.
          </p>
        </div>
      )}

      <div className="space-y-2">
        {availableBowlers.map((player, i) => (
          <button
            key={i}
            onClick={() => onSelect(player.name)}
            className="w-full p-3 border rounded-lg hover:bg-blue-50 hover:border-blue-500 transition text-left"
          >
            <span className="font-medium">{player.name}</span>
            {player.is_captain && (
              <span className="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">
                C
              </span>
            )}
            {player.is_keeper && (
              <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                WK
              </span>
            )}
          </button>
        ))}
      </div>
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/CurrentOver.tsx =====
'use client'

import { Card } from '@/components/ui/card'

interface CurrentOverProps {
  balls: string[]
}

const getBallClass = (ball: string) => {
  if (ball === 'W') return 'bg-red-500'
  if (ball === '4') return 'bg-blue-500'
  if (ball === '6') return 'bg-purple-500'
  if (ball === 'WD' || ball === 'NB') return 'bg-yellow-500'
  return 'bg-gray-400'
}

export const CurrentOver = ({ balls }: CurrentOverProps) => {
  if (balls.length === 0) return null

  return (
    <Card className="p-4 mb-6">
      <p className="text-sm font-medium mb-2">This Over:</p>
      <div className="flex gap-2 flex-wrap">
        {balls.map((ball, i) => (
          <span
            key={i}
            className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white ${getBallClass(
              ball
            )}`}
          >
            {ball}
          </span>
        ))}
      </div>
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/CurrentPlayers.tsx =====
'use client'

import { Card } from '@/components/ui/card'

interface CurrentPlayersProps {
  batsman1: string
  batsman2: string
  bowler: string
  striker: 'batsman1' | 'batsman2'
}

export const CurrentPlayers = ({
  batsman1,
  batsman2,
  bowler,
  striker,
}: CurrentPlayersProps) => {
  return (
    <Card className="p-4 mb-4 bg-gray-50">
      <div className="grid grid-cols-3 gap-4">
        <div className="text-center">
          <p className="text-xs text-gray-600 mb-1">STRIKER</p>
          <p className="font-bold text-green-700">
            {striker === 'batsman1' ? batsman1 : batsman2} *
          </p>
        </div>
        <div className="text-center">
          <p className="text-xs text-gray-600 mb-1">NON-STRIKER</p>
          <p className="font-bold">
            {striker === 'batsman2' ? batsman1 : batsman2}
          </p>
        </div>
        <div className="text-center">
          <p className="text-xs text-gray-600 mb-1">BOWLER</p>
          <p className="font-bold text-blue-700">{bowler}</p>
        </div>
      </div>
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/ExtrasModal.tsx =====
'use client'

import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'

interface ExtrasModalProps {
  extraType: 'WD' | 'NB' | 'B' | 'LB'
  onConfirm: (extraRuns: number) => void // ‚úÖ Changed: return only extra runs, not total
  onCancel: () => void
}

export const ExtrasModal = ({ extraType, onConfirm, onCancel }: ExtrasModalProps) => {
  const extraNames = {
    WD: 'Wide Ball',
    NB: 'No Ball',
    B: 'Bye',
    LB: 'Leg Bye',
  }

  const extraDescriptions = {
    WD: '1 run penalty + runs taken by batsmen',
    NB: '1 run penalty + runs taken/hit by batsmen',
    B: 'Runs taken by batsmen (no penalty)',
    LB: 'Runs taken by batsmen (no penalty)',
  }

  const hasPenalty = extraType === 'WD' || extraType === 'NB'

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <Card className="p-6 max-w-md w-full">
        <h3 className="text-xl font-bold mb-2">{extraNames[extraType]}</h3>
        <p className="text-sm text-gray-600 mb-4">
          {extraDescriptions[extraType]}
        </p>

        <div className="mb-4">
          <p className="text-xs text-gray-500 mb-2">
            How many runs did the batsmen take?
          </p>
          <div className="grid grid-cols-4 gap-2">
            {[0, 1, 2, 3, 4, 5, 6, 7].map((runs) => (
              <Button
                key={runs}
                onClick={() => onConfirm(runs)} // ‚úÖ Pass only extra runs
                className="h-14 text-lg font-bold"
                variant="secondary"
              >
                {runs}
              </Button>
            ))}
          </div>
        </div>

        {hasPenalty && (
          <div className="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4">
            <p className="text-xs text-yellow-800">
              <strong>Note:</strong> 1 run penalty will be added automatically
            </p>
          </div>
        )}

        <Button variant="outline" className="w-full" onClick={onCancel}>
          Cancel
        </Button>
      </Card>
    </div>
  )
}

===== FILE: app/matches/[id]/score/components/PlayerSelection.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Team, Player } from '@/types/match'

interface PlayerSelectionProps {
  battingTeam: Team | null
  bowlingTeam: Team | null
  selectedBatsman1: string
  selectedBatsman2: string
  selectedBowler: string
  currentStriker: 'batsman1' | 'batsman2'
  outBatsmen: string[]
  onBatsman1Change: (name: string) => void
  onBatsman2Change: (name: string) => void
  onBowlerChange: (name: string) => void
  onStart: () => void
}

export const PlayerSelection = ({
  battingTeam,
  bowlingTeam,
  selectedBatsman1,
  selectedBatsman2,
  selectedBowler,
  currentStriker,
  outBatsmen,
  onBatsman1Change,
  onBatsman2Change,
  onBowlerChange,
  onStart,
}: PlayerSelectionProps) => {
  if (!battingTeam || !bowlingTeam) return null

  const availableBatsmen = battingTeam.players.filter(
    (p: Player) => !outBatsmen.includes(p.name)
  )

  return (
    <Card className="p-6 mb-6">
      <h3 className="text-lg font-bold mb-4">Select Players</h3>

      <div className="grid md:grid-cols-3 gap-4">
        <div>
          <label className="block text-sm font-medium mb-2">
            Striker Batsman {currentStriker === 'batsman1' && '*'}
          </label>
          <select
            value={selectedBatsman1}
            onChange={(e) => onBatsman1Change(e.target.value)}
            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
          >
            <option value="">Select Batsman</option>
            {availableBatsmen.map((player: Player, i: number) => (
              <option key={i} value={player.name}>
                {player.name}{' '}
                {player.is_captain && '(C)'}{' '}
                {player.is_keeper && '(WK)'}
              </option>
            ))}
          </select>
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">
            Non-Striker {currentStriker === 'batsman2' && '*'}
          </label>
          <select
            value={selectedBatsman2}
            onChange={(e) => onBatsman2Change(e.target.value)}
            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
          >
            <option value="">Select Batsman</option>
            {availableBatsmen
              .filter((p: Player) => p.name !== selectedBatsman1)
              .map((player: Player, i: number) => (
                <option key={i} value={player.name}>
                  {player.name}{' '}
                  {player.is_captain && '(C)'}{' '}
                  {player.is_keeper && '(WK)'}
                </option>
              ))}
          </select>
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Bowler</label>
          <select
            value={selectedBowler}
            onChange={(e) => onBowlerChange(e.target.value)}
            className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            <option value="">Select Bowler</option>
            {bowlingTeam.players.map((player: Player, i: number) => (
              <option key={i} value={player.name}>
                {player.name}{' '}
                {player.is_captain && '(C)'}{' '}
                {player.is_keeper && '(WK)'}
              </option>
            ))}
          </select>
        </div>
      </div>

      <Button
        onClick={onStart}
        disabled={!selectedBatsman1 || !selectedBatsman2 || !selectedBowler}
        className="w-full mt-4 bg-green-500 hover:bg-green-600 disabled:opacity-50"
      >
        Continue Scoring
      </Button>
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/PlayerSelectionForm.tsx =====
'use client'

import { useState } from 'react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Users } from 'lucide-react'
import { logger } from '@/utils/debugLogger'
import { Player } from '@/types/match'

interface PlayerSelectionFormProps {
  battingTeamName: string
  bowlingTeamName: string
  battingPlayers: Player[]
  bowlingPlayers: Player[]
  onPlayersSelected: (
    batsman1: string,
    batsman2: string,
    bowler: string
  ) => Promise<void>
}

export function PlayerSelectionForm({
  battingTeamName,
  bowlingTeamName,
  battingPlayers,
  bowlingPlayers,
  onPlayersSelected,
}: PlayerSelectionFormProps) {
  const [batsman1, setBatsman1] = useState('')
  const [batsman2, setBatsman2] = useState('')
  const [bowler, setBowler] = useState('')
  const [loading, setLoading] = useState(false)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!batsman1 || !batsman2 || !bowler) {
      logger.warning('PLAYER_FORM', 'Incomplete player selection')
      return
    }

    if (batsman1 === batsman2) {
      logger.warning('PLAYER_FORM', 'Same batsman selected twice')
      return
    }

    logger.info('PLAYER_FORM', 'Submitting players', {
      batsman1,
      batsman2,
      bowler,
    })

    setLoading(true)
    try {
      await onPlayersSelected(batsman1, batsman2, bowler)
      logger.success('PLAYER_FORM', 'Players saved successfully')
    } catch (error: any) {
      logger.error('PLAYER_FORM', 'Failed to save players', error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <Card className="p-6">
      <div className="flex items-center gap-2 mb-4">
        <Users className="h-6 w-6 text-blue-600" />
        <h2 className="text-xl font-bold">Select Opening Players</h2>
      </div>

      <div className="bg-blue-50 border border-blue-200 rounded p-3 mb-4">
        <p className="text-sm text-blue-800">
          <strong>Batting:</strong> {battingTeamName} ‚Ä¢{' '}
          <strong>Bowling:</strong> {bowlingTeamName}
        </p>
      </div>

      <form onSubmit={handleSubmit}>
        <div className="grid md:grid-cols-3 gap-4 mb-4">
          {/* Batsman 1 (Striker) */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Opening Batsman 1 (Striker) *
            </label>
            <select
              id="striker-select"
              name="striker-select"
              value={batsman1}
              onChange={(e) => {
                const value = e.target.value
                setBatsman1(value)
                e.target.dispatchEvent(new Event('input', { bubbles: true }))
              }}
              className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500"
              disabled={loading}
              required
              data-testid="striker-select"
              aria-label="Opening Batsman 1 (Striker)"
            >
              <option value="__none__">Select Batsman</option>
              {battingPlayers.map((player, i) => (
                <option key={i} value={player.name}>
                  {player.name}
                  {player.is_captain && ' (C)'}
                  {player.is_keeper && ' (WK)'}
                </option>
              ))}
            </select>

          </div>

          {/* Batsman 2 (Non-Striker) */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Opening Batsman 2 (Non-Striker)
            </label>
            <select
              value={batsman2}
              onChange={(e) => setBatsman2(e.target.value)}
              className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500"
              disabled={loading}
              required
              data-testid="non-striker-select"
              aria-label="Select opening batsman 2 (non-striker)"
            >
              <option value="">Select Batsman</option>
              {battingPlayers
                .filter((p) => p.name !== batsman1)
                .map((player, i) => (
                  <option key={i} value={player.name}>
                    {player.name}
                    {player.is_captain && ' (C)'}
                    {player.is_keeper && ' (WK)'}
                  </option>
                ))}
            </select>
          </div>

          {/* Bowler */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Opening Bowler
            </label>
            <select
              value={bowler}
              onChange={(e) => setBowler(e.target.value)}
              className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
              disabled={loading}
              required
              data-testid="bowler-select"
              aria-label="Select opening bowler"
            >
              <option value="">Select Bowler</option>
              {bowlingPlayers.map((player, i) => (
                <option key={i} value={player.name}>
                  {player.name}
                  {player.is_captain && ' (C)'}
                  {player.is_keeper && ' (WK)'}
                </option>
              ))}
            </select>
          </div>
        </div>

        {batsman1 === batsman2 && batsman1 && (
          <div className="bg-red-50 border border-red-200 rounded p-3 mb-4">
            <p className="text-sm text-red-800">
              ‚ö†Ô∏è Please select different batsmen
            </p>
          </div>
        )}

        <Button
          type="submit"
          disabled={
            !batsman1 || !batsman2 || !bowler || batsman1 === batsman2 || loading
          }
          className="w-full bg-green-500 hover:bg-green-600 disabled:opacity-50"
          data-testid="start-scoring-button"
        >
          {loading ? 'Saving...' : 'Start Scoring'}
        </Button>
      </form>
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/ScoreDisplay.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { Trophy, Users } from 'lucide-react'
import { Team, Match } from '@/types/match'

interface ScoreDisplayProps {
  battingTeam: Team | null
  bowlingTeam: Team | null
  currentInnings: number
  match: Match
}

export const ScoreDisplay = ({
  battingTeam,
  bowlingTeam,
  currentInnings,
  match,
}: ScoreDisplayProps) => {
  if (!battingTeam || !bowlingTeam) return null

  return (
    <div className="grid md:grid-cols-2 gap-4 mb-6">
      {/* Batting Team Card */}
      <Card className="p-6 bg-gradient-to-br from-green-500 to-green-600 text-white">
        <div className="flex items-center gap-2 mb-3">
          <Trophy className="h-5 w-5" />
          <h3 className="text-sm font-medium opacity-90">BATTING</h3>
        </div>
        <h2 className="text-2xl font-bold mb-2">{battingTeam.name}</h2>
        <div className="text-4xl font-bold mb-2">
          {battingTeam.total_score}/{battingTeam.total_wickets}
        </div>
        <p className="text-sm opacity-90">
          Overs: {Math.floor(battingTeam.total_balls / 6)}.
          {battingTeam.total_balls % 6}
          {battingTeam.extras > 0 && ` ‚Ä¢ Extras: ${battingTeam.extras}`}
        </p>
        {currentInnings === 2 && match.target && (
          <div className="mt-3 pt-3 border-t border-white/30">
            <p className="text-sm">Target: {match.target}</p>
            <p className="text-lg font-bold">
              Need {Math.max(0, match.target - battingTeam.total_score)} runs
            </p>
          </div>
        )}
      </Card>

      {/* Bowling Team Card */}
      <Card className="p-6 bg-gradient-to-br from-blue-500 to-blue-600 text-white">
        <div className="flex items-center gap-2 mb-3">
          <Users className="h-5 w-5" />
          <h3 className="text-sm font-medium opacity-90">BOWLING</h3>
        </div>
        <h2 className="text-2xl font-bold mb-4">{bowlingTeam.name}</h2>
        {currentInnings === 1 && (
          <p className="text-sm opacity-90">First Innings</p>
        )}
        {currentInnings === 2 && match.target && (
          <div>
            <p className="text-sm opacity-90">Second Innings</p>
            <p className="text-lg font-bold mt-2">
              Defending {match.target} runs
            </p>
          </div>
        )}
      </Card>
    </div>
  )
}

===== FILE: app/matches/[id]/score/components/ScoringControls.tsx =====
'use client'

import { useState } from 'react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { RotateCcw } from 'lucide-react'
import { ExtrasModal } from './ExtrasModal'

interface ScoringControlsProps {
  onBallRecorded: (outcome: string, extraRuns?: number) => void
  onUndo: () => void
  canUndo: boolean
}

export const ScoringControls = ({
  onBallRecorded,
  onUndo,
  canUndo,
}: ScoringControlsProps) => {
  const [showExtrasModal, setShowExtrasModal] = useState(false)
  const [pendingExtra, setPendingExtra] = useState<'WD' | 'NB' | 'B' | 'LB' | null>(null)

  const handleExtraClick = (extraType: 'WD' | 'NB' | 'B' | 'LB') => {
    setPendingExtra(extraType)
    setShowExtrasModal(true)
  }

  const handleExtraConfirm = (extraRunsTaken: number) => {
    if (!pendingExtra) return
    
    console.log(`${pendingExtra}: Batsmen took ${extraRunsTaken} runs`) // ‚úÖ Debug
    
    // ‚úÖ Pass extra runs directly (penalty is added in calculateBallOutcome)
    onBallRecorded(pendingExtra, extraRunsTaken)
    
    setShowExtrasModal(false)
    setPendingExtra(null)
  }

  return (
    <>
      <Card className="p-6">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-bold">Record Ball</h3>
          <Button
            onClick={onUndo}
            disabled={!canUndo}
            variant="outline"
            size="sm"
            className="flex items-center gap-2"
          >
            <RotateCcw className="h-4 w-4" />
            Undo
          </Button>
        </div>

        {/* Runs */}
        <div className="grid grid-cols-4 gap-2 mb-4">
          {['0', '1', '2', '3', '4', '5', '6'].map((run) => (
            <Button
              key={run}
              onClick={() => onBallRecorded(run, 0)} // ‚úÖ Pass 0 for regular runs
              variant="secondary"
              className={`h-14 text-lg font-bold
                ${
                  run === '4'
                    ? '!bg-blue-500 hover:!bg-blue-600 !text-white'
                    : run === '6'
                    ? '!bg-purple-500 hover:!bg-purple-600 !text-white'
                    : ''
                }`}
            >
              {run}
            </Button>
          ))}
          <Button
            onClick={() => onBallRecorded('W', 0)} // ‚úÖ Pass 0 for wicket
            className="h-14 text-lg font-bold !bg-red-500 hover:!bg-red-600"
          >
            W
          </Button>
        </div>

        {/* Extras */}
        <div className="mb-4">
          <p className="text-sm font-medium mb-2">Extras</p>
          <div className="grid grid-cols-4 gap-2">
            <Button
              onClick={() => handleExtraClick('WD')}
              variant="outline"
              className="h-12"
            >
              Wide
            </Button>
            <Button
              onClick={() => handleExtraClick('NB')}
              variant="outline"
              className="h-12"
            >
              No Ball
            </Button>
            <Button
              onClick={() => handleExtraClick('B')}
              variant="outline"
              className="h-12"
            >
              Bye
            </Button>
            <Button
              onClick={() => handleExtraClick('LB')}
              variant="outline"
              className="h-12"
            >
              Leg Bye
            </Button>
          </div>
        </div>

        <div className="text-xs text-gray-500 text-center">
          Click on extras to specify additional runs taken
        </div>
      </Card>

      {showExtrasModal && pendingExtra && (
        <ExtrasModal
          extraType={pendingExtra}
          onConfirm={handleExtraConfirm}
          onCancel={() => {
            setShowExtrasModal(false)
            setPendingExtra(null)
          }}
        />
      )}
    </>
  )
}

===== FILE: app/matches/[id]/score/components/ScoringInterface.tsx =====
'use client'

import { useState } from 'react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { logger } from '@/utils/debugLogger'

interface ScoringInterfaceProps {
  striker: string
  nonStriker: string
  bowler: string
  currentOver: string[]
  currentStriker: 'batsman1' | 'batsman2' // ‚úÖ Added
  onBallRecorded: (outcome: string) => Promise<void>
}

export function ScoringInterface({
  striker,
  nonStriker,
  bowler,
  currentOver,
  currentStriker, // ‚úÖ Added
  onBallRecorded,
}: ScoringInterfaceProps) {
  const [recording, setRecording] = useState(false)

  const handleBall = async (outcome: string) => {
    logger.info('SCORING', `Recording ball: ${outcome}`)

    setRecording(true)
    try {
      await onBallRecorded(outcome)
      logger.success('SCORING', `Ball recorded: ${outcome}`)
    } catch (error: any) {
      logger.error('SCORING', `Failed to record ball: ${outcome}`, error)
    } finally {
      setRecording(false)
    }
  }

  const getBallColor = (ball: string) => {
    if (ball === 'W') return 'bg-red-500'
    if (ball === '4') return 'bg-blue-500'
    if (ball === '6') return 'bg-purple-500'
    if (ball === 'WD' || ball === 'NB') return 'bg-yellow-500'
    return 'bg-gray-400'
  }

  // ‚úÖ Determine who's on strike
  const onStrike = currentStriker === 'batsman1' ? striker : nonStriker
  const offStrike = currentStriker === 'batsman1' ? nonStriker : striker

  return (
    <div className="space-y-4">
      {/* Current Players */}
      <Card className="p-4 bg-gray-50">
        <div className="grid grid-cols-3 gap-4 text-center">
          <div>
            <p className="text-xs text-gray-600 mb-1">ON STRIKE</p>
            <p className="font-bold text-green-700 text-lg">{onStrike} *</p>
          </div>
          <div>
            <p className="text-xs text-gray-600 mb-1">NON-STRIKER</p>
            <p className="font-bold text-gray-700">{offStrike}</p>
          </div>
          <div>
            <p className="text-xs text-gray-600 mb-1">BOWLER</p>
            <p className="font-bold text-blue-700">{bowler}</p>
          </div>
        </div>
      </Card>

      {/* Current Over */}
      {currentOver.length > 0 && (
        <Card className="p-4">
          <p className="text-sm font-medium mb-2">This Over:</p>
          <div className="flex gap-2 flex-wrap">
            {currentOver.map((ball, i) => (
              <span
                key={i}
                className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white ${getBallColor(
                  ball
                )}`}
              >
                {ball}
              </span>
            ))}
          </div>
        </Card>
      )}

      {/* Scoring Controls */}
      <Card className="p-6">
        <h3 className="text-lg font-bold mb-4">Record Ball</h3>

        {/* Runs */}
        <div className="grid grid-cols-4 gap-2 mb-4">
          {['0', '1', '2', '3', '4', '5', '6'].map((run) => (
            <Button
              key={run}
              onClick={() => handleBall(run)}
              disabled={recording}
              variant="secondary"
              className={`h-14 text-lg font-bold ${
                run === '4'
                  ? '!bg-blue-500 hover:!bg-blue-600 !text-white'
                  : run === '6'
                  ? '!bg-purple-500 hover:!bg-purple-600 !text-white'
                  : ''
              }`}
            >
              {run}
            </Button>
          ))}
          <Button
            onClick={() => handleBall('W')}
            disabled={recording}
            className="h-14 text-lg font-bold !bg-red-500 hover:!bg-red-600"
          >
            W
          </Button>
        </div>

        {/* Extras */}
        <div className="mb-4">
          <p className="text-sm font-medium mb-2">Extras (Simplified)</p>
          <div className="grid grid-cols-4 gap-2">
            <Button
              onClick={() => handleBall('WD')}
              disabled={recording}
              variant="outline"
              className="h-12"
            >
              Wide (+1)
            </Button>
            <Button
              onClick={() => handleBall('NB')}
              disabled={recording}
              variant="outline"
              className="h-12"
            >
              No Ball (+1)
            </Button>
            <Button
              onClick={() => handleBall('B')}
              disabled={recording}
              variant="outline"
              className="h-12"
            >
              Bye (+1)
            </Button>
            <Button
              onClick={() => handleBall('LB')}
              disabled={recording}
              variant="outline"
              className="h-12"
            >
              Leg Bye (+1)
            </Button>
          </div>
          <p className="text-xs text-gray-500 mt-2 text-center">
            All extras add 1 run only (simplified)
          </p>
        </div>
      </Card>
    </div>
  )
}

===== FILE: app/matches/[id]/score/components/TossForm.tsx =====
'use client'

import { useState } from 'react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Coins } from 'lucide-react'
import { logger } from '@/utils/debugLogger'

interface TossFormProps {
  teamOneName: string
  teamTwoName: string
  onTossComplete: (winner: string, decision: 'bat' | 'bowl') => Promise<void>
}

export function TossForm({
  teamOneName,
  teamTwoName,
  onTossComplete,
}: TossFormProps) {
  const [tossWinner, setTossWinner] = useState('')
  const [tossDecision, setTossDecision] = useState<'bat' | 'bowl' | ''>('')
  const [loading, setLoading] = useState(false)

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!tossWinner || !tossDecision) {
      logger.warning('TOSS_FORM', 'Incomplete toss selection')
      return
    }

    logger.info('TOSS_FORM', 'Submitting toss', { tossWinner, tossDecision })

    setLoading(true)
    try {
      await onTossComplete(tossWinner, tossDecision)
      logger.success('TOSS_FORM', 'Toss completed successfully')
    } catch (error: any) {
      logger.error('TOSS_FORM', 'Failed to complete toss', error)
    } finally {
      setLoading(false)
    }
  }

  return (
    <Card className="p-6">
      <div className="flex items-center gap-2 mb-4">
        <Coins className="h-6 w-6 text-yellow-600" />
        <h2 className="text-xl font-bold">Toss</h2>
      </div>

      <form onSubmit={handleSubmit}>
        <div className="grid md:grid-cols-2 gap-4 mb-4">
          {/* Toss Winner */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Who won the toss?
            </label>
            <div className="space-y-2">
              <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                <input
                  type="radio"
                  name="toss_winner"
                  value={teamOneName}
                  checked={tossWinner === teamOneName}
                  onChange={(e) => setTossWinner(e.target.value)}
                  className="text-green-600"
                  disabled={loading}
                  data-testid={`toss-winner-${teamOneName.toLowerCase().replace(/\s+/g, '-')}`}
                />
                <span className="font-medium">{teamOneName}</span>
              </label>
              <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                <input
                  type="radio"
                  name="toss_winner"
                  value={teamTwoName}
                  checked={tossWinner === teamTwoName}
                  onChange={(e) => setTossWinner(e.target.value)}
                  className="text-green-600"
                  disabled={loading}
                  data-testid={`toss-winner-${teamTwoName.toLowerCase().replace(/\s+/g, '-')}`}
                />
                <span className="font-medium">{teamTwoName}</span>
              </label>
            </div>
          </div>

          {/* Toss Decision */}
          <div>
            <label className="block text-sm font-medium mb-2">
              What did they choose?
            </label>
            <div className="space-y-2">
              <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                <input
                  type="radio"
                  name="toss_decision"
                  value="bat"
                  checked={tossDecision === 'bat'}
                  onChange={() => setTossDecision('bat')}
                  className="text-green-600"
                  disabled={loading}
                  data-testid="toss-decision-bat"
                />
                <span className="font-medium">Bat First</span>
              </label>
              <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                <input
                  type="radio"
                  name="toss_decision"
                  value="bowl"
                  checked={tossDecision === 'bowl'}
                  onChange={() => setTossDecision('bowl')}
                  className="text-green-600"
                  disabled={loading}
                  data-testid="toss-decision-bowl"
                />
                <span className="font-medium">Bowl First</span>
              </label>
            </div>
          </div>
        </div>

        <Button
          type="submit"
          disabled={!tossWinner || !tossDecision || loading}
          className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 disabled:opacity-50"
          data-testid="complete-toss-button"
        >
          {loading ? 'Saving...' : 'Complete Toss & Continue'}
        </Button>
      </form>
    </Card>
  )
}

===== FILE: app/matches/[id]/score/components/TossSection.tsx =====
'use client'

import { useState } from 'react'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Coins } from 'lucide-react'
import { Match } from '@/types/match'

interface TossSectionProps {
  match: Match
  onTossComplete: (tossWinner: string, tossDecision: 'bat' | 'bowl') => void
}

export const TossSection = ({ match, onTossComplete }: TossSectionProps) => {
  const [tossWinner, setTossWinner] = useState('')
  const [tossDecision, setTossDecision] = useState<'bat' | 'bowl' | ''>('')

  const handleToss = () => {
    if (!tossWinner || !tossDecision) {
      return
    }
    onTossComplete(tossWinner, tossDecision as 'bat' | 'bowl')
  }

  return (
    <Card className="p-6 mb-6">
      <div className="flex items-center gap-2 mb-4">
        <Coins className="h-6 w-6 text-yellow-600" />
        <h2 className="text-xl font-bold">Toss</h2>
      </div>

      <div className="grid md:grid-cols-2 gap-4 mb-4">
        <div>
          <label className="block text-sm font-medium mb-2">
            Who won the toss?
          </label>
          <div className="space-y-2">
            <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
              <input
                type="radio"
                name="toss"
                value={match.teamOne.name}
                onChange={(e) => setTossWinner(e.target.value)}
                className="text-green-600"
              />
              <span className="font-medium">{match.teamOne.name}</span>
            </label>
            <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
              <input
                type="radio"
                name="toss"
                value={match.teamTwo.name}
                onChange={(e) => setTossWinner(e.target.value)}
                className="text-green-600"
              />
              <span className="font-medium">{match.teamTwo.name}</span>
            </label>
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Decision?</label>
          <div className="space-y-2">
            <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
              <input
                type="radio"
                name="decision"
                value="bat"
                onChange={(e) =>
                  setTossDecision(e.target.value as 'bat' | 'bowl')
                }
                className="text-green-600"
              />
              <span className="font-medium">Bat First</span>
            </label>
            <label className="flex items-center gap-2 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
              <input
                type="radio"
                name="decision"
                value="bowl"
                onChange={(e) =>
                  setTossDecision(e.target.value as 'bat' | 'bowl')
                }
                className="text-green-600"
              />
              <span className="font-medium">Bowl First</span>
            </label>
          </div>
        </div>
      </div>

      <Button
        onClick={handleToss}
        disabled={!tossWinner || !tossDecision}
        className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 disabled:opacity-50"
      >
        Start Match
      </Button>
    </Card>
  )
}

===== FILE: components/animations/ScrollAnimation.tsx =====
'use client'

import { motion, useInView } from 'framer-motion'
import { useRef, ReactNode } from 'react'

interface ScrollAnimationProps {
  children: ReactNode
  className?: string
  delay?: number
  duration?: number
}

export default function ScrollAnimation({ 
  children, 
  className = '', 
  delay = 0,
  duration = 0.5 
}: ScrollAnimationProps) {
  const ref = useRef(null)
  const isInView = useInView(ref, { once: true, margin: '-100px' })

  return (
    <motion.div
      ref={ref}
      initial={{ opacity: 0, y: 50 }}
      animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 50 }}
      transition={{
        duration,
        delay,
        ease: [0.21, 0.47, 0.32, 0.98],
      }}
      className={className}
    >
      {children}
    </motion.div>
  )
}

===== FILE: components/dashboard/Footer.tsx =====
export default function Footer() {
  return (
    <footer className="bg-white/80 backdrop-blur-sm border-t border-gray-100 mt-16">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl py-8">
        <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
          <div className="flex items-center gap-2">
            <span className="text-xl">üèè</span>
            <p className="text-sm text-gray-600">
              Built for local cricket communities
            </p>
          </div>

          <nav className="flex items-center gap-6 text-sm">
            <a href="/about" className="text-gray-600 hover:text-green-600 transition-colors">
              About
            </a>
            <a href="/privacy" className="text-gray-600 hover:text-green-600 transition-colors">
              Privacy
            </a>
            <a href="/contact" className="text-gray-600 hover:text-green-600 transition-colors">
              Contact
            </a>
            <a href="/docs" className="text-gray-600 hover:text-green-600 transition-colors">
              Docs
            </a>
          </nav>
        </div>

        <div className="mt-6 pt-6 border-t border-gray-100 text-center">
          <p className="text-xs text-gray-500">
            ¬© 2025 Local League Cricket. Made with ‚ù§Ô∏è for cricket lovers.
          </p>
        </div>
      </div>
    </footer>
  )
}

===== FILE: components/dashboard/InvitedMatches.tsx =====
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { motion } from 'framer-motion'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Calendar, MapPin, Eye, Play, CheckCircle, Clock, Users, RefreshCw } from 'lucide-react'

interface MatchData {
  _id: string;
  matchCode: string;
  status: string;
  venue: string;
  startTime: string;
  overs: number;
  teamOne: {
    name: string;
    total_score?: number;
    total_wickets?: number;
    overs: string;
  };
  teamTwo: {
    name: string;
    total_score?: number;
    total_wickets?: number;
    overs: string;
  };
  isPrivate: boolean;
  createdAt: string;
  target?: number;
}

interface InvitedMatchesProps {
  matches: MatchData[];
  loading: boolean;
  onRefresh: () => void;
}

export default function InvitedMatches({ matches = [], loading, onRefresh }: InvitedMatchesProps) {
  const router = useRouter()
  const [filter, setFilter] = useState<'all' | 'live' | 'upcoming' | 'completed'>('all')
  
  // Safe filtering with default empty array
  const filteredMatches = filter === 'all' 
    ? (matches || [])
    : (matches || []).filter(match => match.status === filter)

  const getStatusIcon = (status: string) => {
    switch(status) {
      case 'live':
        return <Play className="h-4 w-4" />
      case 'upcoming':
        return <Clock className="h-4 w-4" />
      case 'completed':
        return <CheckCircle className="h-4 w-4" />
      default:
        return null
    }
  }

  const getStatusColor = (status: string) => {
    switch(status) {
      case 'live':
        return 'bg-red-100 text-red-700 border-red-200'
      case 'upcoming':
        return 'bg-blue-100 text-blue-700 border-blue-200'
      case 'completed':
        return 'bg-green-100 text-green-700 border-green-200'
      default:
        return 'bg-gray-100 text-gray-700'
    }
  }

  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    const today = new Date()
    const tomorrow = new Date(today)
    tomorrow.setDate(tomorrow.getDate() + 1)
    const yesterday = new Date(today)
    yesterday.setDate(yesterday.getDate() - 1)

    if (date.toDateString() === today.toDateString()) {
      return 'Today'
    } else if (date.toDateString() === tomorrow.toDateString()) {
      return 'Tomorrow'
    } else if (date.toDateString() === yesterday.toDateString()) {
      return 'Yesterday'
    }
    
    return date.toLocaleDateString('en-US', { 
      month: 'short', 
      day: 'numeric'
    })
  }

  const formatTime = (dateString: string) => {
    const date = new Date(dateString)
    return date.toLocaleTimeString('en-US', { 
      hour: 'numeric', 
      minute: '2-digit'
    })
  }

  if (loading) {
    return (
      <section className="mb-8">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <div>
            <h2 className="text-xl font-bold text-gray-900">Invited Matches</h2>
            <p className="text-sm text-gray-500">Matches where you're a participant</p>
          </div>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {[1, 2].map((i) => (
            <div key={i} className="animate-pulse">
              <Card className="p-5 h-64 bg-gray-100"></Card>
            </div>
          ))}
        </div>
      </section>
    )
  }

  return (
    <section className="mb-8">
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div>
          <h2 className="text-xl font-bold text-gray-900">Invited Matches</h2>
          <p className="text-sm text-gray-500">Matches where you're a participant</p>
        </div>
        
        <div className="flex items-center gap-2">
          {/* Filter Tabs */}
          <div className="flex items-center gap-2 bg-gray-100 p-1 rounded-xl">
            {(['all', 'live', 'upcoming', 'completed'] as const).map((status) => (
              <button
                key={status}
                onClick={() => setFilter(status)}
                className={`px-3 py-1.5 rounded-lg text-sm font-medium capitalize transition-all ${
                  filter === status 
                    ? 'bg-white text-gray-900 shadow-sm' 
                    : 'text-gray-600 hover:text-gray-900'
                }`}
              >
                {status}
              </button>
            ))}
          </div>
          
          {/* Refresh Button */}
          <Button
            variant="outline"
            size="sm"
            onClick={onRefresh}
            className="gap-2"
          >
            <RefreshCw className="h-4 w-4" />
          </Button>
        </div>
      </div>

      {filteredMatches.length === 0 ? (
        <Card className="p-12 text-center">
          <div className="max-w-md mx-auto">
            <div className="h-16 w-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center">
              <Users className="h-8 w-8 text-gray-400" />
            </div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">
              {filter === 'all' ? 'No invited matches' : `No ${filter} matches`}
            </h3>
            <p className="text-gray-500">
              {filter === 'all' 
                ? "You haven't been invited to any matches yet." 
                : `You don't have any ${filter} invited matches.`}
            </p>
          </div>
        </Card>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {filteredMatches.map((match, index) => (
            <motion.div
              key={match._id}
              initial={{ opacity: 0, scale: 0.95 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: index * 0.1 }}
              whileHover={{ y: -4 }}
            >
              <Card className="p-5 hover:shadow-lg transition-all bg-white/80 backdrop-blur-sm border-gray-100">
                {/* Status Badge */}
                <div className="flex items-center justify-between mb-4">
                  <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border ${getStatusColor(match.status)}`}>
                    {getStatusIcon(match.status)}
                    <span className="capitalize">{match.status}</span>
                    {match.status === 'live' && (
                      <span className="ml-1 relative flex h-2 w-2">
                        <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                        <span className="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
                      </span>
                    )}
                  </div>
                  <span className="text-xs font-mono text-gray-500">
                    {match.matchCode}
                  </span>
                </div>

                {/* Teams */}
                <div className="space-y-3 mb-4">
                  <div>
                    <div className="flex items-center justify-between">
                      <h3 className="font-semibold text-gray-900">{match.teamOne.name}</h3>
                      {match.status !== 'upcoming' && (
                        <span className="text-sm font-medium text-gray-700">
                          {match.teamOne.total_score || 0}/{match.teamOne.total_wickets || 0}
                        </span>
                      )}
                    </div>
                    {match.status !== 'upcoming' && (
                      <div className="text-xs text-gray-500 text-right">
                        ({match.teamOne.overs} ov)
                      </div>
                    )}
                    
                    <div className="text-center text-xs text-gray-400 my-1">vs</div>
                    
                    <div className="flex items-center justify-between">
                      <h3 className="font-semibold text-gray-900">{match.teamTwo.name}</h3>
                      {match.status !== 'upcoming' && (
                        <span className="text-sm font-medium text-gray-700">
                          {match.teamTwo.total_score || 0}/{match.teamTwo.total_wickets || 0}
                        </span>
                      )}
                    </div>
                    {match.status !== 'upcoming' && (
                      <div className="text-xs text-gray-500 text-right">
                        ({match.teamTwo.overs} ov)
                      </div>
                    )}
                  </div>
                </div>

                {/* Target Display */}
                {match.target && (
                  <div className="mb-4 p-2 bg-blue-50 rounded-lg text-center">
                    <span className="text-xs font-medium text-blue-700">
                      Target: {match.target}
                    </span>
                  </div>
                )}

                {/* Match Details */}
                <div className="space-y-2 mb-4 text-sm text-gray-600">
                  <div className="flex items-center gap-2">
                    <Calendar className="h-3.5 w-3.5" />
                    <span>{formatDate(match.startTime)} ‚Ä¢ {formatTime(match.startTime)}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <MapPin className="h-3.5 w-3.5" />
                    <span className="truncate">{match.venue}</span>
                  </div>
                </div>

                {/* Actions */}
                <div className="flex gap-2">
                  <Button 
                    variant="secondary" 
                    className="flex-1"
                    onClick={(e) => {
                      e.stopPropagation()
                      router.push(`/matches/${match._id}`)
                    }}
                  >
                    <Eye className="h-4 w-4 mr-1.5" />
                    View Match
                  </Button>
                </div>
              </Card>
            </motion.div>
          ))}
        </div>
      )}
    </section>
  )
}

===== FILE: components/dashboard/JoinMatchModel.tsx =====
'use client'

import { useState } from 'react'
import { motion, AnimatePresence } from 'framer-motion'
import { Button } from '@/components/ui/button'
import { X, Link2, ArrowRight } from 'lucide-react'

interface JoinMatchModalProps {
  isOpen: boolean
  onClose: () => void
}

export default function JoinMatchModal({ isOpen, onClose }: JoinMatchModalProps) {
  const [matchCode, setMatchCode] = useState('')
  const [isLoading, setIsLoading] = useState(false)

  const handleJoin = async () => {
    if (!matchCode.trim()) return
    
    setIsLoading(true)
    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 1500))
    setIsLoading(false)
    onClose()
    // Show success toast
  }

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          {/* Backdrop */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50"
          />

          {/* Modal */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 20 }}
            className="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white rounded-3xl shadow-xl z-50 p-6"
          >
            {/* Header */}
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-gradient-to-r from-green-100 to-emerald-100 rounded-xl">
                  <Link2 className="h-5 w-5 text-green-600" />
                </div>
                <h2 className="text-xl font-bold text-gray-900">Join a Match</h2>
              </div>
              <button
                onClick={onClose}
                className="p-2 hover:bg-gray-100 rounded-xl transition-colors"
              >
                <X className="h-5 w-5 text-gray-500" />
              </button>
            </div>

            {/* Content */}
            <div className="space-y-4">
              <p className="text-sm text-gray-600">
                Enter the match code shared by your friend to join their game
              </p>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Match Code
                </label>
                <input
                  type="text"
                  value={matchCode}
                  onChange={(e) => setMatchCode(e.target.value.toUpperCase())}
                  placeholder="e.g., ABC123"
                  className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-center text-lg font-mono uppercase"
                  maxLength={6}
                />
              </div>

              <div className="bg-blue-50 border border-blue-200 rounded-xl p-3">
                <p className="text-xs text-blue-700">
                  üí° Tip: Match codes are usually 6 characters long and contain letters and numbers
                </p>
              </div>
            </div>

            {/* Actions */}
            <div className="flex gap-3 mt-6">
              <Button
                variant="secondary"
                onClick={onClose}
                className="flex-1"
              >
                Cancel
              </Button>
              <Button
                onClick={handleJoin}
                disabled={!matchCode.trim() || isLoading}
                className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white"
              >
                {isLoading ? (
                  <span className="flex items-center gap-2">
                    <span className="h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                    Joining...
                  </span>
                ) : (
                  <>
                    Join Match
                    <ArrowRight className="h-4 w-4 ml-1" />
                  </>
                )}
              </Button>
            </div>
          </motion.div>
        </>
      )}
    </AnimatePresence>
  )
}

===== FILE: components/dashboard/MyMatches.tsx =====
'use client'

import { useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import { motion } from 'framer-motion'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Calendar, MapPin, Eye, Edit2, Play, CheckCircle, Clock, RefreshCw, Trash2, MoreVertical } from 'lucide-react'
import toast from 'react-hot-toast'
import {
  AlertDialog,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogCancel,
  AlertDialogAction,
} from '@/components/ui/AlertDialog'

interface MatchData {
  _id: string;
  matchCode: string;
  status: string;
  venue: string;
  startTime: string;
  overs: number;
  teamOne: {
    name: string;
    total_score?: number;
    total_wickets?: number;
    overs: string;
  };
  teamTwo: {
    name: string;
    total_score?: number;
    total_wickets?: number;
    overs: string;
  };
  isPrivate: boolean;
  createdAt: string;
  target?: number;
}

interface MyMatchesProps {
  matches: MatchData[];
  loading: boolean;
  onRefresh: () => void;
}

export default function MyMatches({ matches, loading, onRefresh }: MyMatchesProps) {
  const router = useRouter()
  const [filter, setFilter] = useState<'all' | 'live' | 'upcoming' | 'completed'>('all')
  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false)
  const [matchToDelete, setMatchToDelete] = useState<MatchData | null>(null)
  const [deleting, setDeleting] = useState(false)
  const [showMenu, setShowMenu] = useState<string | null>(null)

  // Force close menu when dialog opens
  useEffect(() => {
    if (deleteDialogOpen) {
      console.log('üéØ Dialog opened, forcing menu to close')
      setShowMenu(null)
    }
  }, [deleteDialogOpen])

  const filteredMatches = filter === 'all'
    ? matches
    : matches.filter(match => match.status === filter)


  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'live':
        return <Play className="h-4 w-4" />
      case 'upcoming':
        return <Clock className="h-4 w-4" />
      case 'completed':
        return <CheckCircle className="h-4 w-4" />
      default:
        return null
    }
  }

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'live':
        return 'bg-red-100 text-red-700 border-red-200'
      case 'upcoming':
        return 'bg-blue-100 text-blue-700 border-blue-200'
      case 'completed':
        return 'bg-green-100 text-green-700 border-green-200'
      default:
        return 'bg-gray-100 text-gray-700'
    }
  }

  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    const today = new Date()
    const tomorrow = new Date(today)
    tomorrow.setDate(tomorrow.getDate() + 1)
    const yesterday = new Date(today)
    yesterday.setDate(yesterday.getDate() - 1)

    if (date.toDateString() === today.toDateString()) {
      return 'Today'
    } else if (date.toDateString() === tomorrow.toDateString()) {
      return 'Tomorrow'
    } else if (date.toDateString() === yesterday.toDateString()) {
      return 'Yesterday'
    }

    return date.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric'
    })
  }

  const formatTime = (dateString: string) => {
    const date = new Date(dateString)
    return date.toLocaleTimeString('en-US', {
      hour: 'numeric',
      minute: '2-digit'
    })
  }

  const handleDeleteClick = (match: MatchData, e: React.MouseEvent) => {
    console.log('üéØ Delete clicked for:', match.matchCode)
    e.stopPropagation()
    e.preventDefault()

    setMatchToDelete(match)
    setDeleteDialogOpen(true)
    setShowMenu(null) // This will now work correctly
  }

  const handleDeleteConfirm = async () => {
    console.log('üéØ DELETE CONFIRM CALLED!')
    console.log('üéØ Match to delete:', matchToDelete)

    if (!matchToDelete) {
      console.log('üéØ No match to delete, returning')
      return
    }

    setDeleting(true)
    console.log('üéØ Set deleting to true')

    try {
      const token = localStorage.getItem('auth_token')
      console.log('üéØ Token:', token ? 'exists' : 'missing')
      console.log('üéØ Calling DELETE API for match:', matchToDelete._id)

      const response = await fetch(`/api/matches/${matchToDelete._id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      
      const data = await response.json()
      

      if (response.ok) {
        console.log('üéØ Delete successful!')
        toast.success('Match deleted successfully')
        setDeleteDialogOpen(false)
        setMatchToDelete(null)
        console.log('üéØ Calling onRefresh...')
        onRefresh()
      } else {
        console.error('üéØ Delete failed:', data.error)
        toast.error(data.error || 'Failed to delete match')
      }
    } catch (error) {
      console.error('üéØ Delete error:', error)
      toast.error('Failed to delete match')
    } finally {
      console.log('üéØ Setting deleting to false')
      setDeleting(false)
    }
  }

  if (loading) {
    return (
      <section className="mb-8">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <div>
            <h2 className="text-xl font-bold text-gray-900">My Matches</h2>
            <p className="text-sm text-gray-500">Matches you've created or manage</p>
          </div>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {[1, 2, 3].map((i) => (
            <div key={i} className="animate-pulse">
              <Card className="p-5 h-64 bg-gray-100"></Card>
            </div>
          ))}
        </div>
      </section>
    )
  }

  return (
    <>
      <section className="mb-8">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <div>
            <h2 className="text-xl font-bold text-gray-900">My Matches</h2>
            <p className="text-sm text-gray-500">Matches you've created or manage</p>
          </div>

          <div className="flex items-center gap-2">
            {/* Filter Tabs */}
            <div className="flex items-center gap-2 bg-gray-100 p-1 rounded-xl">
              {(['all', 'live', 'upcoming', 'completed'] as const).map((status) => (
                <button
                  key={status}
                  onClick={() => setFilter(status)}
                  className={`px-3 py-1.5 rounded-lg text-sm font-medium capitalize transition-all ${filter === status
                    ? 'bg-white text-gray-900 shadow-sm'
                    : 'text-gray-600 hover:text-gray-900'
                    }`}
                >
                  {status}
                </button>
              ))}
            </div>

            {/* Refresh Button */}
            <Button
              variant="outline"
              size="sm"
              onClick={onRefresh}
              className="gap-2"
            >
              <RefreshCw className="h-4 w-4" />
            </Button>
          </div>
        </div>

        {filteredMatches.length === 0 ? (
          <Card className="p-12 text-center">
            <div className="max-w-md mx-auto">
              <div className="h-16 w-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center">
                <Clock className="h-8 w-8 text-gray-400" />
              </div>
              <h3 className="text-lg font-medium text-gray-900 mb-2">
                {filter === 'all' ? 'No matches yet' : `No ${filter} matches`}
              </h3>
              <p className="text-gray-500 mb-4">
                {filter === 'all'
                  ? "Create your first cricket match to get started!"
                  : `You don't have any ${filter} matches.`}
              </p>
              {filter === 'all' && (
                <Button onClick={() => router.push('/matches/create')}>
                  Create Match
                </Button>
              )}
            </div>
          </Card>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredMatches.map((match, index) => (
              <motion.div
                key={match._id}
                initial={{ opacity: 0, scale: 0.95 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ delay: index * 0.1 }}
                whileHover={{ y: -4 }}
              >
                <Card className="p-5 hover:shadow-lg transition-all bg-white/80 backdrop-blur-sm border-gray-100 relative">
                  {/* Delete/Menu Button */}
                  <div className="absolute top-3 right-3">
                    <button
                      onClick={(e) => {
                        e.stopPropagation()
                        setShowMenu(showMenu === match._id ? null : match._id)
                      }}
                      className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors"
                    >
                      <MoreVertical className="h-4 w-4 text-gray-500" />
                    </button>

                    {/* Dropdown Menu */}
                    {showMenu === match._id && (
                      <div className="absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-10">
                        <button
                          onClick={() => router.push(`/matches/${match._id}`)}
                          className="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"
                        >
                          <Eye className="h-4 w-4" />
                          View Details
                        </button>
                        {match.status === 'upcoming' && (
                          <button
                            onClick={() => router.push(`/matches/${match._id}/edit`)}
                            className="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"
                          >
                            <Edit2 className="h-4 w-4" />
                            Edit Match
                          </button>
                        )}
                        <hr className="my-1" />
                        <button
                          onClick={(e) => handleDeleteClick(match, e)}
                          className="w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"
                        >
                          <Trash2 className="h-4 w-4" />
                          Delete Match
                        </button>
                      </div>
                    )}
                  </div>

                  {/* Status Badge */}
                  <div className="flex items-center justify-between mb-4 pr-8">
                    <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border ${getStatusColor(match.status)}`}>
                      {getStatusIcon(match.status)}
                      <span className="capitalize">{match.status}</span>
                      {match.status === 'live' && (
                        <span className="ml-1 relative flex h-2 w-2">
                          <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                          <span className="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
                        </span>
                      )}
                    </div>
                  </div>

                  <div className="mb-2">
                    <span className="text-xs font-mono text-gray-500">
                      {match.matchCode}
                    </span>
                  </div>

                  {/* Teams */}
                  <div className="space-y-3 mb-4">
                    <div>
                      <div className="flex items-center justify-between">
                        <h3 className="font-semibold text-gray-900">{match.teamOne.name}</h3>
                        {match.status !== 'upcoming' && (
                          <span className="text-sm font-medium text-gray-700">
                            {match.teamOne.total_score || 0}/{match.teamOne.total_wickets || 0}
                          </span>
                        )}
                      </div>
                      {match.status !== 'upcoming' && (
                        <div className="text-xs text-gray-500 text-right">
                          ({match.teamOne.overs} ov)
                        </div>
                      )}

                      <div className="text-center text-xs text-gray-400 my-1">vs</div>

                      <div className="flex items-center justify-between">
                        <h3 className="font-semibold text-gray-900">{match.teamTwo.name}</h3>
                        {match.status !== 'upcoming' && (
                          <span className="text-sm font-medium text-gray-700">
                            {match.teamTwo.total_score || 0}/{match.teamTwo.total_wickets || 0}
                          </span>
                        )}
                      </div>
                      {match.status !== 'upcoming' && (
                        <div className="text-xs text-gray-500 text-right">
                          ({match.teamTwo.overs} ov)
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Target Display */}
                  {match.target && (
                    <div className="mb-4 p-2 bg-blue-50 rounded-lg text-center">
                      <span className="text-xs font-medium text-blue-700">
                        Target: {match.target}
                      </span>
                    </div>
                  )}

                  {/* Match Details */}
                  <div className="space-y-2 mb-4 text-sm text-gray-600">
                    <div className="flex items-center gap-2">
                      <Calendar className="h-3.5 w-3.5" />
                      <span>{formatDate(match.startTime)} ‚Ä¢ {formatTime(match.startTime)}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <MapPin className="h-3.5 w-3.5" />
                      <span className="truncate">{match.venue}</span>
                    </div>
                  </div>

                  {/* Actions */}
                  <div className="flex gap-2">
                    {match.status === 'live' ? (
                      <Button
                        className="flex-1 bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white"
                        onClick={(e) => {
                          e.stopPropagation()
                          router.push(`/matches/${match._id}/score`)
                        }}
                      >
                        <Edit2 className="h-4 w-4 mr-1.5" />
                        Continue Scoring
                      </Button>
                    ) : match.status === 'upcoming' ? (
                      <>
                        <Button
                          variant="secondary"
                          className="flex-1"
                          onClick={(e) => {
                            e.stopPropagation()
                            router.push(`/matches/${match._id}/edit`)
                          }}
                        >
                          <Edit2 className="h-4 w-4 mr-1.5" />
                          Edit
                        </Button>
                        <Button
                          className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white"
                          onClick={(e) => {
                            e.stopPropagation()
                            router.push(`/matches/${match._id}/score`)
                          }}
                        >
                          Start
                        </Button>
                      </>
                    ) : (
                      <Button
                        variant="secondary"
                        className="flex-1"
                        onClick={(e) => {
                          e.stopPropagation()
                          router.push(`/matches/${match._id}`)
                        }}
                      >
                        <Eye className="h-4 w-4 mr-1.5" />
                        View Details
                      </Button>
                    )}
                  </div>
                </Card>
              </motion.div>
            ))}
          </div>
        )}
      </section>


      {/* Delete Confirmation Dialog */}
      <AlertDialog
        open={deleteDialogOpen}
        onOpenChange={(open) => {
          console.log('üéØ Dialog onOpenChange called with:', open)
          setDeleteDialogOpen(open)
          if (!open) {
            setMatchToDelete(null)
          }
        }}
      >
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Delete Match?</AlertDialogTitle>
            <AlertDialogDescription>
              Are you sure you want to delete <strong>{matchToDelete?.matchCode}</strong>?
              <br />
              <span className="text-gray-900 font-medium">
                {matchToDelete?.teamOne.name} vs {matchToDelete?.teamTwo.name}
              </span>
              <br /><br />
              This action cannot be undone. All match data including scores and statistics will be permanently deleted.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel onClick={() => {
              console.log('üéØ Cancel clicked')
              setDeleteDialogOpen(false)
              setMatchToDelete(null)
            }}>
              Cancel
            </AlertDialogCancel>
            <AlertDialogAction
              onClick={() => {
                console.log('üéØ Delete clicked')
                handleDeleteConfirm()
              }}
              variant="destructive"
              disabled={deleting}
            >
              {deleting ? 'Deleting...' : 'Delete Match'}
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>


    </>
  )
}

===== FILE: components/dashboard/Navbar.tsx =====
'use client'

import { useRouter } from 'next/navigation'
import { Button } from '@/components/ui/button'
import { LogOut, Plus, Bell, Settings } from 'lucide-react'
import { useState } from 'react'

interface NavbarProps {
  user: {
    id: string;
    name: string;
    email: string;
  } | null;
  onLogout?: () => void;
}

export default function Navbar({ user, onLogout }: NavbarProps) {
  const router = useRouter()
  const [isMenuOpen, setIsMenuOpen] = useState(false)

  const handleLogout = () => {
    if (onLogout) {
      onLogout()
    } else {
      localStorage.clear()
      router.push('/login')
    }
  }

  return (
    <header className="bg-white shadow-sm border-b border-gray-100 sticky top-0 z-50">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl">
        <div className="flex items-center justify-between h-16">
          {/* Logo */}
          <div 
            className="flex items-center gap-3 cursor-pointer"
            onClick={() => router.push('/dashboard')}
          >
            <span className="text-2xl">üèè</span>
            <div>
              <h1 className="text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                Local League Cricket
              </h1>
              <p className="text-xs text-gray-500 hidden sm:block">Score with friends</p>
            </div>
          </div>

          {/* Right side */}
          <div className="flex items-center gap-2 sm:gap-4">
            {/* Create Match Button - Desktop */}
            <Button 
              className="hidden sm:flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white shadow-md hover:shadow-lg transition-all"
              onClick={() => router.push('/matches/create')}
            >
              <Plus className="h-4 w-4" />
              Create Match
            </Button>

            {/* Notifications */}
            <button className="p-2 hover:bg-gray-100 rounded-xl transition-colors relative">
              <Bell className="h-5 w-5 text-gray-600" />
              <span className="absolute -top-1 -right-1 h-4 w-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">
                2
              </span>
            </button>

            {/* User Menu */}
            <div className="relative">
              <button
                onClick={() => setIsMenuOpen(!isMenuOpen)}
                className="flex items-center gap-2 p-2 hover:bg-gray-100 rounded-xl transition-colors"
              >
                <div className="h-9 w-9 bg-gradient-to-br from-green-400 to-emerald-400 rounded-xl flex items-center justify-center text-white font-semibold shadow-sm">
                  {user?.name?.charAt(0).toUpperCase() || 'U'}
                </div>
                <div className="text-left hidden sm:block">
                  <p className="text-sm font-medium text-gray-900">{user?.name || 'User'}</p>
                  <p className="text-xs text-gray-500">{user?.email || 'email@example.com'}</p>
                </div>
              </button>

              {/* Dropdown Menu */}
              {isMenuOpen && (
                <>
                  <div 
                    className="fixed inset-0 z-10"
                    onClick={() => setIsMenuOpen(false)}
                  />
                  <div className="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-100 py-2 z-20">
                    <button
                      onClick={() => router.push('/profile')}
                      className="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                    >
                      Profile
                    </button>
                    <button
                      onClick={() => router.push('/settings')}
                      className="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2"
                    >
                      <Settings className="h-4 w-4" />
                      Settings
                    </button>
                    <hr className="my-2 border-gray-100" />
                    <button
                      onClick={handleLogout}
                      className="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors flex items-center gap-2"
                    >
                      <LogOut className="h-4 w-4" />
                      Sign out
                    </button>
                  </div>
                </>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Mobile Create Button */}
      <button
        onClick={() => router.push('/matches/create')}
        className="fixed bottom-6 right-6 sm:hidden bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-full p-4 shadow-lg z-40 hover:scale-110 transition-transform"
      >
        <Plus className="h-6 w-6" />
      </button>
    </header>
  )
}

===== FILE: components/dashboard/QuickActions.tsx =====
'use client'

import { motion } from 'framer-motion'
import { Plus, Link2, Trophy, Users } from 'lucide-react'
import { useState } from 'react'
import JoinMatchModal from './JoinMatchModel'
import { useRouter } from 'next/navigation'

const actions = [
  {
    icon: Plus,
    title: 'Create New Match',
    description: 'Start a new game',
    color: 'from-blue-500 to-indigo-500',
    bgColor: 'from-blue-50 to-indigo-50',
    action: 'create'
  },
  {
    icon: Link2,
    title: 'Join via Code',
    description: 'Enter match code',
    color: 'from-green-500 to-emerald-500',
    bgColor: 'from-green-50 to-emerald-50',
    action: 'join'
  },
  {
    icon: Trophy,
    title: 'View Leaderboard',
    description: 'Check rankings',
    color: 'from-yellow-500 to-orange-500',
    bgColor: 'from-yellow-50 to-orange-50',
    action: 'leaderboard'
  },
  {
    icon: Users,
    title: 'Invite Friends',
    description: 'Share the app',
    color: 'from-purple-500 to-pink-500',
    bgColor: 'from-purple-50 to-pink-50',
    action: 'invite'
  }
]

export default function QuickActions() {
  const router = useRouter()
  const [isJoinModalOpen, setIsJoinModalOpen] = useState(false)

  const handleAction = (action: string) => {
    switch(action) {
      case 'create':
        // Navigate to create match
        router.push('/matches/create')
        break
      case 'join':
        setIsJoinModalOpen(true)
        break
      case 'leaderboard':
        // Navigate to leaderboard
        router.push('/leaderboard')
        break
      case 'invite':
        // Open share modal or native share
        if (navigator.share) {
          navigator.share({
            title: 'Local League Cricket',
            text: 'Join me on Local League Cricket for exciting matches!',
            url: window.location.origin
          })
        } else {
          // Fallback to clipboard
          const shareText = `Join me on Local League Cricket for exciting matches! ${window.location.origin}`
          navigator.clipboard.writeText(shareText)
          // Could add a toast notification here
          console.log('Share link copied to clipboard')
        }
        break
    }
  }

  return (
    <>
      <section className="mb-8">
        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
          {actions.map((action, index) => (
            <motion.button
              key={index}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: index * 0.1 }}
              whileHover={{ scale: 1.02, y: -2 }}
              whileTap={{ scale: 0.98 }}
              onClick={() => handleAction(action.action)}
              className="group relative bg-white rounded-2xl p-4 sm:p-5 shadow-sm hover:shadow-md transition-all border border-gray-100"
            >
              <div className={`absolute inset-0 bg-gradient-to-br ${action.bgColor} rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity`}></div>
              
              <div className="relative">
                <div className={`inline-flex p-3 rounded-xl bg-gradient-to-r ${action.color} text-white mb-3 group-hover:scale-110 transition-transform`}>
                  <action.icon className="h-5 w-5" />
                </div>
                <h3 className="font-semibold text-gray-900 text-sm sm:text-base">{action.title}</h3>
                <p className="text-xs text-gray-500 mt-1">{action.description}</p>
              </div>
            </motion.button>
          ))}
        </div>
      </section>

      <JoinMatchModal 
        isOpen={isJoinModalOpen} 
        onClose={() => setIsJoinModalOpen(false)} 
      />
    </>
  )
}

===== FILE: components/dashboard/WelcomeBanner.tsx =====
'use client'

import { motion } from 'framer-motion'
import { Sparkles, TrendingUp } from 'lucide-react'

export default function WelcomeBanner() {
  const userName = "Ahmed"
  const stats = {
    totalMatches: 24,
    liveMatches: 2,
    friendsPlaying: 8
  }

  return (
    <motion.section
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5 }}
      className="mb-8"
    >
      <div className="bg-gradient-to-r from-green-500/10 via-emerald-500/10 to-teal-500/10 rounded-3xl p-6 sm:p-8 border border-green-200/50 relative overflow-hidden">
        {/* Background decoration */}
        <div className="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-green-300/20 to-emerald-300/20 rounded-full blur-3xl -mr-32 -mt-32"></div>
        
        <div className="relative">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
              <motion.h1 
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.2 }}
                className="text-2xl sm:text-3xl font-bold text-gray-900 mb-2"
              >
                Welcome back, {userName}! üëã
              </motion.h1>
              <motion.p 
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.3 }}
                className="text-gray-600"
              >
                Manage your matches or join your friends to keep scores live.
              </motion.p>
            </div>

            {/* Cricket illustration */}
            <motion.div
              initial={{ opacity: 0, scale: 0.8 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: 0.4 }}
              className="text-6xl sm:text-7xl"
            >
              üèè
            </motion.div>
          </div>

          {/* Quick Stats */}
          <motion.div 
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.5 }}
            className="grid grid-cols-3 gap-4 mt-6"
          >
            <div className="bg-white/70 backdrop-blur-sm rounded-2xl p-3 sm:p-4 text-center">
              <p className="text-2xl sm:text-3xl font-bold text-gray-900">{stats.totalMatches}</p>
              <p className="text-xs sm:text-sm text-gray-600">Total Matches</p>
            </div>
            <div className="bg-white/70 backdrop-blur-sm rounded-2xl p-3 sm:p-4 text-center relative">
              <div className="absolute -top-1 -right-1">
                <span className="relative flex h-3 w-3">
                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span className="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </span>
              </div>
              <p className="text-2xl sm:text-3xl font-bold text-green-600">{stats.liveMatches}</p>
              <p className="text-xs sm:text-sm text-gray-600">Live Now</p>
            </div>
            <div className="bg-white/70 backdrop-blur-sm rounded-2xl p-3 sm:p-4 text-center">
              <p className="text-2xl sm:text-3xl font-bold text-gray-900">{stats.friendsPlaying}</p>
              <p className="text-xs sm:text-sm text-gray-600">Friends Playing</p>
            </div>
          </motion.div>
        </div>
      </div>
    </motion.section>
  )
}

===== FILE: components/home/Header.tsx =====
'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { 
  Bell, 
  Search, 
  Menu, 
  X, 
  User, 
  Settings, 
  LogOut,
  Trophy,
  Calendar,
  Users,
  BarChart3,
  Home
} from 'lucide-react'
import { motion, AnimatePresence } from 'framer-motion'

export default function Header() {
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false)
  const [isProfileOpen, setIsProfileOpen] = useState(false)

  const navigation = [
    { name: 'Dashboard', href: '/home', icon: Home, current: true },
    { name: 'Matches', href: '/matches', icon: Trophy, current: false },
    { name: 'Teams', href: '/teams', icon: Users, current: false },
    { name: 'Schedule', href: '/schedule', icon: Calendar, current: false },
    { name: 'Statistics', href: '/stats', icon: BarChart3, current: false },
  ]

  return (
    <header className="bg-white border-b border-gray-200 sticky top-0 z-50">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex items-center justify-between h-16">
          {/* Logo & Desktop Nav */}
          <div className="flex items-center">
            <div className="flex-shrink-0">
              <h1 className="text-xl font-bold text-gray-900">
                LLC <span className="text-primary-600">Scoreboard</span>
              </h1>
            </div>
            
            {/* Desktop Navigation */}
            <nav className="hidden md:ml-10 md:flex md:space-x-1">
              {navigation.map((item) => (
                <a
                  key={item.name}
                  href={item.href}
                  className={`
                    flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors
                    ${item.current 
                      ? 'bg-primary-50 text-primary-700' 
                      : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'
                    }
                  `}
                >
                  <item.icon className="h-4 w-4" />
                  {item.name}
                </a>
              ))}
            </nav>
          </div>

          {/* Right side actions */}
          <div className="flex items-center gap-4">
            {/* Search */}
            <div className="hidden md:block">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
                <input
                  type="text"
                  placeholder="Search matches, teams..."
                  className="pl-10 pr-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent w-64"
                />
              </div>
            </div>

            {/* Notifications */}
            <button className="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
              <Bell className="h-5 w-5" />
              <span className="absolute top-1 right-1 h-2 w-2 bg-red-500 rounded-full"></span>
            </button>

            {/* Profile Dropdown */}
            <div className="relative">
              <button
                onClick={() => setIsProfileOpen(!isProfileOpen)}
                className="flex items-center gap-2 p-2 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <div className="h-8 w-8 bg-gradient-to-r from-primary-400 to-accent-400 rounded-full flex items-center justify-center text-white text-sm font-semibold">
                  RK
                </div>
              </button>

              <AnimatePresence>
                {isProfileOpen && (
                  <motion.div
                    initial={{ opacity: 0, y: -10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -10 }}
                    className="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-lg border border-gray-200 py-2"
                  >
                    <div className="px-4 py-3 border-b border-gray-100">
                      <p className="text-sm font-semibold text-gray-900">Rajesh Kumar</p>
                      <p className="text-xs text-gray-500">rajesh@example.com</p>
                    </div>
                    <a href="/profile" className="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                      <User className="h-4 w-4" />
                      Profile
                    </a>
                    <a href="/settings" className="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                      <Settings className="h-4 w-4" />
                      Settings
                    </a>
                    <hr className="my-2 border-gray-100" />
                    <button className="flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left">
                      <LogOut className="h-4 w-4" />
                      Sign out
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>
            </div>

            {/* Mobile menu button */}
            <button
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
              className="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-lg"
            >
              {isMobileMenuOpen ? <X className="h-5 w-5" /> : <Menu className="h-5 w-5" />}
            </button>
          </div>
        </div>

        {/* Mobile Navigation */}
        <AnimatePresence>
          {isMobileMenuOpen && (
            <motion.nav
              initial={{ height: 0 }}
              animate={{ height: 'auto' }}
              exit={{ height: 0 }}
              className="md:hidden overflow-hidden"
            >
              <div className="py-2 space-y-1">
                {navigation.map((item) => (
                  <a
                    key={item.name}
                    href={item.href}
                    className={`
                      flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium
                      ${item.current 
                        ? 'bg-primary-50 text-primary-700' 
                        : 'text-gray-600 hover:bg-gray-50'
                      }
                    `}
                  >
                    <item.icon className="h-4 w-4" />
                    {item.name}
                  </a>
                ))}
              </div>
            </motion.nav>
          )}
        </AnimatePresence>
      </div>
    </header>
  )
}

===== FILE: components/home/LiveMatches.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Clock, Users, TrendingUp, Circle, Eye, Edit } from 'lucide-react'
import { motion } from 'framer-motion'

interface Match {
  id: string
  team1: {
    name: string
    score: string
    overs: string
    logo: string
  }
  team2: {
    name: string
    score: string
    overs: string
    logo: string
  }
  status: string
  venue: string
  viewers: number
  isAdmin: boolean
}

const liveMatches: Match[] = [
  {
    id: '1',
    team1: {
      name: 'Mumbai Warriors',
      score: '156/4',
      overs: '18.3',
      logo: 'üèè',
    },
    team2: {
      name: 'Delhi Dynamos',
      score: '112/6',
      overs: '15.0',
      logo: 'ü¶Ö',
    },
    status: 'Mumbai Warriors need 45 runs in 9 balls',
    venue: 'Wankhede Stadium',
    viewers: 1234,
    isAdmin: true,
  },
  {
    id: '2',
    team1: {
      name: 'Chennai Chargers',
      score: '198/7',
      overs: '20.0',
      logo: '‚ö°',
    },
    team2: {
      name: 'Kolkata Knights',
      score: '145/3',
      overs: '16.2',
      logo: 'üõ°Ô∏è',
    },
    status: 'Kolkata Knights need 54 runs in 22 balls',
    venue: 'Eden Gardens',
    viewers: 892,
    isAdmin: false,
  },
  {
    id: '3',
    team1: {
      name: 'Bangalore Bulls',
      score: '78/2',
      overs: '8.4',
      logo: 'üêÇ',
    },
    team2: {
      name: 'Punjab Panthers',
      score: 'Yet to bat',
      overs: '-',
      logo: 'üêÜ',
    },
    status: 'Bangalore Bulls batting',
    venue: 'Chinnaswamy Stadium',
    viewers: 567,
    isAdmin: true,
  },
]

export default function LiveMatches() {
  return (
    <Card className="p-6">
      <div className="flex items-center justify-between mb-6">
        <div className="flex items-center gap-2">
          <div className="relative">
            <Circle className="h-3 w-3 text-red-500 fill-current animate-pulse" />
            <Circle className="h-3 w-3 text-red-500 fill-current absolute top-0 animate-ping" />
          </div>
          <h2 className="text-lg font-semibold text-gray-900">Live Matches</h2>
          <span className="text-sm text-gray-500">({liveMatches.length})</span>
        </div>
        <Button variant="ghost" size="sm">View All</Button>
      </div>

      <div className="space-y-4">
        {liveMatches.map((match, index) => (
          <motion.div
            key={match.id}
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ delay: index * 0.1 }}
            className="border border-gray-100 rounded-xl p-4 hover:bg-gray-50 transition-colors"
          >
            {/* Match Header */}
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2 text-sm text-gray-600">
                <Clock className="h-3 w-3" />
                <span>{match.venue}</span>
              </div>
              <div className="flex items-center gap-3">
                <div className="flex items-center gap-1 text-sm text-gray-600">
                  <Users className="h-3 w-3" />
                  <span>{match.viewers}</span>
                </div>
                {match.isAdmin ? (
                  <Button size="sm" variant="ghost" className="h-8">
                    <Edit className="h-3 w-3 mr-1" />
                    Score
                  </Button>
                ) : (
                  <Button size="sm" variant="ghost" className="h-8">
                    <Eye className="h-3 w-3 mr-1" />
                    View
                  </Button>
                )}
              </div>
            </div>

            {/* Teams */}
            <div className="space-y-3">
              {/* Team 1 */}
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <span className="text-2xl">{match.team1.logo}</span>
                  <div>
                    <p className="font-medium text-gray-900">{match.team1.name}</p>
                    <p className="text-xs text-gray-500">Overs: {match.team1.overs}</p>
                  </div>
                </div>
                <div className="text-right">
                  <p className="text-xl font-bold text-gray-900">{match.team1.score}</p>
                </div>
              </div>

              {/* Team 2 */}
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <span className="text-2xl">{match.team2.logo}</span>
                  <div>
                    <p className="font-medium text-gray-900">{match.team2.name}</p>
                    <p className="text-xs text-gray-500">
                      {match.team2.overs !== '-' ? `Overs: ${match.team2.overs}` : 'Yet to bat'}
                    </p>
                  </div>
                </div>
                <div className="text-right">
                  <p className="text-xl font-bold text-gray-900">{match.team2.score}</p>
                </div>
              </div>
            </div>

            {/* Status */}
            <div className="mt-3 pt-3 border-t border-gray-100">
              <div className="flex items-center gap-2">
                <TrendingUp className="h-3 w-3 text-primary-600" />
                <p className="text-sm text-gray-700">{match.status}</p>
              </div>
            </div>
          </motion.div>
        ))}
      </div>
    </Card>
  )
}

===== FILE: components/home/QuickActions.tsx =====
'use client'

import { Button } from '@/components/ui/button'
import { 
  PlusCircle, 
  Trophy, 
  Users, 
  Calendar,
  FileText,
  Share2
} from 'lucide-react'
import { motion } from 'framer-motion'

const actions = [
  {
    icon: PlusCircle,
    label: 'New Match',
    color: 'from-blue-500 to-cyan-500',
    href: '/matches/new',
  },
  {
    icon: Trophy,
    label: 'Live Score',
    color: 'from-green-500 to-emerald-500',
    href: '/matches/live',
  },
  {
    icon: Users,
    label: 'Add Team',
    color: 'from-purple-500 to-pink-500',
    href: '/teams/new',
  },
  {
    icon: Calendar,
    label: 'Schedule',
    color: 'from-orange-500 to-red-500',
    href: '/schedule',
  },
  {
    icon: FileText,
    label: 'Reports',
    color: 'from-indigo-500 to-purple-500',
    href: '/reports',
  },
  {
    icon: Share2,
    label: 'Share',
    color: 'from-teal-500 to-cyan-500',
    href: '/share',
  },
]

export default function QuickActions() {
  return (
    <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
      <h2 className="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h2>
      
      <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
        {actions.map((action, index) => (
          <motion.a
            key={index}
            href={action.href}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.05 }}
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
            className="flex flex-col items-center gap-3 p-4 rounded-xl hover:bg-gray-50 transition-colors group"
          >
            <div className={`p-3 rounded-xl bg-gradient-to-r ${action.color} text-white group-hover:scale-110 transition-transform`}>
              <action.icon className="h-5 w-5" />
            </div>
            <span className="text-sm font-medium text-gray-700">{action.label}</span>
          </motion.a>
        ))}
      </div>
    </div>
  )
}

===== FILE: components/home/RecentActivity.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { 
  Trophy, 
  UserPlus, 
  Calendar, 
  Edit, 
  Share2,
  Clock
} from 'lucide-react'
import { motion } from 'framer-motion'

const activities = [
  {
    id: '1',
    type: 'match_completed',
    title: 'Match Completed',
    description: 'Mumbai Warriors vs Delhi Dynamos',
    time: '2 hours ago',
    icon: Trophy,
    color: 'text-green-600',
    bg: 'bg-green-50',
  },
  {
    id: '2',
    type: 'player_added',
    title: 'New Player Added',
    description: 'Rahul Sharma joined Mumbai Warriors',
    time: '5 hours ago',
    icon: UserPlus,
    color: 'text-blue-600',
    bg: 'bg-blue-50',
  },
  {
    id: '3',
    type: 'match_scheduled',
    title: 'Match Scheduled',
    description: 'Upcoming match on Dec 28',
    time: '1 day ago',
    icon: Calendar,
    color: 'text-purple-600',
    bg: 'bg-purple-50',
  },
  {
    id: '4',
    type: 'score_updated',
    title: 'Score Updated',
    description: 'Live match score updated',
    time: '2 days ago',
    icon: Edit,
    color: 'text-orange-600',
    bg: 'bg-orange-50',
  },
  {
    id: '5',
    type: 'match_shared',
    title: 'Match Shared',
    description: 'Match link shared with 45 people',
    time: '3 days ago',
    icon: Share2,
    color: 'text-indigo-600',
    bg: 'bg-indigo-50',
  },
]

export default function RecentActivity() {
  return (
    <Card className="p-6">
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-lg font-semibold text-gray-900">Recent Activity</h2>
        <Clock className="h-4 w-4 text-gray-400" />
      </div>

      <div className="space-y-4">
        {activities.map((activity, index) => (
          <motion.div
            key={activity.id}
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ delay: index * 0.05 }}
            className="flex items-start gap-3"
          >
            <div className={`p-2 rounded-lg ${activity.bg} flex-shrink-0`}>
              <activity.icon className={`h-4 w-4 ${activity.color}`} />
            </div>
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium text-gray-900">{activity.title}</p>
              <p className="text-xs text-gray-600 truncate">{activity.description}</p>
              <p className="text-xs text-gray-400 mt-1">{activity.time}</p>
            </div>
          </motion.div>
        ))}
      </div>

      <button className="mt-4 text-sm text-primary-600 hover:text-primary-700 font-medium">
        View all activity ‚Üí
      </button>
    </Card>
  )
}

===== FILE: components/home/StatsOverview.tsx =====
'use client'

import { TrendingUp, TrendingDown, Trophy, Users, Target, Clock } from 'lucide-react'
import { motion } from 'framer-motion'

const stats = [
  {
    label: 'Total Matches',
    value: '124',
    change: '+12%',
    trend: 'up',
    icon: Trophy,
    color: 'text-blue-600',
    bg: 'bg-blue-50',
  },
  {
    label: 'Active Players',
    value: '486',
    change: '+8%',
    trend: 'up',
    icon: Users,
    color: 'text-green-600',
    bg: 'bg-green-50',
  },
  {
    label: 'Win Rate',
    value: '68%',
    change: '+5%',
    trend: 'up',
    icon: Target,
    color: 'text-purple-600',
    bg: 'bg-purple-50',
  },
  {
    label: 'Avg. Match Time',
    value: '3.2h',
    change: '-10%',
    trend: 'down',
    icon: Clock,
    color: 'text-orange-600',
    bg: 'bg-orange-50',
  },
]

export default function StatsOverview() {
  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      {stats.map((stat, index) => (
        <motion.div
          key={index}
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ delay: index * 0.1 }}
          className="bg-white rounded-xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow"
        >
          <div className="flex items-start justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">{stat.label}</p>
              <p className="text-2xl font-bold text-gray-900">{stat.value}</p>
              <div className="flex items-center gap-1 mt-2">
                {stat.trend === 'up' ? (
                  <TrendingUp className="h-4 w-4 text-green-500" />
                ) : (
                  <TrendingDown className="h-4 w-4 text-red-500" />
                )}
                <span className={`text-sm font-medium ${
                  stat.trend === 'up' ? 'text-green-600' : 'text-red-600'
                }`}>
                  {stat.change}
                </span>
              </div>
            </div>
            <div className={`p-3 rounded-lg ${stat.bg}`}>
              <stat.icon className={`h-5 w-5 ${stat.color}`} />
            </div>
          </div>
        </motion.div>
      ))}
    </div>
  )
}

===== FILE: components/home/TeamPerformance.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { TrendingUp, Award, Target } from 'lucide-react'
import { motion } from 'framer-motion'

const teamStats = {
  name: 'Mumbai Warriors',
  position: '2nd',
  played: 15,
  won: 10,
  lost: 4,
  tied: 1,
  winRate: 67,
  recentForm: ['W', 'W', 'L', 'W', 'W'],
  topScorer: {
    name: 'Virat Singh',
    runs: 342,
  },
  topWickets: {
    name: 'Amit Sharma',
    wickets: 18,
  },
}

export default function TeamPerformance() {
  return (
    <Card className="p-6">
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-lg font-semibold text-gray-900">My Team</h2>
        <span className="text-2xl">üèÜ</span>
      </div>

      <div className="space-y-4">
        {/* Team Name & Position */}
        <div>
          <h3 className="text-xl font-bold text-gray-900">{teamStats.name}</h3>
          <div className="flex items-center gap-2 mt-1">
            <Award className="h-4 w-4 text-yellow-500" />
            <span className="text-sm font-medium text-gray-600">
              Currently {teamStats.position} in League
            </span>
          </div>
        </div>

        {/* Win Rate */}
        <div>
          <div className="flex items-center justify-between mb-2">
            <span className="text-sm text-gray-600">Win Rate</span>
            <span className="text-sm font-semibold text-gray-900">{teamStats.winRate}%</span>
          </div>
          <div className="w-full bg-gray-200 rounded-full h-2">
            <motion.div
              initial={{ width: 0 }}
              animate={{ width: `${teamStats.winRate}%` }}
              transition={{ duration: 1, ease: "easeOut" }}
              className="bg-gradient-to-r from-primary-500 to-accent-500 h-2 rounded-full"
            />
          </div>
        </div>

        {/* Match Stats */}
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center p-3 bg-green-50 rounded-lg">
            <p className="text-2xl font-bold text-green-600">{teamStats.won}</p>
            <p className="text-xs text-gray-600">Won</p>
          </div>
          <div className="text-center p-3 bg-red-50 rounded-lg">
            <p className="text-2xl font-bold text-red-600">{teamStats.lost}</p>
            <p className="text-xs text-gray-600">Lost</p>
          </div>
        </div>

        {/* Recent Form */}
        <div>
          <p className="text-sm text-gray-600 mb-2">Recent Form</p>
          <div className="flex gap-1">
            {teamStats.recentForm.map((result, index) => (
              <div
                key={index}
                className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${
                  result === 'W'
                    ? 'bg-green-100 text-green-600'
                    : result === 'L'
                    ? 'bg-red-100 text-red-600'
                    : 'bg-gray-100 text-gray-600'
                }`}
              >
                {result}
              </div>
            ))}
          </div>
        </div>

        {/* Top Performers */}
        <div className="space-y-3 pt-3 border-t border-gray-100">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-xs text-gray-500">Top Scorer</p>
              <p className="font-medium text-gray-900">{teamStats.topScorer.name}</p>
            </div>
            <p className="text-lg font-bold text-primary-600">{teamStats.topScorer.runs}</p>
          </div>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-xs text-gray-500">Top Bowler</p>
              <p className="font-medium text-gray-900">{teamStats.topWickets.name}</p>
            </div>
            <p className="text-lg font-bold text-primary-600">{teamStats.topWickets.wickets}</p>
          </div>
        </div>
      </div>
    </Card>
  )
}

===== FILE: components/home/UpcomingMatches.tsx =====
'use client'

import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Calendar, Clock, MapPin, ArrowRight } from 'lucide-react'
import { motion } from 'framer-motion'

const upcomingMatches = [
  {
    id: '1',
    team1: 'Riverside Rangers',
    team2: 'Valley Vikings',
    date: 'Today',
    time: '3:00 PM',
    venue: 'Central Ground',
    type: 'League Match',
  },
  {
    id: '2',
    team1: 'City Crushers',
    team2: 'Beach Blazers',
    date: 'Tomorrow',
    time: '10:00 AM',
    venue: 'Sports Complex',
    type: 'Friendly',
  },
  {
    id: '3',
    team1: 'North Stars',
    team2: 'South Strikers',
    date: 'Dec 28',
    time: '2:00 PM',
    venue: 'Stadium A',
    type: 'Tournament',
  },
]

export default function UpcomingMatches() {
  return (
    <Card className="p-6">
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-lg font-semibold text-gray-900">Upcoming Matches</h2>
        <Button variant="ghost" size="sm">
          Schedule
          <ArrowRight className="ml-1 h-3 w-3" />
        </Button>
      </div>

      <div className="space-y-3">
        {upcomingMatches.map((match, index) => (
          <motion.div
            key={match.id}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.1 }}
            className="flex items-center justify-between p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer"
          >
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-2">
                <span className="text-xs px-2 py-1 bg-primary-100 text-primary-700 rounded-full font-medium">
                  {match.type}
                </span>
                <span className="text-xs text-gray-500">{match.date}</span>
              </div>
              <p className="font-medium text-gray-900">
                {match.team1} vs {match.team2}
              </p>
              <div className="flex items-center gap-4 mt-2 text-sm text-gray-600">
                <div className="flex items-center gap-1">
                  <Clock className="h-3 w-3" />
                  <span>{match.time}</span>
                </div>
                <div className="flex items-center gap-1">
                  <MapPin className="h-3 w-3" />
                  <span>{match.venue}</span>
                </div>
              </div>
            </div>
            <Button size="sm" variant="secondary">
              Set Reminder
            </Button>
          </motion.div>
        ))}
      </div>
    </Card>
  )
}

===== FILE: components/Leaderboard/LeaderboardTabs.tsx =====
'use client';

import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import TeamsLeaderboard from './TeamsLeaderboard';

// ==== Types ====
interface BattingStats {
  name: string;
  matches: number;
  innings: number;
  runs: number;
  average: number;
  strikeRate: number;
  fours: number;
  sixes: number;
  highScore: number;
}

interface BowlingStats {
  name: string;
  matches: number;
  wickets: number;
  bestBowling: number;
}

interface TeamStats {
  name: string;
  matches: number;
  wins: number;
  losses: number;
  winRate: number;
  totalRuns: number;
  averageScore: number;
  highestScore: number;
  totalWickets: number;
}

interface LeaderboardTabsProps {
  battingStats: BattingStats[];
  bowlingStats: BowlingStats[];
  teamStats: TeamStats[];
  totalMatches: number;
}

export default function LeaderboardTabs({
  battingStats,
  bowlingStats,
  teamStats,
  totalMatches,
}: LeaderboardTabsProps) {
  const [activeTab, setActiveTab] = useState<'batting' | 'bowling' | 'teams'>('batting');

  return (
    <div className="w-full">
      {/* ===== Summary Cards ===== */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-4 text-white">
          <div className="text-sm opacity-90">Total Matches</div>
          <div className="text-3xl font-bold">{totalMatches}</div>
        </div>

        <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-4 text-white">
          <div className="text-sm opacity-90">Total Players</div>
          <div className="text-3xl font-bold">
            {Math.max(battingStats.length, bowlingStats.length)}
          </div>
        </div>

        <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-4 text-white">
          <div className="text-sm opacity-90">Total Teams</div>
          <div className="text-3xl font-bold">{teamStats.length}</div>
        </div>
      </div>

      {/* ===== Tab Headers ===== */}
      <div className="flex gap-2 mb-6 border-b-2 border-gray-200">
        {['batting', 'bowling', 'teams'].map((tab) => {
          const colors =
            tab === 'batting'
              ? 'blue'
              : tab === 'bowling'
              ? 'green'
              : 'purple';

          return (
            <button
              key={tab}
              onClick={() => setActiveTab(tab as 'batting' | 'bowling' | 'teams')}
              className={`relative px-6 py-3 font-semibold transition-all duration-300 ${
                activeTab === tab
                  ? `text-${colors}-600`
                  : 'text-gray-500 hover:text-gray-700'
              }`}
            >
              <span className="flex items-center gap-2">
                {tab === 'batting' && 'üèè Batting Leaders'}
                {tab === 'bowling' && '‚ö° Bowling Leaders'}
                {tab === 'teams' && 'üèÜ Teams'}
              </span>
              {activeTab === tab && (
                <motion.div
                  layoutId="activeTab"
                  className={`absolute bottom-0 left-0 right-0 h-0.5 bg-${colors}-600`}
                  initial={false}
                  transition={{ type: 'spring', stiffness: 500, damping: 30 }}
                />
              )}
            </button>
          );
        })}
      </div>

      {/* ===== Tab Content ===== */}
      <AnimatePresence mode="wait">
        {activeTab === 'batting' && (
          <motion.div
            key="batting"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            transition={{ duration: 0.2 }}
          >
            <BattingLeaderboard stats={battingStats} />
          </motion.div>
        )}

        {activeTab === 'bowling' && (
          <motion.div
            key="bowling"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            transition={{ duration: 0.2 }}
          >
            <BowlingLeaderboard stats={bowlingStats} />
          </motion.div>
        )}

        {activeTab === 'teams' && (
          <motion.div
            key="teams"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            transition={{ duration: 0.2 }}
          >
            <TeamsLeaderboard stats={teamStats} />
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}

// ===== Batting Leaderboard =====
function BattingLeaderboard({ stats }: { stats: BattingStats[] }) {
  if (stats.length === 0)
    return (
      <div className="text-center py-12 text-gray-500">
        <div className="text-5xl mb-4">üèè</div>
        <p className="text-lg">No batting data available yet</p>
      </div>
    );

  return (
    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
      <div className="hidden md:block overflow-x-auto">
        <table className="w-full">
          <thead className="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
            <tr>
              <th className="px-6 py-4 text-left text-sm font-semibold">Rank</th>
              <th className="px-6 py-4 text-left text-sm font-semibold">Player</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Mat</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Runs</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Avg</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">SR</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">4s</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">6s</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">HS</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-200">
            {stats.map((player, index) => (
              <motion.tr
                key={player.name}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.05 }}
                className="hover:bg-blue-50 transition-colors duration-150"
              >
                <td className="px-6 py-4 text-center">{index + 1}</td>
                <td className="px-6 py-4 font-semibold">{player.name}</td>
                <td className="px-6 py-4 text-center">{player.matches}</td>
                <td className="px-6 py-4 text-center text-blue-600 font-bold">{player.runs}</td>
                <td className="px-6 py-4 text-center">{player.average}</td>
                <td className="px-6 py-4 text-center">{player.strikeRate}</td>
                <td className="px-6 py-4 text-center">{player.fours}</td>
                <td className="px-6 py-4 text-center">{player.sixes}</td>
                <td className="px-6 py-4 text-center">{player.highScore}</td>
              </motion.tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

// ===== Bowling Leaderboard =====
function BowlingLeaderboard({ stats }: { stats: BowlingStats[] }) {
  if (stats.length === 0)
    return (
      <div className="text-center py-12 text-gray-500">
        <div className="text-5xl mb-4">‚ö°</div>
        <p className="text-lg">No bowling data available yet</p>
      </div>
    );

  return (
    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
      <div className="hidden md:block overflow-x-auto">
        <table className="w-full">
          <thead className="bg-gradient-to-r from-green-600 to-green-700 text-white">
            <tr>
              <th className="px-6 py-4 text-left text-sm font-semibold">Rank</th>
              <th className="px-6 py-4 text-left text-sm font-semibold">Player</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Matches</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Wickets</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Best</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-200">
            {stats.map((player, index) => (
              <motion.tr
                key={player.name}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.05 }}
                className="hover:bg-green-50 transition-colors duration-150"
              >
                <td className="px-6 py-4 text-center">{index + 1}</td>
                <td className="px-6 py-4 font-semibold">{player.name}</td>
                <td className="px-6 py-4 text-center">{player.matches}</td>
                <td className="px-6 py-4 text-center text-green-600 font-bold">{player.wickets}</td>
                <td className="px-6 py-4 text-center">{player.bestBowling}</td>
              </motion.tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}


===== FILE: components/Leaderboard/TeamsLeaderboard.tsx =====
'use client';

import { motion } from 'framer-motion';

interface TeamStats {
  name: string;
  matches: number;
  wins: number;
  losses: number;
  winRate: number;
  totalRuns: number;
  averageScore: number;
  highestScore: number;
  totalWickets: number;
}

interface TeamsLeaderboardProps {
  stats: TeamStats[];
}

export default function TeamsLeaderboard({ stats }: TeamsLeaderboardProps) {
  if (stats.length === 0) {
    return (
      <div className="text-center py-12 text-gray-500">
        <div className="text-5xl mb-4">üèÜ</div>
        <p className="text-lg">No team data available yet</p>
      </div>
    );
  }

  return (
    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
      {/* Desktop Table */}
      <div className="hidden md:block overflow-x-auto">
        <table className="w-full">
          <thead className="bg-gradient-to-r from-purple-600 to-purple-700 text-white">
            <tr>
              <th className="px-6 py-4 text-left text-sm font-semibold">Rank</th>
              <th className="px-6 py-4 text-left text-sm font-semibold">Team</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Mat</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Wins</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Win %</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Avg Score</th>
              <th className="px-6 py-4 text-center text-sm font-semibold">Highest</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-200">
            {stats.map((team, index) => (
              <motion.tr
                key={team.name}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.05 }}
                className="hover:bg-purple-50 transition-colors duration-150"
              >
                <td className="px-6 py-4">
                  <div className={`flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm ${
                    index === 0 ? 'bg-gradient-to-br from-yellow-400 to-yellow-600 text-white shadow-lg' :
                    index === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400 text-white' :
                    index === 2 ? 'bg-gradient-to-br from-orange-400 to-orange-500 text-white' :
                    'bg-gray-100 text-gray-700'
                  }`}>
                    {index + 1}
                  </div>
                </td>
                <td className="px-6 py-4">
                  <div className="font-semibold text-gray-900">{team.name}</div>
                </td>
                <td className="px-6 py-4 text-center text-gray-700">{team.matches}</td>
                <td className="px-6 py-4 text-center">
                  <span className="font-bold text-purple-600 text-lg">{team.wins}</span>
                </td>
                <td className="px-6 py-4 text-center text-gray-700">{team.winRate}%</td>
                <td className="px-6 py-4 text-center text-gray-700">{team.averageScore}</td>
                <td className="px-6 py-4 text-center">
                  <span className="font-semibold text-gray-900">{team.highestScore}</span>
                </td>
              </motion.tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Mobile Cards */}
      <div className="md:hidden divide-y divide-gray-200">
        {stats.map((team, index) => (
          <motion.div
            key={team.name}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.05 }}
            className="p-4 hover:bg-purple-50 transition-colors"
          >
            <div className="flex items-center gap-3 mb-3">
              <div className={`flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm ${
                index === 0 ? 'bg-gradient-to-br from-yellow-400 to-yellow-600 text-white' :
                index === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400 text-white' :
                index === 2 ? 'bg-gradient-to-br from-orange-400 to-orange-500 text-white' :
                'bg-gray-100 text-gray-700'
              }`}>
                {index + 1}
              </div>
              <div>
                <div className="font-bold text-gray-900">{team.name}</div>
                <div className="text-sm text-gray-500">{team.matches} matches</div>
              </div>
            </div>
            <div className="grid grid-cols-3 gap-3">
              <div className="text-center">
                <div className="text-xs text-gray-500">Wins</div>
                <div className="font-bold text-purple-600">{team.wins}</div>
              </div>
              <div className="text-center">
                <div className="text-xs text-gray-500">Win Rate</div>
                <div className="font-semibold">{team.winRate}%</div>
              </div>
              <div className="text-center">
                <div className="text-xs text-gray-500">Avg Score</div>
                <div className="font-semibold">{team.averageScore}</div>
              </div>
            </div>
          </motion.div>
        ))}
      </div>
    </div>
  );
}

===== FILE: components/sections/AdminUserAccess.tsx =====
'use client'

import { Shield, Eye, Edit, Users, Lock, Smartphone } from 'lucide-react'
import ScrollAnimation from '@/components/animations/ScrollAnimation'
import { Card } from '@/components/ui/card'

export default function AdminUserAccess() {
  return (
    <section className="py-20 bg-white" id="access">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <ScrollAnimation>
          <div className="text-center max-w-3xl mx-auto mb-16">
            <h2 className="text-4xl sm:text-5xl font-bold text-gray-900 mb-4">
              Perfect for{' '}
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-accent-600">
                everyone
              </span>
            </h2>
            <p className="text-xl text-gray-600">
              Different access levels for scorers, players, and fans
            </p>
          </div>
        </ScrollAnimation>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
          {/* Admin Access */}
          <ScrollAnimation delay={0.1}>
            <Card className="p-8 h-full bg-gradient-to-br from-primary-50 to-white border-primary-200">
              <div className="flex items-center gap-4 mb-6">
                <div className="p-3 bg-primary-100 rounded-xl">
                  <Shield className="h-6 w-6 text-primary-600" />
                </div>
                <h3 className="text-2xl font-bold text-gray-900">Match Admin</h3>
              </div>
              
              <p className="text-gray-600 mb-8">
                Full control over match scoring and management
              </p>
              
              <div className="space-y-4">
                {[
                  { icon: <Edit className="h-5 w-5" />, text: 'Update scores ball-by-ball' },
                  { icon: <Users className="h-5 w-5" />, text: 'Manage teams and lineups' },
                  { icon: <Lock className="h-5 w-5" />, text: 'Control match settings' },
                  { icon: <Smartphone className="h-5 w-5" />, text: 'Mobile-friendly scoring' },
                ].map((feature, index) => (
                  <div key={index} className="flex items-center gap-3">
                    <div className="text-primary-600">{feature.icon}</div>
                    <span className="text-gray-700">{feature.text}</span>
                  </div>
                ))}
              </div>

              <div className="mt-8 p-4 bg-primary-100/50 rounded-xl">
                <p className="text-sm text-primary-700 font-medium">
                  Ideal for: Umpires, Scorers, Team Captains
                </p>
              </div>
            </Card>
          </ScrollAnimation>

          {/* User Access */}
          <ScrollAnimation delay={0.2}>
            <Card className="p-8 h-full bg-gradient-to-br from-accent-50 to-white border-accent-200">
              <div className="flex items-center gap-4 mb-6">
                <div className="p-3 bg-accent-100 rounded-xl">
                  <Eye className="h-6 w-6 text-accent-600" />
                </div>
                <h3 className="text-2xl font-bold text-gray-900">Viewer Access</h3>
              </div>
              
              <p className="text-gray-600 mb-8">
                Follow matches and view live scores in real-time
              </p>
              
              <div className="space-y-4">
                {[
                  { icon: <Eye className="h-5 w-5" />, text: 'View live scores' },
                  { icon: <Users className="h-5 w-5" />, text: 'See player statistics' },
                  { icon: <Smartphone className="h-5 w-5" />, text: 'Access from any device' },
                  { icon: <Shield className="h-5 w-5" />, text: 'Join with match code' },
                ].map((feature, index) => (
                  <div key={index} className="flex items-center gap-3">
                    <div className="text-accent-600">{feature.icon}</div>
                    <span className="text-gray-700">{feature.text}</span>
                  </div>
                ))}
              </div>

              <div className="mt-8 p-4 bg-accent-100/50 rounded-xl">
                <p className="text-sm text-accent-700 font-medium">
                  Ideal for: Players, Fans, Parents, Coaches
                </p>
              </div>
            </Card>
          </ScrollAnimation>
        </div>
      </div>
    </section>
  )
}

===== FILE: components/sections/CallToAction.tsx =====
'use client'

import { Button } from '@/components/ui/button'
import { ArrowRight, Sparkles } from 'lucide-react'
import ScrollAnimation from '@/components/animations/ScrollAnimation'
import { motion } from 'framer-motion'
import { useRouter } from 'next/navigation'

export default function CallToAction() {
  const router = useRouter()

  const handleCreateScorecard = () => {
    // Check if user is authenticated
    const token = localStorage.getItem('auth_token')
    if (token) {
      router.push('/matches/create')
    } else {
      router.push('/register')
    }
  }
  return (
    <section className="py-20 bg-gradient-to-br from-primary-50 via-white to-accent-50 relative overflow-hidden">
      {/* Background decorations */}
      <motion.div
        className="absolute top-10 right-10 w-32 h-32 bg-primary-200 rounded-full blur-3xl opacity-30"
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />
      <motion.div
        className="absolute bottom-10 left-10 w-40 h-40 bg-accent-200 rounded-full blur-3xl opacity-30"
        animate={{
          scale: [1, 1.3, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{
          duration: 5,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />

      <div className="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <ScrollAnimation>
          <div className="max-w-4xl mx-auto text-center">
            <div className="inline-flex items-center gap-2 bg-primary-100 text-primary-700 px-4 py-2 rounded-full text-sm font-medium mb-8">
              <Sparkles className="h-4 w-4" />
              <span>Free to start ‚Ä¢ No credit card required</span>
            </div>
            
            <h2 className="text-4xl sm:text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
              Start your first match{' '}
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-accent-600">
                today
              </span>
            </h2>
            
            <p className="text-xl text-gray-600 mb-10 max-w-2xl mx-auto">
              Join thousands of local cricket teams already using our platform. 
              Set up your first match in under a minute.
            </p>

            <motion.div
              initial={{ scale: 0.95 }}
              whileHover={{ scale: 1.02 }}
              transition={{ type: "spring", stiffness: 300 }}
            >
              <Button size="lg" className="group shadow-xl" onClick={handleCreateScorecard}>
                Create a Scorecard
                <ArrowRight className="ml-2 h-5 w-5 transition-transform group-hover:translate-x-1" />
              </Button>
            </motion.div>

            <p className="mt-6 text-sm text-gray-500">
              Trusted by 500+ local cricket clubs worldwide
            </p>
          </div>
        </ScrollAnimation>
      </div>
    </section>
  )
}

===== FILE: components/sections/Features.tsx =====
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Trophy, Users, BarChart3, Share2, Shield, Zap } from 'lucide-react'
import ScrollAnimation from '@/components/animations/ScrollAnimation'

interface Feature {
  icon: React.ReactNode
  title: string
  description: string
  gradient: string
}

const features: Feature[] = [
  {
    icon: <Trophy className="h-6 w-6" />,
    title: 'Create Custom Matches',
    description: 'Set up matches with custom rules, overs, and team configurations in seconds.',
    gradient: 'from-yellow-400 to-orange-400',
  },
  {
    icon: <Zap className="h-6 w-6" />,
    title: 'Live Score Updates',
    description: 'Real-time scoring with ball-by-ball updates visible to all viewers instantly.',
    gradient: 'from-blue-400 to-cyan-400',
  },
  {
    icon: <BarChart3 className="h-6 w-6" />,
    title: 'Player Stats & Highlights',
    description: 'Track individual performances, milestones, and match highlights automatically.',
    gradient: 'from-purple-400 to-pink-400',
  },
  {
    icon: <Share2 className="h-6 w-6" />,
    title: 'Private Match Codes',
    description: 'Share unique match codes with players and fans for exclusive access.',
    gradient: 'from-green-400 to-emerald-400',
  },
  {
    icon: <Users className="h-6 w-6" />,
    title: 'Team Management',
    description: 'Manage squads, lineups, and player availability with ease.',
    gradient: 'from-indigo-400 to-blue-400',
  },
  {
    icon: <Shield className="h-6 w-6" />,
    title: 'Secure & Private',
    description: 'Your match data is secure with role-based access control.',
    gradient: 'from-red-400 to-rose-400',
  },
]

export default function Features() {
  return (
    <section className="py-20 bg-gradient-to-b from-white to-gray-50" id="features">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <ScrollAnimation>
          <div className="text-center max-w-3xl mx-auto mb-16">
            <h2 className="text-4xl sm:text-5xl font-bold text-gray-900 mb-4">
              Everything you need for{' '}
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-accent-600">
                local cricket
              </span>
            </h2>
            <p className="text-xl text-gray-600">
              Professional features designed for grassroots cricket. Simple enough for anyone, 
              powerful enough for serious leagues.
            </p>
          </div>
        </ScrollAnimation>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {features.map((feature, index) => (
            <ScrollAnimation key={index} delay={index * 0.1}>
              <Card className="group hover:scale-105 transition-transform duration-300 h-full">
                <CardHeader>
                  <div className={`inline-flex p-3 rounded-xl bg-gradient-to-r ${feature.gradient} text-white mb-4 group-hover:scale-110 transition-transform`}>
                    {feature.icon}
                  </div>
                  <CardTitle className="text-xl">{feature.title}</CardTitle>
                </CardHeader>
                <CardContent>
                  <CardDescription className="text-base">
                    {feature.description}
                  </CardDescription>
                </CardContent>
              </Card>
            </ScrollAnimation>
          ))}
        </div>
      </div>
    </section>
  )
}

===== FILE: components/sections/Footer.tsx =====
import { Heart } from 'lucide-react'

export default function Footer() {
  const currentYear = new Date().getFullYear()

  return (
    <footer className="bg-gray-50 border-t border-gray-200">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div className="flex flex-col items-center space-y-6">
          {/* Logo */}
          <div className="text-2xl font-bold text-gray-900">
            Local League <span className="text-primary-600">Cricket</span>
          </div>

          {/* Links */}
          <nav className="flex flex-wrap justify-center gap-8">
            <a 
              href="#about" 
              className="text-gray-600 hover:text-primary-600 transition-colors"
              aria-label="About"
            >
              About
            </a>
            <a 
              href="#contact" 
              className="text-gray-600 hover:text-primary-600 transition-colors"
              aria-label="Contact"
            >
              Contact
            </a>
            <a 
              href="#privacy" 
              className="text-gray-600 hover:text-primary-600 transition-colors"
              aria-label="Privacy Policy"
            >
              Privacy Policy
            </a>
            <a 
              href="#terms" 
              className="text-gray-600 hover:text-primary-600 transition-colors"
              aria-label="Terms of Service"
            >
              Terms
            </a>
          </nav>

          {/* Copyright */}
          <div className="text-center text-sm text-gray-500">
            <p className="flex items-center gap-1">
              Made with <Heart className="h-4 w-4 text-red-500 fill-current" /> for local cricket
            </p>
            <p className="mt-2">
              ¬© {currentYear} Local League Cricket Scoreboard. All rights reserved.
            </p>
          </div>
        </div>
      </div>
    </footer>
  )
}

===== FILE: components/sections/Hero.tsx =====
'use client'

import { Button } from '@/components/ui/button'
import { ArrowRight,  Play } from 'lucide-react'
import { motion } from 'framer-motion'
import Link from 'next/link'

export default function Hero() {
  return (
    <section className="relative min-h-screen flex items-center justify-center overflow-hidden bg-gradient-to-br from-primary-50 via-white to-accent-50">
      {/* Background Pattern */}
      <div className="absolute inset-0 bg-grid-pattern opacity-5"></div>

      {/* Floating elements */}
      <motion.div
        className="absolute top-20 left-10 w-20 h-20 bg-primary-200 rounded-full blur-2xl"
        animate={{
          y: [0, 30, 0],
          scale: [1, 1.1, 1],
        }}
        transition={{
          duration: 4,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />
      <motion.div
        className="absolute bottom-20 right-10 w-32 h-32 bg-accent-200 rounded-full blur-3xl"
        animate={{
          y: [0, -30, 0],
          scale: [1, 1.2, 1],
        }}
        transition={{
          duration: 5,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />

      <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-20 relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
          className="text-center max-w-4xl mx-auto"
        >
          {/* Badge */}
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.1 }}
            className="inline-flex items-center gap-2 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-medium text-primary-700 border border-primary-200 shadow-sm mb-8"
          >
            <span className="relative flex h-2 w-2">
              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary-400 opacity-75"></span>
              <span className="relative inline-flex rounded-full h-2 w-2 bg-primary-500"></span>
            </span>
            Live matches happening now
          </motion.div>

          {/* Headline */}
          <motion.h1
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="text-5xl sm:text-6xl lg:text-7xl font-bold text-gray-900 mb-6"
          >
            Bring Local Cricket{' '}
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-accent-600">
              Online
            </span>
          </motion.h1>

          {/* Subtext */}
          <motion.p
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
            className="text-xl text-gray-600 mb-10 max-w-2xl mx-auto leading-relaxed"
          >
            Create, manage, and share live scorecards for your local leagues and friendly matches.
            Professional scoring made simple.
          </motion.p>

          {/* CTA Buttons */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4 }}
            className="flex flex-col sm:flex-row gap-4 justify-center items-center"
          >
            <Link href="/register">
              <Button size="lg" className="group">
                Get Started
                <ArrowRight className="ml-2 h-4 w-4 transition-transform group-hover:translate-x-1" />
              </Button>
            </Link>
            <Link href="/login">
              <Button variant="secondary" size="lg" className="group">
                <Play className="mr-2 h-4 w-4" />
                Sign In
              </Button>
            </Link>
          </motion.div>

          {/* Stats */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.6 }}
            className="mt-16 grid grid-cols-2 md:grid-cols-4 gap-8"
          >
            {[
              { label: 'Active Matches', value: '2,456' },
              { label: 'Teams', value: '500+' },
              { label: 'Players', value: '10K+' },
              { label: 'Live Viewers', value: '15K' },
            ].map((stat, index) => (
              <div key={index} className="text-center">
                <div className="text-3xl font-bold text-gray-900">{stat.value}</div>
                <div className="text-sm text-gray-600 mt-1">{stat.label}</div>
              </div>
            ))}
          </motion.div>
        </motion.div>

        {/* Scoreboard Mockup */}
        <motion.div
          initial={{ opacity: 0, y: 40 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.8, duration: 0.8 }}
          className="mt-20 max-w-5xl mx-auto"
        >
          <div className="relative rounded-2xl bg-white/80 backdrop-blur-sm border border-gray-200 shadow-2xl p-8">
            <div className="absolute inset-0 bg-gradient-to-br from-primary-100/20 to-accent-100/20 rounded-2xl"></div>
            <div className="relative">
              {/* Mock scoreboard UI */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="font-semibold text-lg">Local Tigers</span>
                    <span className="text-3xl font-bold text-primary-600">156/4</span>
                  </div>
                  <div className="text-sm text-gray-600">Overs: 18.3</div>
                  <div className="flex gap-2">
                    <span className="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm">Batting</span>
                  </div>
                </div>
                <div className="space-y-4">
                  <div className="flex items-center justify-between">
                    <span className="font-semibold text-lg">Village Warriors</span>
                    <span className="text-3xl font-bold text-gray-400">Yet to bat</span>
                  </div>
                  <div className="text-sm text-gray-600">Overs: 0.0</div>
                  <div className="flex gap-2">
                    <span className="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-sm">Bowling</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </motion.div>
      </div>
    </section>
  )
}

===== FILE: components/sections/HowItWorks.tsx =====
'use client'

import { PlusCircle, Edit3, Share } from 'lucide-react'
import ScrollAnimation from '@/components/animations/ScrollAnimation'

const steps = [
  {
    number: '01',
    title: 'Create',
    description: 'Set up your match with teams, players, and match format',
    icon: <PlusCircle className="h-8 w-8" />,
    color: 'from-blue-500 to-cyan-500',
  },
  {
    number: '02',
    title: 'Score',
    description: 'Update scores ball-by-ball with our intuitive scoring interface',
    icon: <Edit3 className="h-8 w-8" />,
    color: 'from-purple-500 to-pink-500',
  },
  {
    number: '03',
    title: 'Share',
    description: 'Share live match links with players, fans, and followers',
    icon: <Share className="h-8 w-8" />,
    color: 'from-orange-500 to-red-500',
  },
]

export default function HowItWorks() {
  return (
    <section className="py-20 bg-white" id="how-it-works">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <ScrollAnimation>
          <div className="text-center max-w-3xl mx-auto mb-16">
            <h2 className="text-4xl sm:text-5xl font-bold text-gray-900 mb-4">
              Get started in{' '}
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-accent-600">
                three simple steps
              </span>
            </h2>
            <p className="text-xl text-gray-600">
              From setup to live scoring in under a minute
            </p>
          </div>
        </ScrollAnimation>

        <div className="relative">
          {/* Connection Line - Hidden on mobile */}
          <div className="hidden lg:block absolute top-1/2 left-0 right-0 h-0.5 bg-gradient-to-r from-blue-200 via-purple-200 to-orange-200 -translate-y-1/2"></div>
          
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">
            {steps.map((step, index) => (
              <ScrollAnimation key={index} delay={index * 0.2}>
                <div className="relative">
                  <div className="bg-white rounded-2xl p-8 shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-100">
                    {/* Step Number */}
                    <div className="absolute -top-4 -right-4 bg-white rounded-full p-2 shadow-md">
                      <div className={`bg-gradient-to-r ${step.color} text-white text-sm font-bold rounded-full w-8 h-8 flex items-center justify-center`}>
                        {index + 1}
                      </div>
                    </div>
                    
                    {/* Icon */}
                    <div className={`inline-flex p-4 rounded-2xl bg-gradient-to-r ${step.color} text-white mb-6`}>
                      {step.icon}
                    </div>
                    
                    {/* Content */}
                    <h3 className="text-2xl font-bold text-gray-900 mb-3">{step.title}</h3>
                    <p className="text-gray-600 leading-relaxed">{step.description}</p>
                  </div>
                </div>
              </ScrollAnimation>
            ))}
          </div>
        </div>
      </div>
    </section>
  )
}

===== FILE: components/sections/LiveMatchPreview.tsx =====
'use client'

import { useState } from 'react'
import { motion } from 'framer-motion'
import ScrollAnimation from '@/components/animations/ScrollAnimation'
import { Clock, Users, TrendingUp } from 'lucide-react'

export default function LiveMatchPreview() {
  const [activeTeam, setActiveTeam] = useState('Australia')

  const teams = {
    Australia: {
      batting: [
        { name: 'Travis Head', runs: 47, balls: 30, fours: 5, sixes: 2, strikeRate: 156.7, status: 'c Alex Carey b Josh Hazlewood' },
        { name: 'David Warner', runs: 29, balls: 17, fours: 3, sixes: 1, strikeRate: 170.6, status: 'c Alex Carey b Josh Hazlewood' },
        { name: 'Mitchell Marsh', runs: 75, balls: 49, fours: 6, sixes: 4, strikeRate: 153.0, status: 'c Alex Carey b Josh Hazlewood' },
        { name: 'Glenn Maxwell', runs: 15, balls: 11, fours: 1, sixes: 1, strikeRate: 136.3, status: 'c Alex Carey b Josh Hazlewood' },
        { name: 'Josh Inglis', runs: 9, balls: 13, fours: 0, sixes: 0, strikeRate: 69.2, status: 'not out' },
        { name: 'Matthew Wade', runs: 14, balls: 9, fours: 2, sixes: 0, strikeRate: 155.5, status: 'not out' },
      ],
      bowling: [
        { name: 'Mitchell Starc', overs: 5.0, maidens: 0, runs: 31, wickets: 0, economy: 6.2 },
        { name: 'Josh Hazlewood', overs: 6.0, maidens: 1, runs: 23, wickets: 1, economy: 3.83 },
        { name: 'Nathan Ellis', overs: 7.3, maidens: 0, runs: 60, wickets: 0, economy: 8.0 },
        { name: 'Adam Zampa', overs: 10.0, maidens: 0, runs: 50, wickets: 0, economy: 5.0 },
      ],
    },
    India: {
      batting: [
        { name: 'Rohit Sharma', runs: 61, balls: 43, fours: 7, sixes: 2, strikeRate: 141.8, status: 'b Adam Zampa' },
        { name: 'Shubman Gill', runs: 35, balls: 27, fours: 4, sixes: 1, strikeRate: 129.6, status: 'c Glenn Maxwell b Josh Hazlewood' },
        { name: 'Virat Kohli', runs: 48, balls: 38, fours: 5, sixes: 0, strikeRate: 126.3, status: 'b Nathan Ellis' },
        { name: 'Suryakumar Yadav', runs: 24, balls: 15, fours: 2, sixes: 1, strikeRate: 160.0, status: 'c Josh Inglis b Starc' },
        { name: 'Hardik Pandya', runs: 10, balls: 9, fours: 1, sixes: 0, strikeRate: 111.1, status: 'not out' },
        { name: 'Ravindra Jadeja', runs: 7, balls: 8, fours: 0, sixes: 0, strikeRate: 87.5, status: 'not out' },
      ],
      bowling: [
        { name: 'Mohammed Siraj', overs: 5.0, maidens: 0, runs: 36, wickets: 1, economy: 7.2 },
        { name: 'Jasprit Bumrah', overs: 6.0, maidens: 1, runs: 21, wickets: 2, economy: 3.5 },
        { name: 'Kuldeep Yadav', overs: 10.0, maidens: 0, runs: 47, wickets: 1, economy: 4.7 },
        { name: 'Axar Patel', overs: 8.0, maidens: 0, runs: 49, wickets: 0, economy: 6.1 },
      ],
    },
  }

  
    const opponentTeam = activeTeam === 'Australia' ? 'India' : 'Australia'
  const { batting, yetToBat, bowling } = teams[activeTeam]
  const opponentBowling = teams[opponentTeam].bowling

  const hasBatted = batting && batting.length > 0
  const hasBowled = opponentBowling && opponentBowling.length > 0

  return (
    <section className="py-20 bg-gradient-to-b from-gray-50 to-white overflow-hidden" id="preview">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        {/* Section Header */}
        <ScrollAnimation>
          <div className="text-center max-w-3xl mx-auto mb-16">
            <h2 className="text-4xl sm:text-5xl font-bold text-gray-900 mb-4">
              See it in{' '}
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-accent-600">
                action
              </span>
            </h2>
            <p className="text-xl text-gray-600">
              Experience the live scoreboard interface that thousands of local teams love
            </p>
          </div>
        </ScrollAnimation>

        {/* Live Scorecard Preview */}
        <ScrollAnimation delay={0.2}>
          <div className="relative max-w-6xl mx-auto">
            <div className="absolute inset-0 bg-gradient-to-r from-primary-200/30 via-accent-200/30 to-primary-200/30 blur-3xl"></div>
            <motion.div
              initial={{ scale: 0.95 }}
              whileInView={{ scale: 1 }}
              transition={{ duration: 0.5 }}
              className="relative bg-white rounded-3xl shadow-2xl border border-gray-200 overflow-hidden"
            >
              {/* Header */}
              <div className="bg-gradient-to-r from-primary-600 to-accent-600 text-white p-6">
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                  <div>
                    <h3 className="text-2xl font-bold mb-1">Summer League Final</h3>
                    <p className="text-primary-100">Match 42 ‚Ä¢ Green Park Stadium</p>
                  </div>
                  <div className="flex items-center gap-4">
                    <div className="flex items-center gap-2">
                      <Clock className="h-4 w-4" />
                      <span className="text-sm">LIVE</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <Users className="h-4 w-4" />
                      <span className="text-sm">2.3K watching</span>
                    </div>
                  </div>
                </div>
              </div>

              {/* Teams and Scores */}
              <div className="p-8">
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                  <div className="space-y-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <h4 className="text-xl font-semibold text-gray-900">Riverside Rangers</h4>
                        <p className="text-sm text-gray-600">Innings 1 of 1</p>
                      </div>
                      <div className="text-right">
                        <div className="text-4xl font-bold text-primary-600">248/7</div>
                        <div className="text-sm text-gray-600">20 overs</div>
                      </div>
                    </div>
                    <div className="bg-gray-50 rounded-xl p-4">
                      <p className="text-xs text-gray-600 uppercase tracking-wider mb-3">Batting</p>
                      <div className="space-y-2">
                        <div className="flex justify-between items-center">
                          <span className="font-medium">S. Kumar*</span>
                          <span className="text-sm text-gray-600">45 (32)</span>
                        </div>
                        <div className="flex justify-between items-center">
                          <span className="font-medium">R. Patel</span>
                          <span className="text-sm text-gray-600">28 (19)</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <h4 className="text-xl font-semibold text-gray-900">Valley Vikings</h4>
                        <p className="text-sm text-gray-600">Innings 1 of 1</p>
                      </div>
                      <div className="text-right">
                        <div className="text-4xl font-bold text-gray-900">186/5</div>
                        <div className="text-sm text-gray-600">16.4 overs</div>
                      </div>
                    </div>
                    <div className="bg-gray-50 rounded-xl p-4">
                      <p className="text-xs text-gray-600 uppercase tracking-wider mb-3">Bowling</p>
                      <div className="space-y-2">
                        <div className="flex justify-between items-center">
                          <span className="font-medium">M. Johnson</span>
                          <span className="text-sm text-gray-600">3-0-28-2</span>
                        </div>
                        <div className="flex justify-between items-center">
                          <span className="text-sm text-gray-600">Economy</span>
                          <span className="text-sm font-medium">9.33</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Match Status */}
                <div className="mt-8 p-4 bg-gradient-to-r from-primary-50 to-accent-50 rounded-xl">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <TrendingUp className="h-5 w-5 text-primary-600" />
                      <span className="text-sm font-medium text-gray-900">
                        Valley Vikings need 63 runs in 20 balls
                      </span>
                    </div>
                    <span className="text-sm text-gray-600">RRR: 18.90</span>
                  </div>
                </div>

                {/* Recent Balls */}
                <div className="mt-6">
                  <p className="text-xs text-gray-600 uppercase tracking-wider mb-3">This Over</p>
                  <div className="flex gap-2">
                    {['1', '4', 'W', '2', '0', '6'].map((ball, index) => (
                      <div
                        key={index}
                        className={`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${
                          ball === 'W'
                            ? 'bg-red-100 text-red-600'
                            : ball === '4'
                            ? 'bg-blue-100 text-blue-600'
                            : ball === '6'
                            ? 'bg-green-100 text-green-600'
                            : 'bg-gray-100 text-gray-700'
                        }`}
                      >
                        {ball}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </motion.div>
          </div>
        </ScrollAnimation>

        {/* Detailed Scorecard Tabs */}
        <ScrollAnimation delay={0.4}>
          <motion.div
            initial={{ opacity: 0, y: 40 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="max-w-6xl mx-auto mt-16 bg-white rounded-3xl shadow-xl border border-gray-200 p-8"
          >
             {/* Tabs */}
            <div className="flex justify-center mb-8">
              <div className="bg-gray-100 rounded-lg p-1 flex space-x-1 max-w-xs w-full mx-4">
                {['Australia', 'India'].map((team) => (
                  <button
                    key={team}
                    onClick={() => setActiveTeam(team)}
                    className={`w-1/2 py-2 text-sm font-medium rounded-md transition-colors ${
                      activeTeam === team
                        ? 'bg-primary-600 text-white shadow-sm'
                        : 'bg-white text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    {team}
                  </button>
                ))}
              </div>
            </div>

            {/* Batting Section */}
            {hasBatted ? (
              <>
                <div className="overflow-x-auto mb-8">
                  <table className="w-full text-sm border-collapse">
                    <thead>
                      <tr className="bg-gray-50 text-gray-700 border-b">
                        <th className="text-left px-4 py-2">Batting</th>
                        <th className="text-left px-4 py-2">Status</th>
                        <th className="text-center px-4 py-2">R</th>
                        <th className="text-center px-4 py-2">B</th>
                        <th className="text-center px-4 py-2">4s</th>
                        <th className="text-center px-4 py-2">6s</th>
                        <th className="text-center px-4 py-2">SR</th>
                      </tr>
                    </thead>
                    <tbody>
                      {batting.map((b) => (
                        <tr key={b.name} className="border-b hover:bg-gray-50 transition">
                          <td className="py-3 px-4 font-medium text-gray-800">{b.name}</td>
                          <td className="py-3 px-4 text-gray-600">{b.status}</td>
                          <td className="py-3 text-center">{b.runs}</td>
                          <td className="py-3 text-center">{b.balls}</td>
                          <td className="py-3 text-center">{b.fours}</td>
                          <td className="py-3 text-center">{b.sixes}</td>
                          <td className="py-3 text-center">{b.strikeRate.toFixed(1)}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>

                {/* Yet to Bat Section */}
                {yetToBat && yetToBat.length > 0 && (
                  <div className="mb-12 bg-gray-50 rounded-xl p-4">
                    <p className="text-xs text-gray-600 uppercase tracking-wider mb-2">Yet to Bat</p>
                    <div className="flex flex-wrap gap-3 text-sm text-gray-800">
                      {yetToBat.slice(0, 4).map((player) => (
                        <span
                          key={player}
                          className="px-3 py-1 bg-white border border-gray-200 rounded-lg shadow-sm"
                        >
                          {player}
                        </span>
                      ))}
                    </div>
                  </div>
                )}
              </>
            ) : (
              <div className="mb-8 text-center text-gray-600">No batting data yet.</div>
            )}

            {/* Bowling Section */}
            {hasBowled ? (
              <div className="overflow-x-auto">
                <table className="w-full text-sm border-collapse">
                  <thead>
                    <tr className="bg-gray-50 text-gray-700 border-b">
                      <th className="text-left px-4 py-2">Bowling</th>
                      <th className="text-center px-4 py-2">O</th>
                      <th className="text-center px-4 py-2">M</th>
                      <th className="text-center px-4 py-2">R</th>
                      <th className="text-center px-4 py-2">W</th>
                      <th className="text-center px-4 py-2">Econ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {opponentBowling.map((p) => (
                      <tr key={p.name} className="border-b hover:bg-gray-50 transition">
                        <td className="py-3 px-4 font-medium text-gray-800">{p.name}</td>
                        <td className="py-3 text-center">{p.overs}</td>
                        <td className="py-3 text-center">{p.maidens}</td>
                        <td className="py-3 text-center">{p.runs}</td>
                        <td className="py-3 text-center">{p.wickets}</td>
                        <td className="py-3 text-center">{p.economy.toFixed(2)}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            ) : (
              <div className="text-center text-gray-600">No bowling data yet.</div>
            )}
          </motion.div>
        </ScrollAnimation>
      </div>
    </section>
  )
}


===== FILE: components/sections/ScoreCard.tsx =====
'use client'

import { useState } from 'react'
import { motion } from 'framer-motion'
import { Clock, Users, TrendingUp } from 'lucide-react'

interface Player {
  name: string
  runs_scored?: number
  balls_played?: number
  fours?: number
  sixes?: number
  wickets?: number
  balls_bowled?: number
  dots?: number
  runs_conceded?: number
  maidens?: number
  is_captain?: boolean
  is_keeper?: boolean
  is_out?: boolean
  dismissal?: string
  strike_rate?: number
  economy?: number
}

interface Team {
  name: string
  players: Player[]
  total_score?: number
  total_wickets?: number
  total_balls?: number
  extras?: number
}

interface ScoreCardProps {
  match?: {
    _id?: string
    matchCode?: string
    status?: string
    venue?: string
    overs?: number
    startTime?: string
    teamOne?: Team
    teamTwo?: Team
    currentInnings?: number
    batting_team?: string
    bowling_team?: string
    target?: number
    toss_winner?: string
    toss_decision?: string
  }
  isLive?: boolean
  viewersCount?: number
}

export default function ScoreCard({ match, isLive = false, viewersCount = 2300 }: ScoreCardProps) {
  const [activeTeam, setActiveTeam] = useState<'teamOne' | 'teamTwo'>('teamOne')
  console.log(match)

  // Default static data for preview/demo
  const defaultTeams = {
    teamOne: {
      name: 'Riverside Rangers',
      displayName: 'Riverside Rangers',
      batting: [
        { name: 'S. Kumar', runs: 45, balls: 32, fours: 5, sixes: 2, strikeRate: 140.6, status: 'not out', current: true },
        { name: 'R. Patel', runs: 28, balls: 19, fours: 3, sixes: 1, strikeRate: 147.4, status: 'not out', current: true },
        { name: 'A. Singh', runs: 67, balls: 45, fours: 8, sixes: 3, strikeRate: 148.9, status: 'c Johnson b Williams' },
        { name: 'V. Sharma', runs: 42, balls: 28, fours: 4, sixes: 2, strikeRate: 150.0, status: 'b Anderson' },
        { name: 'K. Reddy', runs: 35, balls: 21, fours: 3, sixes: 2, strikeRate: 166.7, status: 'run out' },
        { name: 'M. Khan', runs: 18, balls: 12, fours: 2, sixes: 0, strikeRate: 150.0, status: 'c Smith b Johnson' },
        { name: 'P. Das', runs: 8, balls: 6, fours: 1, sixes: 0, strikeRate: 133.3, status: 'lbw b Williams' },
      ],
      yetToBat: ['D. Gupta', 'S. Ahmed', 'R. Singh', 'T. Patel'],
      bowling: [
        { name: 'M. Johnson', overs: 4.0, maidens: 0, runs: 42, wickets: 2, economy: 10.5 },
        { name: 'J. Anderson', overs: 4.0, maidens: 0, runs: 38, wickets: 1, economy: 9.5 },
        { name: 'K. Williams', overs: 4.0, maidens: 0, runs: 45, wickets: 2, economy: 11.25 },
        { name: 'S. Smith', overs: 3.4, maidens: 0, runs: 35, wickets: 0, economy: 9.54 },
      ],
      totalScore: 248,
      totalWickets: 7,
      totalOvers: '20'
    },
    teamTwo: {
      name: 'Valley Vikings',
      displayName: 'Valley Vikings',
      batting: [
        { name: 'M. Johnson', runs: 32, balls: 24, fours: 4, sixes: 1, strikeRate: 133.3, status: 'c Kumar b Khan' },
        { name: 'J. Anderson', runs: 28, balls: 20, fours: 3, sixes: 1, strikeRate: 140.0, status: 'b Singh' },
        { name: 'K. Williams', runs: 45, balls: 30, fours: 5, sixes: 2, strikeRate: 150.0, status: 'not out' },
        { name: 'S. Smith', runs: 38, balls: 26, fours: 4, sixes: 1, strikeRate: 146.2, status: 'c Patel b Sharma' },
        { name: 'D. Brown', runs: 22, balls: 15, fours: 2, sixes: 1, strikeRate: 146.7, status: 'run out' },
        { name: 'T. Wilson', runs: 15, balls: 10, fours: 1, sixes: 1, strikeRate: 150.0, status: 'not out' },
      ],
      yetToBat: ['L. Taylor', 'R. Clark', 'P. White', 'N. Davis', 'B. Harris'],
      bowling: [
        { name: 'A. Singh', overs: 4.0, maidens: 0, runs: 46, wickets: 1, economy: 11.5 },
        { name: 'V. Sharma', overs: 4.0, maidens: 0, runs: 42, wickets: 1, economy: 10.5 },
        { name: 'M. Khan', overs: 4.0, maidens: 1, runs: 38, wickets: 1, economy: 9.5 },
        { name: 'P. Das', overs: 4.0, maidens: 0, runs: 48, wickets: 0, economy: 12.0 },
      ],
      totalScore: 186,
      totalWickets: 5,
      totalOvers: '16.4'
    }
  }

  // Use real match data if provided, otherwise use default data
  const hasRealData = match && match.teamOne && match.teamTwo
  
  // Transform real match data to display format
  const getTeamData = (team: Team | undefined, teamName: string) => {
    if (!team) return defaultTeams[activeTeam === 'teamOne' ? 'teamOne' : 'teamTwo']
    
    const batting = team.players.map(player => ({
      name: player.name + (player.is_captain ? ' (C)' : '') + (player.is_keeper ? ' (WK)' : ''),
      runs: player.runs_scored || 0,
      balls: player.balls_played || 0,
      fours: player.fours || 0,
      sixes: player.sixes || 0,
      strikeRate: player.balls_played ? ((player.runs_scored || 0) / player.balls_played * 100) : 0,
      status: player.dismissal || (player.is_out ? 'out' : player.balls_played && player.balls_played > 0 ? 'not out' : 'yet to bat')
    }))

    const bowling = team.players
      .filter(p => p.balls_bowled && p.balls_bowled > 0)
      .map(player => ({
        name: player.name,
        overs: player.balls_bowled ? `${Math.floor(player.balls_bowled / 6)}.${player.balls_bowled % 6}` : '0.0',
        maidens: player.maidens || 0,
        runs: player.runs_conceded || 0,
        wickets: player.wickets || 0,
        economy: player.balls_bowled ? (player.runs_conceded || 0) / player.balls_bowled : 0
      }))

    const yetToBat = team.players
      .filter(p => !p.balls_played || p.balls_played === 0)
      .map(p => p.name)

    return {
      name: team.name,
      displayName: team.name,
      batting: batting.filter(p => p.balls > 0 || p.status === 'not out'),
      yetToBat,
      bowling,
      totalScore: team.total_score || 0,
      totalWickets: team.total_wickets || 0,
      totalOvers: team.total_balls ? `${Math.floor(team.total_balls / 6)}.${team.total_balls % 6}` : '0.0'
    }
  }

  // Get display data
  const team1Data = hasRealData ? getTeamData(match.teamOne, 'teamOne') : defaultTeams.teamOne
  const team2Data = hasRealData ? getTeamData(match.teamTwo, 'teamTwo') : defaultTeams.teamTwo
  const activeTeamData = activeTeam === 'teamOne' ? team1Data : team2Data
  const opponentTeamData = activeTeam === 'teamOne' ? team2Data : team1Data

  // Calculate match status
  const getMatchStatus = () => {
    if (!hasRealData) {
      return "Valley Vikings need 63 runs in 20 balls"
    }
    
    if (match.status === 'live' && match.currentInnings === 2 && match.target) {
      const battingTeam = match.batting_team === match.teamOne?.name ? match.teamOne : match.teamTwo
      const runsNeeded = match.target - (battingTeam?.total_score || 0)
      const ballsRemaining = (match.overs! * 6) - (battingTeam?.total_balls || 0)
      
      if (runsNeeded > 0 && ballsRemaining > 0) {
        return `${match.batting_team} need ${runsNeeded} runs in ${ballsRemaining} balls`
      }
    }
    
    return null
  }

  const getRequiredRunRate = () => {
    if (!hasRealData) return '18.90'
    
    if (match.status === 'live' && match.currentInnings === 2 && match.target) {
      const battingTeam = match.batting_team === match.teamOne?.name ? match.teamOne : match.teamTwo
      const runsNeeded = match.target - (battingTeam?.total_score || 0)
      const ballsRemaining = (match.overs! * 6) - (battingTeam?.total_balls || 0)
      
      if (ballsRemaining > 0 && runsNeeded > 0) {
        return ((runsNeeded * 6) / ballsRemaining).toFixed(2)
      }
    }
    
    return '0.00'
  }

  const matchStatus = getMatchStatus()
  const rrr = getRequiredRunRate()

  // Current batsmen (for live display)
  const currentBatsmen = activeTeamData.batting.filter(b => b.status === 'not out').slice(0, 2)

  const hasBatted = activeTeamData.batting && activeTeamData.batting.length > 0
  const hasBowled = opponentTeamData.bowling && opponentTeamData.bowling.length > 0

  return (
    <section className="py-20 bg-gradient-to-b from-gray-50 to-white overflow-hidden" id="preview">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        {/* Section Header */}
        <div className="text-center max-w-3xl mx-auto mb-16">
          <h2 className="text-4xl sm:text-5xl font-bold text-gray-900 mb-4">
            See it in{' '}
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-accent-600">
              action
            </span>
          </h2>
          <p className="text-xl text-gray-600">
            Experience the live scoreboard interface that thousands of local teams love
          </p>
        </div>

        {/* Live Scorecard Preview */}
        <div className="relative max-w-6xl mx-auto">
          <div className="absolute inset-0 bg-gradient-to-r from-primary-200/30 via-accent-200/30 to-primary-200/30 blur-3xl"></div>

          <div className="relative bg-white rounded-3xl shadow-2xl border border-gray-200 overflow-hidden">
            {/* Header */}
            <div className="bg-gradient-to-r from-primary-600 to-accent-600 text-white p-6">
              <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                  <h3 className="text-2xl font-bold mb-1">
                    {hasRealData ? `Match ${match.matchCode}` : 'Summer League Final'}
                  </h3>
                  <p className="text-primary-100">
                    {hasRealData ? match.venue : 'Match 42 ‚Ä¢ Green Park Stadium'}
                  </p>
                </div>
                <div className="flex items-center gap-4">
                  <div className="flex items-center gap-2">
                    <Clock className="h-4 w-4" />
                    <span className="text-sm">{isLive || match?.status === 'live' ? 'LIVE' : match?.status?.toUpperCase() || 'LIVE'}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Users className="h-4 w-4" />
                    <span className="text-sm">{viewersCount > 0 ? `${(viewersCount / 1000).toFixed(1)}K` : '2.3K'} watching</span>
                  </div>
                </div>
              </div>
            </div>

            {/* Teams and Scores */}
            <div className="p-8">
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div className="space-y-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <h4 className="text-xl font-semibold text-gray-900">{team1Data.displayName}</h4>
                      <p className="text-sm text-gray-600">Innings 1 of 1</p>
                    </div>
                    <div className="text-right">
                      <div className="text-4xl font-bold text-primary-600">
                        {team1Data.totalScore}/{team1Data.totalWickets}
                      </div>
                      <div className="text-sm text-gray-600">{team1Data.totalOvers} overs</div>
                    </div>
                  </div>
                  {match?.batting_team === team1Data.name && (
                    <div className="bg-gray-50 rounded-xl p-4">
                      <p className="text-xs text-gray-600 uppercase tracking-wider mb-3">Batting</p>
                      <div className="space-y-2">
                        {currentBatsmen.map((batsman, idx) => (
                          <div key={idx} className="flex justify-between items-center">
                            <span className="font-medium">{batsman.name}{idx === 0 ? '*' : ''}</span>
                            <span className="text-sm text-gray-600">{batsman.runs} ({batsman.balls})</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="space-y-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <h4 className="text-xl font-semibold text-gray-900">{team2Data.displayName}</h4>
                      <p className="text-sm text-gray-600">Innings 1 of 1</p>
                    </div>
                    <div className="text-right">
                      <div className="text-4xl font-bold text-gray-900">
                        {team2Data.totalScore}/{team2Data.totalWickets}
                      </div>
                      <div className="text-sm text-gray-600">{team2Data.totalOvers} overs</div>
                    </div>
                  </div>
                  {match?.bowling_team === team2Data.name && opponentTeamData.bowling[0] && (
                    <div className="bg-gray-50 rounded-xl p-4">
                      <p className="text-xs text-gray-600 uppercase tracking-wider mb-3">Bowling</p>
                      <div className="space-y-2">
                        <div className="flex justify-between items-center">
                          <span className="font-medium">{opponentTeamData.bowling[0].name}</span>
                          <span className="text-sm text-gray-600">
                            {opponentTeamData.bowling[0].overs}-{opponentTeamData.bowling[0].maidens}-{opponentTeamData.bowling[0].runs}-{opponentTeamData.bowling[0].wickets}
                          </span>
                        </div>
                        <div className="flex justify-between items-center">
                          <span className="text-sm text-gray-600">Economy</span>
                          <span className="text-sm font-medium">{opponentTeamData.bowling[0].economy.toFixed(2)}</span>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* Match Status */}
              {matchStatus && (
                <div className="mt-8 p-4 bg-gradient-to-r from-primary-50 to-accent-50 rounded-xl">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <TrendingUp className="h-5 w-5 text-primary-600" />
                      <span className="text-sm font-medium text-gray-900">
                        {matchStatus}
                      </span>
                    </div>
                    <span className="text-sm text-gray-600">RRR: {rrr}</span>
                  </div>
                </div>
              )}

              {/* Recent Balls */}
              <div className="mt-6">
                <p className="text-xs text-gray-600 uppercase tracking-wider mb-3">This Over</p>
                <div className="flex gap-2">
                  {['1', '4', 'W', '2', '0', '6'].map((ball, index) => (
                    <div
                      key={index}
                      className={`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${
                        ball === 'W'
                          ? 'bg-red-100 text-red-600'
                          : ball === '4'
                          ? 'bg-blue-100 text-blue-600'
                          : ball === '6'
                          ? 'bg-green-100 text-green-600'
                          : 'bg-gray-100 text-gray-700'
                      }`}
                    >
                      {ball}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Detailed Scorecard Tabs */}
        <div className="mt-16">
          {/* Tabs */}
          <div className="flex justify-center mb-8">
            <div className="bg-gray-100 rounded-lg p-1 flex space-x-1 max-w-xs w-full mx-4">
              <button
                onClick={() => setActiveTeam('teamOne')}
                className={`w-1/2 py-2 text-sm font-medium rounded-md transition-colors ${
                  activeTeam === 'teamOne'
                    ? 'bg-primary-600 text-white shadow-sm'
                    : 'bg-white text-gray-700 hover:bg-gray-200'
                }`}
              >
                {team1Data.name}
              </button>
              <button
                onClick={() => setActiveTeam('teamTwo')}
                className={`w-1/2 py-2 text-sm font-medium rounded-md transition-colors ${
                  activeTeam === 'teamTwo'
                    ? 'bg-primary-600 text-white shadow-sm'
                    : 'bg-white text-gray-700 hover:bg-gray-200'
                }`}
              >
                {team2Data.name}
              </button>
            </div>
          </div>

          {/* Batting Section */}
          {hasBatted ? (
            <>
              <div className="overflow-x-auto mb-8">
                <table className="w-full text-sm border-collapse">
                  <thead>
                    <tr className="bg-gray-50 text-gray-700 border-b">
                      <th className="text-left px-4 py-2">Batting</th>
                      <th className="text-left px-4 py-2">Status</th>
                      <th className="text-center px-4 py-2">R</th>
                      <th className="text-center px-4 py-2">B</th>
                      <th className="text-center px-4 py-2">4s</th>
                      <th className="text-center px-4 py-2">6s</th>
                      <th className="text-center px-4 py-2">SR</th>
                    </tr>
                  </thead>
                  <tbody>
                    {activeTeamData.batting.map((b, idx) => (
                      <tr key={idx} className="border-b hover:bg-gray-50 transition">
                        <td className="py-3 px-4 font-medium text-gray-800">{b.name}</td>
                        <td className="py-3 px-4 text-gray-600">{b.status}</td>
                        <td className="py-3 text-center">{b.runs}</td>
                        <td className="py-3 text-center">{b.balls}</td>
                        <td className="py-3 text-center">{b.fours}</td>
                        <td className="py-3 text-center">{b.sixes}</td>
                        <td className="py-3 text-center">{b.strikeRate.toFixed(1)}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* Yet to Bat Section */}
              {activeTeamData.yetToBat && activeTeamData.yetToBat.length > 0 && (
                <div className="mb-12 bg-gray-50 rounded-xl p-4">
                  <p className="text-xs text-gray-600 uppercase tracking-wider mb-2">Yet to Bat</p>
                  <div className="flex flex-wrap gap-3 text-sm text-gray-800">
                    {activeTeamData.yetToBat.slice(0, 4).map((player) => (
                      <span
                        key={player}
                        className="px-3 py-1 bg-white border border-gray-200 rounded-lg shadow-sm"
                      >
                        {player}
                      </span>
                    ))}
                  </div>
                </div>
              )}
            </>
          ) : (
            <div className="mb-8 text-center text-gray-600">No batting data yet.</div>
          )}

          {/* Bowling Section */}
          {hasBowled ? (
            <div className="overflow-x-auto">
              <table className="w-full text-sm border-collapse">
                <thead>
                  <tr className="bg-gray-50 text-gray-700 border-b">
                    <th className="text-left px-4 py-2">Bowling</th>
                    <th className="text-center px-4 py-2">O</th>
                    <th className="text-center px-4 py-2">M</th>
                    <th className="text-center px-4 py-2">R</th>
                    <th className="text-center px-4 py-2">W</th>
                    <th className="text-center px-4 py-2">Econ</th>
                  </tr>
                </thead>
                <tbody>
                  {opponentTeamData.bowling.map((p, idx) => (
                    <tr key={idx} className="border-b hover:bg-gray-50 transition">
                      <td className="py-3 px-4 font-medium text-gray-800">{p.name}</td>
                      <td className="py-3 text-center">{p.overs}</td>
                      <td className="py-3 text-center">{p.maidens}</td>
                      <td className="py-3 text-center">{p.runs}</td>
                      <td className="py-3 text-center">{p.wickets}</td>
                      <td className="py-3 text-center">{p.economy.toFixed(2)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          ) : (
            <div className="text-center text-gray-600">No bowling data yet.</div>
          )}
        </div>
      </div>
    </section>
  )
}

===== FILE: components/ui/AlertDialog.tsx =====
'use client'

import * as React from 'react'
import { useEffect, useState } from 'react'

interface AlertDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  children: React.ReactNode
}

const AlertDialog = ({ open, onOpenChange, children }: AlertDialogProps) => {
  const [mounted, setMounted] = useState(false)

  useEffect(() => {
    setMounted(true)
  }, [])

  useEffect(() => {
    if (open) {
      document.body.style.overflow = 'hidden'
    } else {
      document.body.style.overflow = 'unset'
    }
    return () => {
      document.body.style.overflow = 'unset'
    }
  }, [open])

  if (!mounted) {
    return null
  }

  if (!open) {
    return null
  }


  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      <div 
        className="fixed inset-0 bg-black bg-opacity-50"
        onClick={() => {
          onOpenChange(false)
        }}
      />
      <div className="relative z-50 w-full max-w-md">
        {children}
      </div>
    </div>
  )
}

const AlertDialogContent = ({ children }: { children: React.ReactNode }) => {
  return (
    <div 
      className="bg-white rounded-lg shadow-xl p-6"
      onClick={(e) => {
        e.stopPropagation()
      }}
    >
      {children}
    </div>
  )
}

const AlertDialogHeader = ({ children }: { children: React.ReactNode }) => {
  return <div className="mb-4">{children}</div>
}

const AlertDialogTitle = ({ children }: { children: React.ReactNode }) => {
  return <h2 className="text-lg font-semibold text-gray-900">{children}</h2>
}

const AlertDialogDescription = ({ children }: { children: React.ReactNode }) => {
  return <div className="text-sm text-gray-600 mt-2">{children}</div>
}

const AlertDialogFooter = ({ children }: { children: React.ReactNode }) => {
  console.log('üîß AlertDialogFooter rendering')
  return <div className="flex gap-3 justify-end mt-6">{children}</div>
}

const AlertDialogCancel = ({ 
  onClick, 
  children 
}: { 
  onClick: () => void
  children: React.ReactNode 
}) => {

  const handleClick = (e: React.MouseEvent) => {
    e.preventDefault()
    e.stopPropagation()
    try {
      onClick()
    } catch (error) {
      console.error('üîß Error calling onClick:', error)
    }
  }

  return (
    <button
      type="button"
      onClick={handleClick}
      onMouseDown={() => console.log('üîß Cancel button mouse down')}
      onMouseUp={() => console.log('üîß Cancel button mouse up')}
      className="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 active:bg-gray-300 transition-colors"
    >
      {children}
    </button>
  )
}

const AlertDialogAction = ({ 
  onClick, 
  children,
  variant = 'default',
  disabled = false
}: { 
  onClick: () => void
  children: React.ReactNode
  variant?: 'default' | 'destructive'
  disabled?: boolean
}) => {
  const handleClick = (e: React.MouseEvent) => {    
    e.preventDefault()
    e.stopPropagation()
    
    if (disabled) {
      return
    }
    
    try {
      onClick()
    } catch (error) {
      console.error('üîß Error calling onClick:', error)
    }
  }

  const variantClasses = variant === 'destructive' 
    ? "bg-red-500 text-white hover:bg-red-600 active:bg-red-700" 
    : "bg-green-500 text-white hover:bg-green-600 active:bg-green-700"
  
  return (
    <button
      type="button"
      disabled={disabled}
      onClick={handleClick}
      onMouseDown={() => console.log('üîß Action button mouse down')}
      onMouseUp={() => console.log('üîß Action button mouse up')}
      className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${variantClasses}`}
    >
      {children}
    </button>
  )
}

export {
  AlertDialog,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogCancel,
  AlertDialogAction,
}

===== FILE: components/ui/badge.tsx =====
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary-100 text-primary-700",
        secondary:
          "border-transparent bg-secondary-100 text-secondary-700",
        destructive:
          "border-transparent bg-red-100 text-red-700",
        outline: "text-foreground",
        success: "border-transparent bg-green-100 text-green-700",
        warning: "border-transparent bg-yellow-100 text-yellow-700",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

===== FILE: components/ui/button.tsx =====
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-xl text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-95",
  {
    variants: {
      variant: {
        default: "bg-gradient-to-r from-primary-600 to-accent-600 text-white hover:from-primary-700 hover:to-accent-700 shadow-lg hover:shadow-xl",
        secondary: "bg-white text-primary-700 border-2 border-primary-200 hover:bg-primary-50 hover:border-primary-300",
        ghost: "hover:bg-accent-100 hover:text-accent-900",
        link: "text-primary-600 underline-offset-4 hover:underline",
      },
      size: {
        default: "h-11 px-6 py-2",
        sm: "h-9 rounded-lg px-4",
        lg: "h-12 rounded-xl px-8 text-base",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

===== FILE: components/ui/card.tsx =====
import * as React from "react"
import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-2xl border border-gray-100 bg-white/80 backdrop-blur-sm text-gray-950 shadow-sm hover:shadow-md transition-all duration-300",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-gray-600", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

export { Card, CardHeader, CardTitle, CardDescription, CardContent }

===== FILE: components/ui/tabs.tsx =====
'use client'

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"
import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-lg bg-gray-100 p-1 text-gray-600",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

===== FILE: components/ui/toaster.tsx =====
'use client'

import { Toaster as HotToaster } from 'react-hot-toast'

export function Toaster() {
  return (
    <HotToaster
      position="top-right"
      toastOptions={{
        duration: 4000,
        style: {
          background: '#fff',
          color: '#363636',
          borderRadius: '12px',
          padding: '16px',
          boxShadow: '0 10px 40px rgba(0, 0, 0, 0.1)',
        },
        success: {
          iconTheme: {
            primary: '#10b981',
            secondary: '#fff',
          },
        },
        error: {
          iconTheme: {
            primary: '#ef4444',
            secondary: '#fff',
          },
        },
      }}
    />
  )
}

===== FILE: hooks/useAuth.ts =====
'use client'

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';

interface User {
  id: string;
  name: string;
  email: string;
}

export function useAuth() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    const checkAuth = () => {
      try {
        const token = localStorage.getItem('auth_token');
        const userData = localStorage.getItem('user');

        if (token && userData) {
          const parsedUser = JSON.parse(userData);
          setUser(parsedUser);
        } else {
          // Only redirect if we're on a protected page
          if (window.location.pathname.startsWith('/dashboard')) {
            router.push('/login');
          }
        }
      } catch (error) {
        console.error('Auth check failed:', error);
        localStorage.clear();
        router.push('/login');
      } finally {
        setLoading(false);
      }
    };

    checkAuth();
  }, [router]);

  const logout = async () => {
    try {
      await fetch('/api/auth/logout', { method: 'POST' });
    } catch (error) {
      console.error('Logout error:', error);
    } finally {
      localStorage.clear();
      router.push('/login');
    }
  };

  return { user, loading, logout };
}

===== FILE: hooks/useMatchScoring.ts =====
import { useReducer, useCallback, useRef, useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import toast from 'react-hot-toast'
import debounce from 'lodash/debounce'
import { Match, ScoringState, ScoringAction, Ball } from '@/types/match'
import {
  validateBallUpdate,
  calculateBallOutcome,
} from '@/utils/scoringValidations'

const initialScoringState: ScoringState = {
  selectedBatsman1: '',
  selectedBatsman2: '',
  selectedBowler: '',
  previousBowler: '', // ‚úÖ NEW
  currentStriker: 'batsman1',
  currentOver: [],
  outBatsmen: [],
  currentInnings: 1,
  extraRuns: 0,
}

const scoringReducer = (
  state: ScoringState,
  action: ScoringAction
): ScoringState => {
  switch (action.type) {
    case 'SET_BATSMAN_1':
      return { ...state, selectedBatsman1: action.payload }
    case 'SET_BATSMAN_2':
      return { ...state, selectedBatsman2: action.payload }
    case 'SET_BOWLER':
      return { ...state, selectedBowler: action.payload }
    case 'SET_STRIKER':
      return { ...state, currentStriker: action.payload }
    case 'ROTATE_STRIKE':
      return {
        ...state,
        currentStriker:
          state.currentStriker === 'batsman1' ? 'batsman2' : 'batsman1',
      }
    case 'ADD_TO_CURRENT_OVER':
      return { ...state, currentOver: [...state.currentOver, action.payload] }
    case 'COMPLETE_OVER':
      // ‚úÖ Save current bowler as previous, clear current bowler
      return {
        ...state,
        currentOver: [],
        previousBowler: state.selectedBowler, // ‚úÖ NEW: Save current bowler
        selectedBowler: '', // Clear for new selection
        currentStriker:
          state.currentStriker === 'batsman1' ? 'batsman2' : 'batsman1',
      }
    case 'WICKET':
      return {
        ...state,
        outBatsmen: [...state.outBatsmen, action.payload],
      }
    case 'RESET_FOR_INNINGS':
      return {
        ...initialScoringState,
        currentInnings: state.currentInnings + 1,
        outBatsmen: [],
      }
    case 'SET_EXTRA_RUNS':
      return { ...state, extraRuns: action.payload }
    case 'RESTORE_STATE':
      console.log('üîÑ REDUCER: Restoring state to:', action.payload)
      return action.payload
    default:
      return state
  }
}


export const useMatchScoring = (matchId: string) => {
  const router = useRouter()
  const [scoringState, dispatch] = useReducer(
    scoringReducer,
    initialScoringState
  )

  const [match, setMatch] = useState<Match | null>(null)
  const [loading, setLoading] = useState(true)
  const [battingTeamName, setBattingTeamName] = useState('')
  const [bowlingTeamName, setBowlingTeamName] = useState('')
  const [ballHistory, setBallHistory] = useState<Ball[]>([])
  const [isStateRestored, setIsStateRestored] = useState(false)

  // ‚úÖ Track if we should auto-save (prevent saving during restoration)
  const [shouldAutoSave, setShouldAutoSave] = useState(false)

  const saveToServer = useCallback(async (matchData: Match, currentScoringState: ScoringState, currentBallHistory: Ball[]) => {
    try {
      const token = localStorage.getItem('auth_token')

      const matchToSave = {
        ...matchData,
        scoringState: currentScoringState,
        ballHistory: currentBallHistory,
      }

      console.log('üíæ Saving to server:', {
        striker: currentScoringState.currentStriker,
        batsman1: currentScoringState.selectedBatsman1,
        batsman2: currentScoringState.selectedBatsman2,
        bowler: currentScoringState.selectedBowler,
        currentOver: currentScoringState.currentOver,
      })

      // ‚úÖ NEW: Log toss data
      console.log('üé≤ Toss data being saved:', {
        toss_winner: matchToSave.toss_winner,
        toss_decision: matchToSave.toss_decision,
        batting_team: matchToSave.batting_team,
        bowling_team: matchToSave.bowling_team,
        status: matchToSave.status,
      })

      const response = await fetch(`/api/matches/${matchId}/score`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({ match: matchToSave }),
      })

      if (!response.ok) {
        throw new Error('Failed to save')
      }

      console.log('‚úÖ Match saved successfully')
    } catch (err) {
      console.error('‚ùå Error saving match:', err)
      toast.error('Failed to save match state')
    }
  }, [matchId])

  // ‚úÖ Debounced save
  const debouncedSave = useRef(
    debounce((matchData: Match, state: ScoringState, history: Ball[]) => {
      saveToServer(matchData, state, history)
    }, 1000)
  ).current

  // ‚úÖ AUTO-SAVE: Save whenever scoringState or ballHistory changes (after restoration)
  useEffect(() => {
    if (match && shouldAutoSave && isStateRestored) {
      // ‚úÖ ONLY auto-save if toss is completed
      if (match.toss_winner && match.batting_team) {
        console.log('üîÑ Auto-saving due to state change...')
        debouncedSave(match, scoringState, ballHistory)
      } else {
        console.log('‚è∏Ô∏è Skipping auto-save - toss not completed yet')
      }
    }
  }, [scoringState, ballHistory, match, shouldAutoSave, isStateRestored, debouncedSave])

  const fetchMatch = useCallback(async () => {
    try {
      const token = localStorage.getItem('auth_token')
      console.log('üîç Fetching match:', matchId)

      const response = await fetch(`/api/matches/${matchId}`, {
        headers: {
          Authorization: `Bearer ${token}`,
        },
      })

      if (!response.ok) {
        toast.error('Failed to load match')
        router.push(`/matches/${matchId}`)
        return
      }

      const data = await response.json()
      const matchData = data.data

      console.log('üì¶ Raw match data from API:', {
        toss_winner: matchData.toss_winner,
        batting_team: matchData.batting_team,
        bowling_team: matchData.bowling_team,
        scoringState: matchData.scoringState,
        status: matchData.status,
      })

      // Initialize team scores
      matchData.teamOne.total_score = matchData.teamOne.total_score || 0
      matchData.teamOne.total_wickets = matchData.teamOne.total_wickets || 0
      matchData.teamOne.total_balls = matchData.teamOne.total_balls || 0
      matchData.teamOne.extras = matchData.teamOne.extras || 0

      matchData.teamTwo.total_score = matchData.teamTwo.total_score || 0
      matchData.teamTwo.total_wickets = matchData.teamTwo.total_wickets || 0
      matchData.teamTwo.total_balls = matchData.teamTwo.total_balls || 0
      matchData.teamTwo.extras = matchData.teamTwo.extras || 0

      matchData.ballHistory = matchData.ballHistory || []

      setMatch(matchData)
      setBallHistory(matchData.ballHistory)

      // Restore state if match is in progress
      if (matchData.toss_winner && matchData.batting_team) {
        console.log('‚úÖ Toss completed, restoring state...')

        setBattingTeamName(matchData.batting_team)
        setBowlingTeamName(matchData.bowling_team)

        if (matchData.scoringState) {
          console.log('üì¶ Found scoring state in DB:', matchData.scoringState)

          // Dispatch restoration
          dispatch({ type: 'RESTORE_STATE', payload: matchData.scoringState })

          setTimeout(() => {
            setIsStateRestored(true)
            setShouldAutoSave(true)

            if (
              matchData.scoringState.selectedBatsman1 &&
              matchData.scoringState.selectedBatsman2 &&
              matchData.scoringState.selectedBowler
            ) {
              toast.success('Resumed from where you left off!')
            }
          }, 0)
        } else {
          console.log('‚ö†Ô∏è No scoring state found in DB')
          setIsStateRestored(true)
          setShouldAutoSave(true)
        }
      } else {
        console.log('‚ö†Ô∏è Toss not completed yet')
        setIsStateRestored(true)
        setShouldAutoSave(true)
      }
    } catch (err) {
      toast.error('Failed to load match')
      console.error('‚ùå Fetch match error:', err)
      setIsStateRestored(true)
      setShouldAutoSave(true)
    } finally {
      setLoading(false)
    }
  }, [matchId, router])

  const getBattingTeam = useCallback(() => {
    if (!match || !battingTeamName) return null
    return battingTeamName === match.teamOne.name
      ? match.teamOne
      : match.teamTwo
  }, [match, battingTeamName])

  const getBowlingTeam = useCallback(() => {
    if (!match || !bowlingTeamName) return null
    return bowlingTeamName === match.teamOne.name
      ? match.teamOne
      : match.teamTwo
  }, [match, bowlingTeamName])

  // ‚úÖ Immediate save function (for critical events like toss, innings end, match end)
  const saveImmediately = useCallback(
    async (updatedMatch: Match, currentState: ScoringState, currentHistory: Ball[]) => {
      await saveToServer(updatedMatch, currentState, currentHistory)
    },
    [saveToServer]
  )

  const recordBall = useCallback(
    async (outcome: string, providedExtraRuns?: number) => {
      if (!match) return

      const battingTeam = getBattingTeam()
      const bowlingTeam = getBowlingTeam()

      if (!battingTeam || !bowlingTeam) return

      const errors = validateBallUpdate(
        match,
        outcome,
        battingTeam,
        scoringState.currentInnings
      )

      if (errors.some((e) => e.type === 'error')) {
        toast.error(errors[0].message)
        return
      }

      const extraRunsToUse =
        providedExtraRuns !== undefined
          ? providedExtraRuns
          : scoringState.extraRuns

      const {
        runs,
        isWicket,
        isExtra,
        ballCounts,
        shouldRotateStrike,
      } = calculateBallOutcome(outcome, extraRunsToUse)

      const updatedMatch = { ...match }
      const teamToUpdate =
        battingTeamName === updatedMatch.teamOne.name ? 'teamOne' : 'teamTwo'

      updatedMatch[teamToUpdate].total_score += runs

      if (isExtra) {
        updatedMatch[teamToUpdate].extras += runs
      }

      if (ballCounts) {
        updatedMatch[teamToUpdate].total_balls += 1
      }

      const currentBatsman =
        scoringState.currentStriker === 'batsman1'
          ? scoringState.selectedBatsman1
          : scoringState.selectedBatsman2

      const ball: Ball = {
        ballNumber: updatedMatch[teamToUpdate].total_balls,
        overNumber:
          Math.floor(updatedMatch[teamToUpdate].total_balls / 6) + 1,
        batsman: currentBatsman,
        bowler: scoringState.selectedBowler,
        runs,
        outcome,
        isExtra,
        isWicket,
        timestamp: new Date(),
      }

      const newBallHistory = [...ballHistory, ball]
      setBallHistory(newBallHistory)

      if (isWicket) {
        updatedMatch[teamToUpdate].total_wickets += 1

        const newOutBatsmen = [...scoringState.outBatsmen, currentBatsman]
        const newCurrentOver = [...scoringState.currentOver, outcome]

        dispatch({ type: 'WICKET', payload: currentBatsman })
        dispatch({ type: 'ADD_TO_CURRENT_OVER', payload: outcome })

        const totalPlayers = battingTeam.players.length
        const wicketsDown = updatedMatch[teamToUpdate].total_wickets

        if (
          wicketsDown >= totalPlayers - 1 ||
          (totalPlayers === 2 && wicketsDown >= 1)
        ) {
          toast(`All out! ${battingTeam.name} innings complete`)
          handleInningsEnd(updatedMatch, newBallHistory)
          return
        }

        if (scoringState.currentStriker === 'batsman1') {
          dispatch({ type: 'SET_BATSMAN_1', payload: '' })
        } else {
          dispatch({ type: 'SET_BATSMAN_2', payload: '' })
        }

        toast('Select next batsman')
        setMatch(updatedMatch)
        // State will auto-save via useEffect
        return
      }

      // ‚úÖ Add to current over FIRST
      dispatch({ type: 'ADD_TO_CURRENT_OVER', payload: outcome })

      const legalBallsInOver = [...scoringState.currentOver, outcome].filter(
        (b) => !['WD', 'NB'].includes(b)
      ).length

      if (legalBallsInOver === 6) {
        toast.success('Over completed!')
        dispatch({ type: 'COMPLETE_OVER' }) // ‚úÖ This now handles previousBowler
        toast('Please select new bowler')
      } else if (shouldRotateStrike && !isWicket) {
        dispatch({ type: 'ROTATE_STRIKE' })
      }

      dispatch({ type: 'SET_EXTRA_RUNS', payload: 0 })

      const totalBalls = updatedMatch.overs * 6
      if (updatedMatch[teamToUpdate].total_balls >= totalBalls) {
        handleInningsEnd(updatedMatch, newBallHistory)
        return
      }

      if (scoringState.currentInnings === 2 && updatedMatch.target) {
        if (updatedMatch[teamToUpdate].total_score >= updatedMatch.target) {
          const wicketsLeft = 10 - updatedMatch[teamToUpdate].total_wickets
          toast.success(`${battingTeamName} won by ${wicketsLeft} wickets!`)
          updatedMatch.status = 'completed'

          setMatch(updatedMatch)

          await saveImmediately(updatedMatch, scoringState, newBallHistory)

          setTimeout(() => {
            router.push(`/matches/${matchId}`)
          }, 3000)
          return
        }
      }

      setMatch(updatedMatch)
      // Auto-save will trigger via useEffect
    },
    [
      match,
      scoringState,
      battingTeamName,
      bowlingTeamName,
      ballHistory,
      getBattingTeam,
      getBowlingTeam,
      matchId,
      router,
      saveImmediately,
    ]
  )

  const handleInningsEnd = async (
    updatedMatch: Match,
    newBallHistory: Ball[]
  ) => {
    if (scoringState.currentInnings === 1) {
      const teamToUpdate =
        battingTeamName === updatedMatch.teamOne.name ? 'teamOne' : 'teamTwo'
      updatedMatch.target = updatedMatch[teamToUpdate].total_score + 1

      toast.success(`First innings complete! Target: ${updatedMatch.target}`)

      setBattingTeamName(bowlingTeamName)
      setBowlingTeamName(battingTeamName)

      dispatch({ type: 'RESET_FOR_INNINGS' })

      setMatch(updatedMatch)

      // ‚úÖ Immediate save for innings change
      const newState: ScoringState = {
        ...initialScoringState,
        currentInnings: 2,
      }

      await saveImmediately(updatedMatch, newState, newBallHistory)
    } else {
      updatedMatch.status = 'completed'

      const battingTeamData =
        battingTeamName === updatedMatch.teamOne.name
          ? updatedMatch.teamOne
          : updatedMatch.teamTwo

      if (battingTeamData.total_score < updatedMatch.target! - 1) {
        const runDiff = updatedMatch.target! - 1 - battingTeamData.total_score
        toast.success(`${bowlingTeamName} won by ${runDiff} runs!`)
      } else if (battingTeamData.total_score === updatedMatch.target! - 1) {
        toast.success('Match Tied!')
      }

      setMatch(updatedMatch)

      // ‚úÖ Immediate save for match end
      await saveImmediately(updatedMatch, { ...scoringState, currentInnings: 2 }, newBallHistory)

      setTimeout(() => {
        router.push(`/matches/${matchId}`)
      }, 3000)
    }
  }

  const undoLastBall = useCallback(async () => {
    if (ballHistory.length === 0) {
      toast.error('Nothing to undo')
      return
    }

    const lastBall = ballHistory[ballHistory.length - 1]
    const updatedMatch = { ...match! }

    const teamToUpdate =
      battingTeamName === updatedMatch.teamOne.name ? 'teamOne' : 'teamTwo'

    updatedMatch[teamToUpdate].total_score -= lastBall.runs

    if (lastBall.isExtra) {
      updatedMatch[teamToUpdate].extras -= lastBall.runs
    }

    if (!['WD', 'NB'].includes(lastBall.outcome)) {
      updatedMatch[teamToUpdate].total_balls -= 1
    }

    if (lastBall.isWicket) {
      updatedMatch[teamToUpdate].total_wickets -= 1

      const newOutBatsmen = scoringState.outBatsmen.filter(
        (b) => b !== lastBall.batsman
      )

      if (scoringState.selectedBatsman1 === '') {
        dispatch({ type: 'SET_BATSMAN_1', payload: lastBall.batsman })
      } else if (scoringState.selectedBatsman2 === '') {
        dispatch({ type: 'SET_BATSMAN_2', payload: lastBall.batsman })
      }

      dispatch({
        type: 'RESTORE_STATE',
        payload: {
          ...scoringState,
          outBatsmen: newOutBatsmen,
        },
      })
    }

    const newBallHistory = ballHistory.slice(0, -1)
    setBallHistory(newBallHistory)

    const newCurrentOver = [...scoringState.currentOver]
    if (newCurrentOver.length > 0) {
      newCurrentOver.pop()
      dispatch({
        type: 'RESTORE_STATE',
        payload: { ...scoringState, currentOver: newCurrentOver },
      })
    }

    setMatch(updatedMatch)

    // ‚úÖ Immediate save for undo
    await saveImmediately(updatedMatch, scoringState, newBallHistory)

    toast.success('Last ball undone')
  }, [ballHistory, match, battingTeamName, scoringState, saveImmediately])

  const updateMatch = useCallback((updates: Partial<Match>) => {
  if (!match) return null
  
  const updatedMatch = { ...match, ...updates }
  setMatch(updatedMatch)
  return updatedMatch
}, [match])


  return {
    match,
    loading,
    scoringState,
    dispatch,
    battingTeamName,
    setBattingTeamName,
    bowlingTeamName,
    setBowlingTeamName,
    getBattingTeam,
    getBowlingTeam,
    recordBall,
    undoLastBall,
    fetchMatch,
    ballHistory,
    isStateRestored,
    saveImmediately,
    updateMatch
  }
}

